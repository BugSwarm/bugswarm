travis_fold:start:worker_info
[0K[33;1mWorker information[0m
hostname: 594f3d08-c567-4b74-96df-156b57267c3a@1.worker-org-57dfd4cd5-ff8q7.gce-production-3
version: v6.2.6 https://github.com/travis-ci/worker/tree/ba21bd30589fd152126e13df30e0cc78ccdf2837
instance: travis-job-18457992-6309-469e-bfef-9c9f4e031c11 travis-ci-sardonyx-xenial-1553530528-f909ac5 (via amqp)
startup: 6.2487408s
travis_fold:end:worker_info
[0Ktravis_time:start:0aa45208
[0Ktravis_time:end:0aa45208:start=1580330965041924412,finish=1580330965176756785,duration=134832373,event=no_world_writable_dirs
[0Ktravis_time:start:02b32d05
[0Ktravis_time:end:02b32d05:start=1580330965179451689,finish=1580330965182132179,duration=2680490,event=setup_filter
[0Ktravis_time:start:19f1d90c
[0Ktravis_time:end:19f1d90c:start=1580330965188036069,finish=1580330965194916183,duration=6880114,event=agent
[0Ktravis_time:start:041bac34
[0Ktravis_time:end:041bac34:start=1580330965197362496,finish=1580330965199240579,duration=1878083,event=check_unsupported
[0Ktravis_time:start:0578d7b9
[0Ktravis_fold:start:system_info
[0K[33;1mBuild system information[0m
Build language: node_js
Build group: stable
Build dist: xenial
Build id: 643564898
Job id: 643564899
Runtime kernel version: 4.15.0-1028-gcp
travis-build version: 74fa7e3af
[34m[1mBuild image provisioning date and time[0m
Mon Mar 25 16:43:24 UTC 2019
[34m[1mOperating System Details[0m
Distributor ID: Ubuntu
Description:  Ubuntu 16.04.6 LTS
Release:  16.04
Codename: xenial
[34m[1mSystemd Version[0m
systemd 229
[34m[1mCookbooks Version[0m
42e42e4 https://github.com/travis-ci/travis-cookbooks/tree/42e42e4
[34m[1mgit version[0m
git version 2.21.0
[34m[1mbash version[0m
GNU bash, version 4.3.48(1)-release (x86_64-pc-linux-gnu)
[34m[1mgcc version[0m
gcc (Ubuntu 5.4.0-6ubuntu1~16.04.11) 5.4.0 20160609
[34m[1mdocker version[0m
Client:
 Version:           18.06.0-ce
 API version:       1.38
 Go version:        go1.10.3
 Git commit:        0ffa825
 Built:             Wed Jul 18 19:11:02 2018
 OS/Arch:           linux/amd64
 Experimental:      false

Server:
 Engine:
  Version:          18.06.0-ce
  API version:      1.38 (minimum version 1.12)
  Go version:       go1.10.3
  Git commit:       0ffa825
  Built:            Wed Jul 18 19:09:05 2018
  OS/Arch:          linux/amd64
  Experimental:     false
[34m[1mclang version[0m
clang version 7.0.0 (tags/RELEASE_700/final)
[34m[1mjq version[0m
jq-1.5
[34m[1mbats version[0m
Bats 0.4.0
[34m[1mshellcheck version[0m
0.6.0
[34m[1mshfmt version[0m
v2.6.3
[34m[1mccache version[0m
3.2.4
[34m[1mcmake version[0m
cmake version 3.12.4
[34m[1mheroku version[0m
heroku/7.22.7 linux-x64 node-v11.10.1
[34m[1mimagemagick version[0m
Version: ImageMagick 6.8.9-9 Q16 x86_64 2018-09-28 http://www.imagemagick.org
[34m[1mmd5deep version[0m
4.4
[34m[1mmercurial version[0m
version 4.8
[34m[1mmysql version[0m
mysql  Ver 14.14 Distrib 5.7.25, for Linux (x86_64) using  EditLine wrapper
[34m[1mopenssl version[0m
OpenSSL 1.0.2g  1 Mar 2016
[34m[1mpacker version[0m
1.3.3
[34m[1mpostgresql client version[0m
psql (PostgreSQL) 10.7 (Ubuntu 10.7-1.pgdg16.04+1)
[34m[1mragel version[0m
Ragel State Machine Compiler version 6.8 Feb 2013
[34m[1msudo version[0m
1.8.16
[34m[1mgzip version[0m
gzip 1.6
[34m[1mzip version[0m
Zip 3.0
[34m[1mvim version[0m
VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Nov 24 2016 16:44:48)
[34m[1miptables version[0m
iptables v1.6.0
[34m[1mcurl version[0m
curl 7.47.0 (x86_64-pc-linux-gnu) libcurl/7.47.0 GnuTLS/3.4.10 zlib/1.2.8 libidn/1.32 librtmp/2.3
[34m[1mwget version[0m
GNU Wget 1.17.1 built on linux-gnu.
[34m[1mrsync version[0m
rsync  version 3.1.1  protocol version 31
[34m[1mgimme version[0m
v1.5.3
[34m[1mnvm version[0m
0.34.0
[34m[1mperlbrew version[0m
/home/travis/perl5/perlbrew/bin/perlbrew  - App::perlbrew/0.86
[34m[1mphpenv version[0m
rbenv 1.1.2
[34m[1mrvm version[0m
rvm 1.29.7 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io]
[34m[1mdefault ruby version[0m
ruby 2.5.3p105 (2018-10-18 revision 65156) [x86_64-linux]
[34m[1mCouchDB version[0m
couchdb 1.6.1
[34m[1mElasticSearch version[0m
5.5.0
[34m[1mInstalled Firefox version[0m
firefox 63.0.1
[34m[1mMongoDB version[0m
MongoDB 4.0.7
[34m[1mPhantomJS version[0m
2.1.1
[34m[1mPre-installed PostgreSQL versions[0m
9.4.21
9.5.16
9.6.12
[34m[1mRedis version[0m
redis-server 5.0.4
[34m[1mPre-installed Go versions[0m
1.11.1
[34m[1mmvn version[0m
Apache Maven 3.6.0 (97c98ec64a1fdfee7767ce5ffb20918da4f719f3; 2018-10-24T18:41:47Z)
[34m[1mgradle version[0m
Gradle 4.10.2!
[34m[1mlein version[0m
Leiningen 2.9.1 on Java 11.0.2 OpenJDK 64-Bit Server VM
[34m[1mPre-installed Node.js versions[0m
v10.15.3
v11.0.0
v4.9.1
v6.17.0
v8.12.0
v8.15.1
v8.9
[34m[1mphpenv versions[0m
  system
  5.6
  5.6.40
  7.1
  7.1.27
  7.2
* 7.2.15 (set by /home/travis/.phpenv/version)
  hhvm
  hhvm-stable
[34m[1mcomposer --version[0m
Composer version 1.8.4 2019-02-11 10:52:10
[34m[1mPre-installed Ruby versions[0m
ruby-2.3.8
ruby-2.4.5
ruby-2.5.3
travis_fold:end:system_info
[0K
travis_time:end:0578d7b9:start=1580330965201697655,finish=1580330965207143853,duration=5446198,event=show_system_info
[0Ktravis_time:start:18fb0b69
[0Ktravis_time:end:18fb0b69:start=1580330965217492189,finish=1580330965255315208,duration=37823019,event=rm_riak_source
[0Ktravis_time:start:089acd94
[0Ktravis_time:end:089acd94:start=1580330965265681159,finish=1580330965275933539,duration=10252380,event=fix_rwky_redis
[0Ktravis_time:start:0ef19b26
[0Ktravis_time:end:0ef19b26:start=1580330965281035157,finish=1580330965582480317,duration=301445160,event=wait_for_network
[0Ktravis_time:start:103bf85c
[0Ktravis_time:end:103bf85c:start=1580330965586514644,finish=1580330965777345042,duration=190830398,event=update_apt_keys
[0Ktravis_time:start:3221cf73
[0Ktravis_time:end:3221cf73:start=1580330965781130624,finish=1580330965828895325,duration=47764701,event=fix_hhvm_source
[0Ktravis_time:start:31c04b86
[0Ktravis_time:end:31c04b86:start=1580330965833044403,finish=1580330965835830795,duration=2786392,event=update_mongo_arch
[0Ktravis_time:start:062645a8
[0Ktravis_time:end:062645a8:start=1580330965841633916,finish=1580330965879058393,duration=37424477,event=fix_sudo_enabled_trusty
[0Ktravis_time:start:05b65a92
[0Ktravis_time:end:05b65a92:start=1580330965882914141,finish=1580330965884791366,duration=1877225,event=update_glibc
[0Ktravis_time:start:08e9b744
[0Ktravis_time:end:08e9b744:start=1580330965888326149,finish=1580330965895350256,duration=7024107,event=clean_up_path
[0Ktravis_time:start:13f378b6
[0Ktravis_time:end:13f378b6:start=1580330965898876038,finish=1580330965906031807,duration=7155769,event=fix_resolv_conf
[0Ktravis_time:start:1812f528
[0Ktravis_time:end:1812f528:start=1580330965909943113,finish=1580330965919324707,duration=9381594,event=fix_etc_hosts
[0Ktravis_time:start:0125550c
[0Ktravis_time:end:0125550c:start=1580330965923328259,finish=1580330965931740580,duration=8412321,event=fix_mvn_settings_xml
[0Ktravis_time:start:03753af2
[0Ktravis_time:end:03753af2:start=1580330965938095968,finish=1580330965947152880,duration=9056912,event=no_ipv6_localhost
[0Ktravis_time:start:0d7e4910
[0Ktravis_time:end:0d7e4910:start=1580330965953894916,finish=1580330965956945593,duration=3050677,event=fix_etc_mavenrc
[0Ktravis_time:start:2ee36380
[0Ktravis_time:end:2ee36380:start=1580330965963269195,finish=1580330965966326369,duration=3057174,event=fix_wwdr_certificate
[0Ktravis_time:start:0fc31824
[0Ktravis_time:end:0fc31824:start=1580330965971442007,finish=1580330965993276955,duration=21834948,event=put_localhost_first
[0Ktravis_time:start:0708d34a
[0Ktravis_time:end:0708d34a:start=1580330965998366336,finish=1580330966001846577,duration=3480241,event=home_paths
[0Ktravis_time:start:18c13aa0
[0Ktravis_time:end:18c13aa0:start=1580330966005599523,finish=1580330966016599199,duration=10999676,event=disable_initramfs
[0Ktravis_time:start:00b41050
[0Ktravis_time:end:00b41050:start=1580330966020380215,finish=1580330966237560042,duration=217179827,event=disable_ssh_roaming
[0Ktravis_time:start:0bd0a0c8
[0Ktravis_time:end:0bd0a0c8:start=1580330966241126653,finish=1580330966243205264,duration=2078611,event=debug_tools
[0Ktravis_time:start:002a41ba
[0Ktravis_time:end:002a41ba:start=1580330966246812762,finish=1580330966249524196,duration=2711434,event=uninstall_oclint
[0Ktravis_time:start:19479216
[0Ktravis_time:end:19479216:start=1580330966253755527,finish=1580330966256370956,duration=2615429,event=rvm_use
[0Ktravis_time:start:0ed12f0f
[0Ktravis_time:end:0ed12f0f:start=1580330966260649077,finish=1580330966268066842,duration=7417765,event=rm_etc_boto_cfg
[0Ktravis_time:start:16bb22d4
[0Ktravis_time:end:16bb22d4:start=1580330966271524169,finish=1580330966273776996,duration=2252827,event=rm_oraclejdk8_symlink
[0Ktravis_time:start:15df993a
[0Ktravis_time:end:15df993a:start=1580330966279350930,finish=1580330966373627493,duration=94276563,event=enable_i386
[0Ktravis_time:start:0d78a0b6
[0Ktravis_time:end:0d78a0b6:start=1580330966377911531,finish=1580330966386770514,duration=8858983,event=update_rubygems
[0Ktravis_time:start:2accc309
[0Ktravis_time:end:2accc309:start=1580330966391134708,finish=1580330967139374814,duration=748240106,event=ensure_path_components
[0Ktravis_time:start:15f6a18a
[0Ktravis_time:end:15f6a18a:start=1580330967143249417,finish=1580330967145818692,duration=2569275,event=redefine_curl
[0Ktravis_time:start:08b1ec9e
[0Ktravis_time:end:08b1ec9e:start=1580330967149176134,finish=1580330967233727193,duration=84551059,event=nonblock_pipe
[0Ktravis_time:start:160a9bbb
[0Ktravis_time:end:160a9bbb:start=1580330967238350203,finish=1580330973271133108,duration=6032782905,event=apt_get_update
[0Ktravis_time:start:05d69160
[0Ktravis_time:end:05d69160:start=1580330973275460698,finish=1580330973277807523,duration=2346825,event=deprecate_xcode_64
[0Ktravis_time:start:06972d34
[0Ktravis_time:end:06972d34:start=1580330973282483509,finish=1580330975638723911,duration=2356240402,event=update_heroku
[0Ktravis_time:start:0e206d54
[0Ktravis_time:end:0e206d54:start=1580330975645136552,finish=1580330975647939607,duration=2803055,event=shell_session_update
[0Ktravis_time:start:08d0c630
[0Ktravis_fold:start:docker_mtu
[0Ktravis_fold:end:docker_mtu
[0Ktravis_time:end:08d0c630:start=1580330975652608001,finish=1580330977862851285,duration=2210243284,event=set_docker_mtu
[0Ktravis_time:start:126a6aa6
[0Ktravis_fold:start:resolvconf
[0Ktravis_fold:end:resolvconf
[0Ktravis_time:end:126a6aa6:start=1580330977868349240,finish=1580330977924483923,duration=56134683,event=resolvconf
[0Ktravis_time:start:01227931
[0Ktravis_time:end:01227931:start=1580330977936823425,finish=1580330978057742125,duration=120918700,event=maven_central_mirror
[0Ktravis_time:start:0329936f
[0Ktravis_time:end:0329936f:start=1580330978061750739,finish=1580330978150508784,duration=88758045,event=maven_https
[0Ktravis_time:start:03b54862
[0Ktravis_fold:start:services
[0Ktravis_time:start:02823292
[0K$ sudo systemctl start mysql
travis_time:end:02823292:start=1580330978157386104,finish=1580330979215869447,duration=1058483343,event=prepare
[0Ktravis_fold:end:services
[0Ktravis_time:end:02823292:start=1580330978157386104,finish=1580330982248764288,duration=4091378184,event=services
[0Ktravis_time:start:25011200
[0Ktravis_time:end:25011200:start=1580330982252367502,finish=1580330982254454497,duration=2086995,event=fix_ps4
[0Ktravis_time:start:12f42e75
[0K
travis_fold:start:git.checkout
[0Ktravis_time:start:0781d25c
[0K$ git clone --depth=50 --branch=master https://github.com/TryGhost/Ghost.git TryGhost/Ghost
Cloning into 'TryGhost/Ghost'...
travis_time:end:0781d25c:start=1580330982261652196,finish=1580330983353343150,duration=1091690954,event=checkout
[0K$ cd TryGhost/Ghost
$ git checkout -qf ef551768bb1632065993351e012fdfd593c2d8de
travis_fold:end:git.checkout
[0K
travis_fold:start:git.submodule
[0Ktravis_time:start:16fd3d60
[0K$ git submodule update --init --recursive
Submodule 'content/themes/casper' (https://github.com/TryGhost/Casper.git) registered for path 'content/themes/casper'
Submodule 'core/client' (https://github.com/TryGhost/Ghost-Admin.git) registered for path 'core/client'
Cloning into '/home/travis/build/TryGhost/Ghost/content/themes/casper'...
Cloning into '/home/travis/build/TryGhost/Ghost/core/client'...
Submodule path 'content/themes/casper': checked out '7c87383bc6217502063db015c61719c90c617eea'
Submodule path 'core/client': checked out '561d1f16e438855795cf6230026f3d51f6dc7ee9'
travis_time:end:16fd3d60:start=1580330983450074333,finish=1580330987710315414,duration=4260241081,event=checkout
[0Ktravis_fold:end:git.submodule
[0Ktravis_time:end:16fd3d60:start=1580330983450074333,finish=1580330987716119666,duration=4266045333,event=checkout
[0Ktravis_time:start:007d1e28
[0K
[33;1mSetting environment variables from repository settings[0m
$ export PUSH_TOKEN=[secure]
$ export SLACK_URL=[secure]

[33;1mSetting environment variables from .travis.yml[0m
$ export DB=sqlite3
$ export NODE_ENV=testing

travis_time:end:007d1e28:start=1580330987720037489,finish=1580330987729183577,duration=9146088,event=env
[0Ktravis_fold:start:nvm.install
[0Ktravis_time:start:0630fb32
[0K$ nvm install 12
Downloading and installing node v12.14.1...
Downloading https://nodejs.org/dist/v12.14.1/node-v12.14.1-linux-x64.tar.xz...
Computing checksum with sha256sum
Checksums matched!
Now using node v12.14.1 (npm v6.13.4)
travis_time:end:0630fb32:start=1580330988461126354,finish=1580330991406013682,duration=2944887328,event=setup
[0Ktravis_fold:end:nvm.install
[0K
travis_fold:start:cache.1
[0KSetting up build cache
$ export CASHER_DIR=${TRAVIS_HOME}/.casher
travis_time:start:014e49a3
[0K$ Installing caching utilities
travis_time:end:014e49a3:start=1580330992436316713,finish=1580330992615828679,duration=179511966,event=setup_casher
[0Ktravis_time:start:05333cf9
[0Ktravis_time:end:05333cf9:start=1580330992623021127,finish=1580330992625585491,duration=2564364,event=setup_casher
[0Ktravis_time:start:0326e9f2
[0Kattempting to download cache archive[0m
[32;1mfetching master/cache--linux-xenial-5a3c100ba51fc69c8c697d48d568d5385090fa49b62c5f41af6060673e12489d--node-12.tgz[0m
[32;1mfound cache[0m
travis_time:end:0326e9f2:start=1580330992629125423,finish=1580330996494600109,duration=3865474686,event=setup_casher
[0Ktravis_fold:end:cache.1
[0K
travis_fold:start:cache.yarn
[0K
travis_time:start:11b1293e
[0Ktravis_time:end:11b1293e:start=1580330996502248887,finish=1580330996504730482,duration=2481595,event=setup_cache
[0Ktravis_time:start:10f5c3bc
[0Kadding /home/travis/.cache/yarn to cache[0m
travis_time:end:10f5c3bc:start=1580330996508148529,finish=1580331009598021683,duration=13089873154,event=setup_cache
[0Ktravis_fold:end:cache.yarn
[0Ktravis_fold:start:cache.npm
[0K
travis_time:start:1b06a39c
[0Ktravis_time:end:1b06a39c:start=1580331009745193697,finish=1580331009748923066,duration=3729369,event=setup_cache
[0Ktravis_time:start:30238ef0
[0Kadding /home/travis/build/TryGhost/Ghost/node_modules to cache[0m
creating directory /home/travis/build/TryGhost/Ghost/node_modules[0m
travis_time:end:30238ef0:start=1580331009755255104,finish=1580331019195362669,duration=9440107565,event=setup_cache
[0Ktravis_fold:end:cache.npm
[0K$ node --version
v12.14.1
$ npm --version
6.13.4
$ nvm --version
0.35.2
$ yarn --version
1.15.2

travis_fold:start:install
[0Ktravis_time:start:0be1cf4c
[0K$ yarn
yarn install v1.15.2
[1/5] Validating package.json...
warning ghost@3.4.0: The engine "cli" appears to be invalid.
[2/5] Resolving packages...
[3/5] Fetching packages...
[4/5] Linking dependencies...
warning " > bookshelf@0.14.2" has incorrect peer dependency "knex@>=0.6.10 <0.15.0".
[5/5] Building fresh packages...
Done in 4.00s.
travis_time:end:0be1cf4c:start=1580331019963483970,finish=1580331024104737157,duration=4141253187,event=install
[0Ktravis_fold:end:install
[0Ktravis_fold:start:before_script.1
[0Ktravis_time:start:09a8c974
[0K$ if [ $DB == "mysql" ]; then mysql -e 'create database ghost_testing'; fi
travis_time:end:09a8c974:start=1580331024109853475,finish=1580331024113866919,duration=4013444,event=before_script
[0Ktravis_fold:end:before_script.1
[0Ktravis_fold:start:before_script.2
[0Ktravis_time:start:2b4d26bb
[0K$ if [ "$DB" == "sqlite3" ]; then yarn add --force sqlite3; fi
yarn add v1.15.2
[1/5] Validating package.json...
warning ghost@3.4.0: The engine "cli" appears to be invalid.
[2/5] Resolving packages...
[3/5] Fetching packages...
[4/5] Linking dependencies...
warning " > bookshelf@0.14.2" has incorrect peer dependency "knex@>=0.6.10 <0.15.0".
[5/5] Rebuilding all packages...
success Saved lockfile.
warning "sqlite3" is already in "optionalDependencies". Please remove existing entry first before adding it to "dependencies".
success Saved 1 new dependency.
info Direct dependencies
└─ sqlite3@4.1.1
info All dependencies
└─ sqlite3@4.1.1
Done in 6.63s.
travis_time:end:2b4d26bb:start=1580331024120292754,finish=1580331030890699032,duration=6770406278,event=before_script
[0Ktravis_fold:end:before_script.2
[0Ktravis_time:start:003b23c8
[0K$ if [[ "$TRAVIS_PULL_REQUEST_BRANCH" =~ ^renovate || "$TRAVIS_EVENT_TYPE" == "cron" ]]; then
  yarn ci:regression
else
  yarn ci
fi

yarn run v1.15.2
$ grunt test-regression --verbose
Initializing
Command-line options: --verbose, --gruntfile=/home/travis/build/TryGhost/Ghost/Gruntfile.js

Reading "Gruntfile.js" Gruntfile...OK

Registering Gruntfile tasks.

Registering "grunt-bg-shell" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-bg-shell/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-bg-shell/package.json...OK
Loading "bg-shell.coffee" tasks...OK
+ bgShell
Loading "child-process.coffee" tasks...OK
>> No tasks were registered or unregistered.

Registering "grunt-contrib-clean" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-clean/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-clean/package.json...OK
Loading "clean.js" tasks...OK
+ clean

Registering "grunt-contrib-compress" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-compress/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-compress/package.json...OK
Loading "compress.js" tasks...OK
+ compress

Registering "grunt-contrib-copy" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-copy/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-copy/package.json...OK
Loading "copy.js" tasks...OK
+ copy

Registering "grunt-contrib-symlink" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-symlink/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-symlink/package.json...OK
Loading "symlink.js" tasks...OK
+ symlink

Registering "grunt-contrib-uglify" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-uglify/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-uglify/package.json...OK
Loading "uglify.js" tasks...OK
+ uglify

Registering "grunt-contrib-watch" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-watch/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-watch/package.json...OK
Loading "watch.js" tasks...OK
+ watch

Registering "grunt-cssnano" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-cssnano/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-cssnano/package.json...OK
Loading "cssnano.js" tasks...OK
+ cssnano

Registering "grunt-express-server" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-express-server/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-express-server/package.json...OK
Loading "express.js" tasks...OK
+ express

Registering "grunt-mocha-cli" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/package.json...OK
Loading "mochacli.js" tasks...OK
+ mochacli

Registering "grunt-shell" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-shell/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-shell/package.json...OK
Loading "shell.js" tasks...OK
+ shell

Registering "grunt-subgrunt" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-subgrunt/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-subgrunt/package.json...OK
Loading "subgrunt.js" tasks...OK
+ subgrunt

Registering "grunt-update-submodules" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-update-submodules/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-update-submodules/package.json...OK
Loading "update-submodules.js" tasks...OK
+ update_submodules
Reading package.json...OK
Parsing package.json...OK
Initializing config...OK
Loading "Gruntfile.js" tasks...OK
+ build, default, dev, help, init, knex-migrator, lint, master, master-warn, prod, release, setTestEnv, stubClientFiles, test, test-acceptance, test-all, test-regression, test-setup, test-unit, validate

Running tasks: test-regression

Running "test-regression" task

Running "test-setup" task

Running "knex-migrator" task

Running "clean:test" (clean) task
Verifying property clean.test exists in config...OK
Files: [no src]
Options: force=false, no-write=false
>> 0 paths cleaned.

Running "setTestEnv" task

Running "stubClientFiles" task

Running "mochacli:regression" (mochacli) task
Verifying property mochacli.regression exists in config...OK
Files: core/test/regression/api/admin_spec.js, core/test/regression/api/canary/admin/authentication_spec.js, core/test/regression/api/canary/admin/db_spec.js, core/test/regression/api/canary/admin/images_spec.js, core/test/regression/api/canary/admin/members_spec.js, core/test/regression/api/canary/admin/notifications_spec.js, core/test/regression/api/canary/admin/pages_spec.js, core/test/regression/api/canary/admin/posts_spec.js, core/test/regression/api/canary/admin/redirects_spec.js, core/test/regression/api/canary/admin/schedules_spec.js, core/test/regression/api/canary/admin/settings_spec.js, core/test/regression/api/canary/admin/slack_spec.js, core/test/regression/api/canary/admin/users_spec.js, core/test/regression/api/canary/content/authors_spec.js, core/test/regression/api/canary/content/pages_spec.js, core/test/regression/api/canary/content/posts_spec.js, core/test/regression/api/canary/content/tags_spec.js, core/test/regression/api/v2/admin/authentication_spec.js, core/test/regression/api/v2/admin/db_spec.js, core/test/regression/api/v2/admin/images_spec.js, core/test/regression/api/v2/admin/notifications_spec.js, core/test/regression/api/v2/admin/pages_spec.js, core/test/regression/api/v2/admin/posts_spec.js, core/test/regression/api/v2/admin/redirects_spec.js, core/test/regression/api/v2/admin/schedules_spec.js, core/test/regression/api/v2/admin/settings_spec.js, core/test/regression/api/v2/admin/slack_spec.js, core/test/regression/api/v2/admin/users_spec.js, core/test/regression/api/v2/content/authors_spec.js, core/test/regression/api/v2/content/pages_spec.js, core/test/regression/api/v2/content/posts_spec.js, core/test/regression/api/v2/content/tags_spec.js, core/test/regression/api/v3/admin/authentication_spec.js, core/test/regression/api/v3/admin/db_spec.js, core/test/regression/api/v3/admin/images_spec.js, core/test/regression/api/v3/admin/notifications_spec.js, core/test/regression/api/v3/admin/posts_spec.js, core/test/regression/api/v3/admin/redirects_spec.js, core/test/regression/api/v3/admin/schedules_spec.js, core/test/regression/api/v3/admin/settings_spec.js, core/test/regression/api/v3/admin/slack_spec.js, core/test/regression/api/v3/admin/users_spec.js, core/test/regression/api/v3/content/authors_spec.js, core/test/regression/api/v3/content/pages_spec.js, core/test/regression/api/v3/content/posts_spec.js, core/test/regression/api/v3/content/tags_spec.js, core/test/regression/exporter/exporter_spec.js, core/test/regression/importer/importer_spec.js, core/test/regression/migrations/migration_spec.js, core/test/regression/models/base/listeners_spec.js, core/test/regression/models/model_posts_spec.js, core/test/regression/models/model_users_spec.js, core/test/regression/site/dynamic_routing_spec.js, core/test/regression/site/frontend_spec.js, core/test/regression/site/members_spec.js, core/test/regression/site/site_spec.js, core/test/regression/site/UrlService_spec.js, core/test/regression/update-check/update_check_spec.js
Options: ui="bdd", reporter="spec", timeout="60000", save=undefined, require=["core/server/overrides"], retries="3", exit


  Admin Routing
    Assets
      ✓ should return 404 for unknown assets
      ✓ should retrieve built assets
    Admin Redirects
      ✓ should redirect /GHOST/ to /ghost/
    Require HTTPS - redirect
      ✓ should redirect admin access over non-HTTPS
      ✓ should allow admin access over HTTPS

  Authentication API v3
    Blog setup
      ✓ is setup? no
      ✓ complete setup (140ms)
      ✓ is setup? yes
      ✓ complete setup again
      ✓ update setup (389ms)
    Invitation
      ✓ check invite with invalid email
      ✓ check valid invite
      ✓ check invalid invite
      ✓ try to accept without invite
      ✓ try to accept with invite (111ms)
    Password reset
      ✓ reset password (133ms)
      ✓ reset password: invalid token
      ✓ reset password: generate reset token

  DB API
    - can export the database with more tables
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 committed listeners added to [Function]. Use emitter.setMaxListeners() to increase limit
    ✓ can export & import (455ms)
    ✓ import should fail without file
    ✓ import should fail with unsupported file
    ✓ export can be triggered by backup integration
    ✓ export can not be triggered by integration other than backup
    ✓ export can be triggered by Admin authentication

  Images API
    ✓ Can't import fail without file
    ✓ Can't import with unsupported file
    ✓ Can't upload incorrect extension
    ✓ Can't import if profile image is not square (97ms)

  Members API
    ✓ Can browse
    ✓ Can read
    ✓ Can add (61ms)
    ✓ Should fail when passing incorrect email_type query parameter
    ✓ Can edit by id (39ms)
    - Can set a "Complimentary" subscription
    ✓ Can destroy (58ms)
    ✓ Can export CSV
    ✓ Can import CSV

  Notifications API
    As Editor
      ✓ Add notification
      ✓ Read notifications
    As Author
      ✓ Add notification
      ✓ Read notifications
    Can view by multiple users
      ✓ notification is visible and dismissible by other user (73ms)

  Pages API
    Edit
      ✓ accepts html source (415ms)

  Posts API
    Browse
      ✓ fields & formats combined (70ms)
      ✓ combined fields, formats, include and non existing (78ms)
    Read
      ✓ can't retrieve non existent post
    Add
      ✓ adds default title when it is missing (47ms)
    Edit
      ✓ published_at = null (97ms)
      ✓ html to plaintext (111ms)
      ✓ canonical_url (71ms)
      ✓ update dates & x_by (44ms)
      ✓ Can change scheduled post (46ms)
      ✓ trims title (79ms)
      ✓ strips invisible unicode from slug (76ms)
      ✓ accepts visibility parameter (66ms)
    Destroy
      ✓ non existent post

  Redirects API
    Download
      ✓ file does not exist
      ✓ file exists
    Upload
      Error cases
        ✓ syntax error
        ✓ wrong format: no array
        ✓ wrong format: no from/to
      Ensure re-registering redirects works
        ✓ no redirects file exists (2380ms)
        ✓ override (3408ms)

  Canary Schedules API
    publish
      - publishes posts
      - publishes page
      - no access
      - should fail with invalid resource type
      - published_at is x seconds in past, but still in tolerance
      - not found
      - force publish

  Settings API (canary)
    As Owner
      ✓ Can't read core setting
      ✓ Can't read permalinks
      ✓ can't read non existent setting
      ✓ can toggle member setting
      ✓ can't edit permalinks
      ✓ can't edit non existent setting
      ✓ Will transform "1"
    As Admin
      ✓ cannot toggle member setting
    As Editor
      ✓ should not be able to edit settings
    As Author
      ✓ should not be able to edit settings

  Slack API
    ✓ Can post slack test

  User API
    As Owner
      Read
        ✓ can't retrieve non existent user by id
        ✓ can't retrieve non existent user by slug
      Edit
        ✓ can change the other users password (103ms)
      Destroy
        ✓ [failure] Destroy unknown user id
    As Editor
      success cases
        ✓ can edit himself
      error cases
        ✓ can't edit the owner
        ✓ Cannot transfer ownership to any other user
    As Author
      success cases
        ✓ can edit himself
      error cases
        ✓ can't edit the owner

  Authors Content API
    ✓ can read authors with fields

  api/canary/content/pages
    ✓ Can browse pages with page:false
    ✓ can't read post

  api/canary/content/posts
    ✓ browse posts (46ms)
    ✓ browse posts with related authors/tags also returns primary_author/primary_tag (40ms)
    ✓ browse posts with basic page filter should not return pages
    ✓ browse posts with basic page filter should not return pages
    ✓ browse posts with published and draft status, should not return drafts
    ✓ ensure origin header on redirect is not getting lost
    ✓ can't read page
    ✓ can read post with fields
    content gating
      ✓ public post fields are always visible (93ms)
      ✓ cannot read members only post content
      ✓ cannot read paid only post content
      ✓ cannot read members only post plaintext
      ✓ cannot browse members only posts content (39ms)

  api/canary/content/tags
    ✓ can read tags with fields

  Authentication API v2
    Blog setup: default config
      ✓ is setup? no
      ✓ complete setup (134ms)
      ✓ is setup? yes
      ✓ complete setup again
      ✓ update setup (350ms)
    Blog setup: custom config
      ✓ is setup? no
      ✓ complete setup (123ms)
      ✓ is setup? yes
      ✓ complete setup again
      ✓ update setup (343ms)
    Invitation
      ✓ check invite with invalid email
      ✓ check valid invite
      ✓ check invalid invite
      ✓ try to accept without invite
      ✓ try to accept with invite (114ms)
    Password reset
      ✓ reset password (122ms)
      ✓ reset password: invalid token
      ✓ reset password: generate reset token

  DB API
    - can export the database with more tables
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 committed listeners added to [Function]. Use emitter.setMaxListeners() to increase limit
    ✓ can export & import (367ms)
    ✓ import should fail without file
    ✓ import should fail with unsupported file
    ✓ export can be triggered by backup integration
    ✓ export can not be triggered by integration other than backup
    ✓ export can be triggered by Admin authentication

  Images API
    ✓ Can't import fail without file
    ✓ Can't import with unsupported file
    ✓ Can't upload incorrect extension
    ✓ Can't import if profile image is not square

  Notifications API
    As Editor
      ✓ Add notification
      ✓ Read notifications
    As Author
      ✓ Add notification
      ✓ Read notifications
    Can view by multiple users
      ✓ notification is visible and dismissible by other user (61ms)

  Pages API
    Edit
      ✓ accepts html source (94ms)

  Posts API
    Browse
      ✓ fields & formats combined
      ✓ combined fields, formats, include and non existing
    Read
      ✓ can't retrieve non existent post
    Add
      ✓ adds default title when it is missing (45ms)
    Edit
      ✓ published_at = null (113ms)
      ✓ html to plaintext (100ms)
      ✓ canonical_url (65ms)
      ✓ update dates & x_by (50ms)
      ✓ Can change scheduled post (52ms)
      ✓ trims title (76ms)
      ✓ strips invisible unicode from slug (78ms)
      ✓ accepts visibility parameter (77ms)
    Destroy
      ✓ non existent post

  Redirects API
    Download
      ✓ file does not exist
      ✓ file exists
    Upload
      Error cases
        ✓ syntax error
        ✓ wrong format: no array
        ✓ wrong format: no from/to
      Ensure re-registering redirects works
        ✓ no redirects file exists (2158ms)
        ✓ override (2419ms)

  v2 Schedules API
    publish
      - publishes posts
      - publishes page
      - no access
      - should fail with invalid resource type
      - published_at is x seconds in past, but still in tolerance
      - not found
      - force publish

  Settings API (v2)
    As Owner
      ✓ Can't read core setting
      ✓ Can't read permalinks
      ✓ can't read non existent setting
      ✓ can toggle member setting
      ✓ can't edit permalinks
      ✓ can't edit non existent setting
      ✓ Will transform "1"
    As Admin
Unhandled rejection Error: SQLITE_IOERR: disk I/O error


      ✓ cannot toggle member setting
    As Editor
      ✓ should not be able to edit settings
    As Author
      ✓ should not be able to edit settings

  Slack API
    ✓ Can post slack test

  User API
    As Owner
      Read
        ✓ can't retrieve non existent user by id
        ✓ can't retrieve non existent user by slug
      Edit
        ✓ can change the other users password (98ms)
      Destroy
        ✓ [failure] Destroy unknown user id
    As Editor
      success cases
        ✓ can edit himself
      error cases
        ✓ can't edit the owner (41ms)
        ✓ Cannot transfer ownership to any other user
    As Author
      success cases
        ✓ can edit himself
      error cases
        ✓ can't edit the owner (41ms)

  Authors Content API
    ✓ can read authors with fields

  api/v2/content/pages
    ✓ Can request pages
    ✓ Can browse pages with page:false
    ✓ can't read post

  api/v2/content/posts
    ✓ Can request posts
    ✓ browse posts with basic page filter should not return pages
    ✓ browse posts with basic page filter should not return pages
    ✓ browse posts with published and draft status, should not return drafts
    ✓ ensure origin header on redirect is not getting lost
    ✓ can't read page
    ✓ can read post with fields
    ✓ can't read page with multiple keys
    content gating
      ✓ public post fields are always visible (151ms)
      ✓ cannot read members only post content
      ✓ cannot read paid only post content
      ✓ cannot read members only post plaintext
      ✓ cannot browse members only posts content

  api/v2/content/tags
    ✓ can read tags with fields

  Authentication API v3
    Blog setup
      ✓ is setup? no
      ✓ complete setup (144ms)
      ✓ is setup? yes
      ✓ complete setup again
      ✓ update setup (368ms)
    Invitation
      ✓ check invite with invalid email
      ✓ check valid invite
      ✓ check invalid invite
      ✓ try to accept without invite
      ✓ try to accept with invite (123ms)
    Password reset
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 post.published listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
      ✓ reset password (141ms)
      ✓ reset password: invalid token
      ✓ reset password: generate reset token

  DB API
    - can export the database with more tables
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 committed listeners added to [Function]. Use emitter.setMaxListeners() to increase limit
    ✓ can export & import (373ms)
    ✓ import should fail without file
    ✓ import should fail with unsupported file
    ✓ export can be triggered by backup integration
    ✓ export can not be triggered by integration other than backup
    ✓ export can be triggered by Admin authentication

  Images API
    ✓ Can't import fail without file
    ✓ Can't import with unsupported file
    ✓ Can't upload incorrect extension
    ✓ Can't import if profile image is not square

  Notifications API
    As Editor
      ✓ Add notification
      ✓ Read notifications
    As Author
      ✓ Add notification
      ✓ Read notifications
    Can view by multiple users
      ✓ notification is visible and dismissible by other user (55ms)

  Posts API
    Browse
      ✓ fields & formats combined (51ms)
      ✓ combined fields, formats, include and non existing (59ms)
    Read
      ✓ can't retrieve non existent post
    Add
      ✓ adds default title when it is missing (39ms)
    Edit
      ✓ published_at = null (152ms)
      ✓ html to plaintext (127ms)
      ✓ canonical_url (66ms)
      ✓ update dates & x_by (55ms)
      ✓ Can change scheduled post
      ✓ trims title (76ms)
      ✓ strips invisible unicode from slug (96ms)
    Destroy
      ✓ non existent post

  Redirects API
    Download
      ✓ file does not exist
      ✓ file exists
    Upload
      Error cases
        ✓ syntax error
        ✓ wrong format: no array
        ✓ wrong format: no from/to
      Ensure re-registering redirects works
        ✓ no redirects file exists (2186ms)
Unhandled rejection Error: SQLITE_IOERR: disk I/O error


Unhandled rejection Error: SQLITE_IOERR: disk I/O error


        ✓ override (3194ms)

  v3 Schedules API
    publish
      - publishes posts
      - publishes page
      - no access
      - should fail with invalid resource type
      - published_at is x seconds in past, but still in tolerance
      - not found
      - force publish

  Settings API
    ✓ Can't read core setting
    ✓ Can't read permalinks
    ✓ can't read non existent setting
    ✓ can't edit permalinks
    ✓ can't edit non existent setting
    ✓ Will transform "1"

  Slack API
Unhandled rejection Error: SQLITE_IOERR: disk I/O error


    1) "before all" hook

  User API
    As Owner
      Read
        ✓ can't retrieve non existent user by id
        ✓ can't retrieve non existent user by slug
      Edit
        ✓ can change the other users password (98ms)
      Destroy
        ✓ [failure] Destroy unknown user id
    As Editor
      success cases
        ✓ can edit himself
      error cases
        ✓ can't edit the owner (61ms)
        ✓ Cannot transfer ownership to any other user
    As Author
      success cases
        ✓ can edit himself
      error cases
        ✓ can't edit the owner (55ms)

  Authors Content API
    ✓ can read authors with fields

  api/v3/content/pages
    ✓ Can browse pages with page:false
    ✓ can't read post

  api/v3/content/posts
    ✓ browse posts
    ✓ browse posts with related authors/tags also returns primary_author/primary_tag (45ms)
    ✓ browse posts with basic page filter should not return pages
    ✓ browse posts with basic page filter should not return pages
    ✓ browse posts with published and draft status, should not return drafts
    ✓ ensure origin header on redirect is not getting lost
    ✓ can't read page
    ✓ can read post with fields
    content gating
      ✓ public post fields are always visible (220ms)
      ✓ cannot read members only post content
      ✓ cannot read paid only post content
      ✓ cannot read members only post plaintext
      ✓ cannot browse members only posts content

  api/v3/content/tags
    ✓ can read tags with fields

  Exporter
    ✓ exports data

  Integration: Importer
    Empty database (except of owner user), general tests
      ✓ ensure return structure
      ✓ cares about invalid dates and date formats (98ms)
      ✓ warning that theme was not imported
      ✓ removes duplicate users (185ms)
      ✓ removes duplicate posts (48ms)
      ✓ does not treat posts without slug as duplicate (40ms)
      ✓ can import user with missing allowed fields (106ms)
      ✓ removes duplicate tags and updates associations (56ms)
      ✓ removes broken tags from post (not in db, not in file) (152ms)
      ✓ imports post status (334ms)
      ✓ ensure complex JSON get's fully imported
      ✓ import owner, ensure original owner stays as is (184ms)
      ✓ imports comment_id correctly (38ms)
      ✓ handles validation errors nicely (229ms)
      ✓ does import data with invalid user references (240ms)
      ✓ invalid uuid (622ms)
      ✓ ensure post tag order is correct (1062ms)
      ✓ import multiple users, tags, posts (943ms)
      ✓ can handle if user has multiple roles attached (102ms)
      ✓ can handle related tags with missing optional fields (564ms)
      ✓ can handle uppercase tags (274ms)
      ✓ does not import settings: slack hook, permalinks
      ✓ does import settings with string booleans
      ✓ import comment_id (270ms)
      ✓ ensure authors are imported correctly (1220ms)
      ✓ import 2.0 Koenig post format (291ms)
    Existing database
      ✓ import multiple users, tags, posts (1084ms)

  1.0
    ✓ ensure amp field get's respected (287ms)
    migrate mobiledoc/html
      ✓ invalid mobiledoc structure (301ms)
      ✓ mobiledoc is null, html field is set (145ms)
      ✓ mobiledoc and html is null (148ms)
      ✓ mobiledoc is set and html is null (150ms)
      ✓ post has "kg-card-markdown" class (147ms)
      ✓ import old Koenig Beta post format (273ms)

  LTS
    ✓ disallows importing LTS imports

  Database Migration (special functions)
    Fixtures
      Populate
        ✓ should populate all fixtures correctly (47ms)

  Models: listeners
    on timezone changed
      db has scheduled posts
        ✓ active_timezone changes from London to Los Angeles (272ms)
        ✓ active_timezone changes from Baghdad to UTC (277ms)
        ✓ active_timezone changes from Amsterdam to Seoul (257ms)
      db has no scheduled posts
        ✓ no scheduled posts
    on notifications changed
      ✓ nothing to delete
      ✓ expect deletion (117ms)

  Post Model
    Single author posts
      fetchOne/fetchAll/fetchPage
        findPage
          with more posts/tags
            - can findPage, with various options
            - can findPage for tag, with various options
      edit
        ✓ [failure] multiple edits in one transaction (76ms)
        ✓ multiple edits in one transaction (90ms)
        ✓ can change title (81ms)
        ✓ [failure] custom excerpt soft limit reached (70ms)
        ✓ can publish draft post (77ms)
        ✓ can unpublish published post (85ms)
        ✓ draft -> scheduled without published_at update (74ms)
        ✓ draft -> scheduled: expect update of published_at (80ms)
        ✓ scheduled -> draft: expect unschedule (75ms)
        ✓ scheduled -> scheduled with updated published_at (84ms)
        ✓ scheduled -> scheduled with unchanged published_at (82ms)
        ✓ scheduled -> scheduled with unchanged published_at (within the 2 minutes window) (3088ms)
        ✓ published -> scheduled and expect update of published_at (72ms)
        ✓ can convert draft post to page and back (103ms)
        ✓ can convert draft to schedule AND post to page and back (95ms)
        ✓ can convert published post to page and back (92ms)
        ✓ can change type and status at the same time (103ms)
        ✓ cannot override the published_by setting (97ms)
      add
        ✓ can add, defaults are all correct (105ms)
        ✓ can add, default visibility is taken from settings cache
        ✓ can add, with previous published_at date
        ✓ add draft post without published_at -> we expect no auto insert of published_at
        ✓ add multiple authors
        ✓ add draft post with published_at -> we expect published_at to exist
        ✓ add scheduled post without published_at -> we expect an error
        ✓ add scheduled post with published_at not in future-> we expect an error
        ✓ add scheduled post with published_at 1 minutes in future -> we expect an error
        ✓ add scheduled post with published_at 10 minutes in future -> we expect success
        ✓ can generate a non conflicting slug (314ms)
        ✓ can generate slugs without duplicate hyphens
        ✓ can generate a safe slug when a protected keyword is used
        ✓ can generate slugs without non-ascii characters
        ✓ detects duplicate slugs before saving (53ms)
        ✓ transforms absolute urls to relative
      destroy
        ✓ published post (187ms)
        ✓ draft post (194ms)
        ✓ published page (185ms)
        ✓ draft page (190ms)
      Collision Protection
        ✓ update post title, but updated_at is out of sync (74ms)
        ✓ update post tags and updated_at is out of sync
        ✓ update post authors and updated_at is out of sync
        ✓ update post tags and updated_at is NOT out of sync (53ms)
        ✓ update post with no changes, but updated_at is out of sync (198ms)
        ✓ update post with old post title, but updated_at is out of sync
    mobiledoc versioning
      ✓ can create revisions (96ms)
      ✓ keeps only 10 last revisions in FIFO style (411ms)
      ✓ creates 2 revisions after first edit for previously unversioned post (84ms)
    Multiauthor Posts
      ✓ can destroy multiple posts by author (919ms)
    Post tag handling edge cases
      ✓ should create the test data correctly
      ✓ can edit slug of existing tag (157ms)
      ✓ can't edit dates and authors of existing tag (1035ms)
      ✓ can reorder existing, added and deleted tags (174ms)
      ✓ can add multiple tags with conflicting slugs (186ms)
      ✓ can handle lowercase/uppercase tags (170ms)

  User Model
    Registration
      ✓ can add first (133ms)
      ✓ shortens slug if possible (135ms)
      ✓ does not short slug if not possible (389ms)
      ✓ does NOT lowercase email (130ms)
      ✓ can find gravatar (129ms)
      ✓ can handle no gravatar (131ms)
      ✓ can find by email and is case insensitive (133ms)
    Basic Operations
      ✓ sets last login time on successful login (91ms)
      ✓ converts fetched dateTime fields to Date objects (93ms)
      ✓ can findPage with limit all (393ms)
      ✓ can findOne by role name (399ms)
      ✓ can invite user (98ms)
      ✓ can add active user (99ms)
      ✓ can NOT add active user with invalid email address (83ms)
      ✓ can edit active user
      ✓ can NOT set an invalid email address
      ✓ can NOT set an already existing email address
      ✓ can edit invited user (102ms)
      ✓ can activate invited user (104ms)
      ✓ can destroy invited user (110ms)
    Password change
      error
        ✓ wrong old password (80ms)
        ✓ too short password (81ms)
        ✓ very bad password (80ms)
        ✓ password matches users email adress (82ms)
        ✓ password contains words "ghost" or "password" (81ms)
        ✓ password matches blog URL (79ms)
        ✓ password contains repeating chars (79ms)
        ✓ password contains repeating numbers (80ms)
    User setup
      ✓ setup user (92ms)

  Dynamic Routing
    Collection Index
      ✓ should respond with html (189ms)
      ✓ should not have a third page
      RSS
        ✓ should 301 redirect with CC=1year without slash
        ✓ should respond with 200 & CC=public (73ms)
        ✓ should get 301 redirect with CC=1year to /rss/ from /feed/
    Collection Entry
      ✓ should render page with slug permalink (169ms)
      ✓ should not render page with dated permalink
    Tag
      ✓ should return HTML for valid route (67ms)
      ✓ should 404 for /tag/ route
      ✓ should 404 for unknown tag
      ✓ should 404 for unknown tag with invalid characters
      RSS
        ✓ should redirect without slash
        ✓ should respond with xml (49ms)
      Edit
        ✓ should redirect without slash
        ✓ should redirect to tag settings
        ✓ should 404 for non-edit parameter
      Edit with admin redirects disabled
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 post.published.edited listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 post.unpublished listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 page.published listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 page.published.edited listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 page.unpublished listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 tag.added listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 tag.edited listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 tag.deleted listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
        ✓ should redirect without slash
        ✓ should not redirect to admin
      Paged
        - should redirect without slash
        - should respond with html
        - should redirect page 1
        - should 404 if page too high
        - should 404 if page too low
        RSS
          - should 404 if index attempted with 0
          - should 404 if index attempted with 1
          - should 404 for other pages
    Author
      ✓ should 404 for /author/ route (162ms)
      ✓ should 404 for unknown author
      ✓ should 404 for unknown author with invalid characters
      ✓ [success] author is locked
      ✓ [success] author is suspended
      ✓ [failure] ghost owner before blog setup
      ✓ [success] ghost owner after blog setup (91ms)
      RSS
        ✓ should redirect without slash
        ✓ should respond with xml
      Edit
        ✓ should redirect without slash
        ✓ should redirect to editor
        ✓ should 404 for something that isn't edit
      Edit with admin redirects disabled
        ✓ should redirect without slash
        ✓ should not redirect to admin
      Paged
        ✓ should redirect without slash
        ✓ should respond with html (105ms)
        ✓ should redirect page 1
        ✓ should 404 if page too high
        ✓ should 404 if page too low
        RSS
          ✓ should 404 if index attempted with 0
          ✓ should 404 if index attempted with 1
          ✓ should 404 for other pages
    Reload routes.yaml
      ✓ confirm current routing pattern (154ms)
      ✓ simulate upload of routes.yaml (1008ms)
      ✓ serve welcome post with old permalink structure
      ✓ serve welcome post with new permalink structure
      ✓ serve welcome post with new permalink structure and old date
      ✓ serve serve rss
      ✓ serve collection index
      ✓ serve tag (41ms)

  Frontend Routing
    Test with Initial Fixtures
      Error
        ✓ should 404 for unknown post
        ✓ should 404 for unknown post with invalid characters
        ✓ should 404 for unknown frontend route
        ✓ should 404 for encoded char not 301 from uncapitalise
        ✓ should 404 for unknown file
      Single post
        ✓ should redirect without slash
        ✓ should redirect uppercase
        ✓ should sanitize double slashes when redirecting uppercase
        ✓ should respond with html for valid post url (75ms)
        ✓ should not work with date permalinks
      Post edit
        ✓ should redirect without slash
        ✓ should redirect to editor
        ✓ should 404 for non-edit parameter
      Post edit with admin redirects disabled
        ✓ should redirect without slash
        ✓ should not redirect to editor
      AMP post
        ✓ should redirect without slash
        ✓ should redirect uppercase
        ✓ should respond with html for valid url (170ms)
        ✓ should not work with date permalinks
        ✓ should redirect to regular post when AMP is disabled
        ✓ should redirect to regular post with query params when AMP is disabled
      Static assets
        ✓ should retrieve theme assets
        ✓ should retrieve default robots.txt
        ✓ should retrieve default favicon.ico
    Test with added posts
      Static page
        ✓ should respond with html (116ms)
        ✓ should redirect without slash
        edit
          ✓ should redirect without slash
          ✓ should redirect to editor
          ✓ should 404 for non-edit parameter
        edit with admin redirects disabled
          ✓ should redirect without slash
          ✓ should not redirect to editor (122ms)
        amp
          ✓ should 404 for amp parameter (114ms)
      Post preview
        ✓ should display draft posts accessed via uuid (49ms)
        ✓ should redirect published posts to their live url
        ✓ 404s unknown uuids
      Post with Ghost in the url
        ✓ should retrieve a blog post with ghost at the start of the url (56ms)
    Site Map
      ✓ should serve sitemap.xml
      ✓ should serve sitemap-posts.xml
      ✓ should serve sitemap-pages.xml
      ✓ should serve sitemap-tags.xml
      ✓ should serve sitemap-users.xml
    Subdirectory (no slash)
      ✓ http://localhost should 404
      ✓ http://localhost/ should 404
      ✓ http://localhost/blog should 301 to  http://localhost/blog/
      ✓ http://localhost/blog/ should 200 (44ms)
      ✓ http://localhost/blog/welcome should 301 to http://localhost/blog/welcome/
      ✓ http://localhost/blog/welcome/ should 200 (54ms)
      ✓ /blog/tag/getting-started should 301 to /blog/tag/getting-started/
      ✓ /blog/tag/getting-started/ should 200 (42ms)
      ✓ /blog/welcome/amp/ should 200
    Subdirectory (with slash)
      ✓ http://localhost should 404
      ✓ http://localhost/ should 404
      ✓ /blog should 301 to /blog/
      ✓ /blog/ should 200 (42ms)
      ✓ /blog/welcome should 301 to /blog/welcome/
      ✓ /blog/welcome/ should 200 (64ms)
      ✓ /blog/tag/getting-started should 301 to /blog/tag/getting-started/
      ✓ /blog/tag/getting-started/ should 200 (45ms)
      ✓ /blog/welcome/amp/ should 200
      ✓ should uncapitalise correctly with 301 to subdir
    HTTPS
      ✓ should set links to url over non-HTTPS
      ✓ should set links over HTTPS besides canonical (53ms)
    Redirects (use redirects.json from test/utils/fixtures/data)
      1 case
        ✓ with trailing slash
        ✓ without trailing slash
        ✓ with query params
        ✓ with query params
        ✓ with case insensitive
        ✓ with case sensitive
        ✓ defaults to case sensitive
        ✓ should not redirect with case sensitive
        ✓ should not redirect with default case sensitive
      2 case
        ✓ with trailing slash
        ✓ without trailing slash
      3 case
        ✓ with trailing slash
        ✓ without trailing slash
      4 case
        ✓ with trailing slash
        ✓ without trailing slash
      5 case
        ✓ with trailing slash
        ✓ without trailing slash
      6 case
        ✓ with trailing slash
        ✓ without trailing slash
      7 case
        ✓ with trailing slash
      last case
        ✓ default
        ✓ with a custom path
      external url redirect
        ✓ with trailing slash
        ✓ without trailing slash

  Integration - Web - Members
    Members enabled
      Static files
        ✓ should serve members.js file
      Routes
        ✓ should error when invalid member token is passed in to ssr
        ✓ should return no content when removing member sessions
        ✓ should error serving webhook endpoint without any parameters
    Members disabled
      Static files
        ✓ should not serve members js file
      Routes
        ✓ should not serve ssr endpoint
        ✓ should not serve ssr removal endpoint
        ✓ should not serve webhook endpoint

  Integration - Web - Site
    v2
      default routes.yaml
        behaviour: default cases
(node:6021) [DEP0066] DeprecationWarning: OutgoingMessage.prototype._headers is deprecated
          ✓ serve post (75ms)
          ✓ serve amp
          ✓ post not found (41ms)
          ✓ serve static page
          ✓ serve author (45ms)
          ✓ serve tag (43ms)
          ✓ serve tag rss
          ✓ serve collection (40ms)
          ✓ serve collection: page 2
          ✓ serve theme asset
        behaviour: prettify
          ✓ url without slash
        behaviour: url redirects
          pagination
            ✓ redirect /page/1/ to /
          rss
            ✓ redirect /feed/ to /rss/
      https
        protocol
          ✓ blog is https, request is http
          ✓ blog is https, request is http, trailing slash exists already
        assets
          ✓ blog is https, request is http
          ✓ blog is https, request is http
      extended routes.yaml: collections
        2 collections
          ✓ serve static route
          ✓ serve rss
          ✓ serve post
          ✓ serve collection: podcast with default template
          ✓ serve collection: something with custom template
        no collections
          ✓ serve route
        static permalink route
          ✓ serve post
          ✓ serve post (66ms)
          ✓ serve author
          ✓ serve tag
        primary author permalink
          ✓ serve post (68ms)
          ✓ post without author
          ✓ page
        primary tag permalink
          ✓ serve post (54ms)
          ✓ post without tag
          ✓ post without tag
          ✓ page
        collection/routes with data key
          ✓ serve /food/ (42ms)
          ✓ serve bacon tag
          ✓ serve /sport/ (46ms)
          ✓ serve chorizo tag (38ms)
          ✓ serve my-page
      extended routes.yaml: templates
        default template, no template
          ✓ serve collection
          ✓ serve second collectiom
        two templates
          ✓ serve collection
        home.hbs priority
          ✓ serve collection
          ✓ serve second page collection: should use index.hbs
      extended routes.yaml: routes
        channels
(node:6021) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 101 server.start listeners added to [EventRegistry]. Use emitter.setMaxListeners() to increase limit
          ✓ serve channel 1
          ✓ serve channel 1: rss
          ✓ serve channel 2
          ✓ serve channel 3
          ✓ serve channel 4
          ✓ serve channel 5
          ✓ serve channel 6
          ✓ serve kitching-sink: redirect
          ✓ serve html-ipsum: redirect
          ✓ serve chorizo: no redirect
          ✓ serve joe-bloggs
      extended routes.yaml (5): rss override
        ✓ serve /rss/
        ✓ serve /music/rss/
        ✓ serve /cooking/rss/
        ✓ serve /flat/rss/
        ✓ serve /podcast/rss/
        ✓ serve /podcast/
    canary
      default routes.yaml
        behaviour: default cases
          ✓ serve post (70ms)
          ✓ serve amp
          ✓ post not found
          ✓ serve static page
          ✓ serve author (46ms)
          ✓ serve tag (54ms)
          ✓ serve tag rss
          ✓ serve collection (41ms)
          ✓ serve collection: page 2
          ✓ serve theme asset
        behaviour: prettify
          ✓ url without slash
        behaviour: url redirects
          pagination
            ✓ redirect /page/1/ to /
          rss
            ✓ redirect /feed/ to /rss/
      https
        protocol
          ✓ blog is https, request is http
          ✓ blog is https, request is http, trailing slash exists already
        assets
          ✓ blog is https, request is http
          ✓ blog is https, request is http
      extended routes.yaml: collections
        2 collections
          ✓ serve static route
          ✓ serve rss
          ✓ serve post
          ✓ serve collection: podcast with default template
          ✓ serve collection: something with custom template
        no collections
          ✓ serve route
        static permalink route
          ✓ serve post
          ✓ serve post (54ms)
          ✓ serve author
          ✓ serve tag
        primary author permalink
          ✓ serve post (57ms)
          ✓ post without author
          ✓ page
        primary tag permalink
          ✓ serve post (51ms)
          ✓ post without tag
          ✓ post without tag
          ✓ page
        collection/routes with data key
          ✓ serve /food/
          ✓ serve bacon tag
          ✓ serve /sport/
          ✓ serve chorizo tag
          ✓ serve my-page
      extended routes.yaml: templates
        default template, no template
          ✓ serve collection
          ✓ serve second collectiom
        two templates
          ✓ serve collection
        home.hbs priority
          ✓ serve collection
          ✓ serve second page collection: should use index.hbs
      extended routes.yaml: routes
        channels
          ✓ serve channel 1
          ✓ serve channel 1: rss
          ✓ serve channel 2
          ✓ serve channel 3
          ✓ serve channel 4
          ✓ serve channel 5
          ✓ serve channel 6 (44ms)
          ✓ serve kitching-sink: redirect
          ✓ serve html-ipsum: redirect
          ✓ serve chorizo: no redirect
          ✓ serve joe-bloggs
      extended routes.yaml (5): rss override
        ✓ serve /rss/
        ✓ serve /music/rss/
        ✓ serve /cooking/rss/
        ✓ serve /flat/rss/
        ✓ serve /podcast/rss/
        ✓ serve /podcast/
    v3
      default routes.yaml
        behaviour: default cases
          ✓ serve post (57ms)
          ✓ serve amp
          ✓ post not found
          ✓ serve static page
          ✓ serve author (41ms)
          ✓ serve tag
          ✓ serve tag rss
          ✓ serve collection
          ✓ serve collection: page 2
          ✓ serve theme asset
        behaviour: prettify
          ✓ url without slash
        behaviour: url redirects
          pagination
            ✓ redirect /page/1/ to /
          rss
            ✓ redirect /feed/ to /rss/
      https
        protocol
          ✓ blog is https, request is http
          ✓ blog is https, request is http, trailing slash exists already
        assets
          ✓ blog is https, request is http
          ✓ blog is https, request is http
      extended routes.yaml: collections
        2 collections
          ✓ serve static route
          ✓ serve rss
          ✓ serve post
          ✓ serve collection: podcast
          ✓ serve collection: something with custom template
        no collections
          ✓ serve route
        static permalink route
          ✓ serve post
          ✓ serve post (52ms)
          ✓ serve author
          ✓ serve tag
        primary author permalink
          ✓ serve post (53ms)
          ✓ post without author
          ✓ page
        primary tag permalink
          ✓ serve post (57ms)
          ✓ post without tag
          ✓ post without tag
          ✓ page
        collection/routes with data key
          ✓ serve /food/ (40ms)
          ✓ serve bacon tag
          ✓ serve /sport/
          ✓ serve chorizo tag
          ✓ serve my-page
      extended routes.yaml: templates
        default template, no template
          ✓ serve collection
          ✓ serve second collectiom
        two templates
          ✓ serve collection
        home.hbs priority
          ✓ serve collection
          ✓ serve second page collection: should use index.hbs
      extended routes.yaml: routes
        channels
          ✓ serve channel 1
          ✓ serve channel 1: rss
          ✓ serve channel 2
          ✓ serve channel 3
          ✓ serve channel 4
          ✓ serve channel 5
          ✓ serve channel 6
          ✓ serve kitching-sink: redirect
          ✓ serve html-ipsum: redirect
          ✓ serve chorizo: no redirect
          ✓ serve joe-bloggs
      extended routes.yaml (5): rss override
        ✓ serve /rss/
        ✓ serve /music/rss/
        ✓ serve /cooking/rss/
        ✓ serve /flat/rss/
        ✓ serve /podcast/rss/
        ✓ serve /podcast/
    parent app vhosts
      no separate admin
        ✓ loads the front-end on configured url
        ✓ loads the front-end on localhost
        ✓ loads the admin
        ✓ loads the admin on localhost
        ✓ loads the api
        ✓ loads the api on localhost
      separate admin host
        ✓ loads the front-end on configured url (38ms)
        ✓ loads the front-end on localhost (38ms)
        ✓ redirects /ghost/ on configured url
        ✓ 404s the api on configured url
        ✓ 404s the api on localhost
        ✓ loads the admin on configured admin url
        ✓ loads the api on configured admin url
        ✓ redirects to the correct protocol on configured admin url
        ✓ 404s the front-end on configured admin url
      separate admin host w/ admin redirects disabled
        ✓ does not redirect /ghost/ on configured url
      same host separate protocol
        ✓ loads the front-end on configured url (http)
        ✓ 404s the front-end on configured url (https) (38ms)
        ✓ loads the front-end on localhost
        ✓ redirects /ghost/ on configured url
        ✓ redirects /ghost/ on localhost
        ✓ redirects api to correct protocol on configured admin url
        ✓ loads the admin on configured admin url
        ✓ redirects the admin on localhost
        ✓ loads the api on configured admin url
        ✓ redirects the api on localhost

  Integration: services/url/UrlService
    functional: default routing set
      ✓ check url generators
      ✓ getUrl
      ✓ getResource
    functional: extended/modified routing set
      ✓ check url generators
      ✓ getUrl
    functional: subdirectory
      ✓ check url generators
      ✓ getUrl

  Update Check
    fn: updateCheck
      ✓ update check was never executed
      ✓ update check won't happen if it's too early
      ✓ update check will happen if it's time to check
    fn: updateCheckData
      ✓ should report the correct data (174ms)
    fn: createCustomNotification
      ✓ should create a release notification for target version
      ✓ release notification version format is wrong
      ✓ blog version format is wrong
      ✓ should create a custom notification
      ✓ should not add duplicates
    fn: updateCheckResponse
      ✓ receives a notifications with messages
      ✓ receives multiple notifications
      ✓ ignores some custom notifications which are not marked as group
      ✓ group matches
      ✓ single custom notification received, group matches
      ✓ single custom notification received, group does not match
    fn: updateCheckRequest
      ✓ [default]
      ✓ privacy flag is used
      ✓ received 500 from the service
      ✓ received 404 from the service
      ✓ custom url


  774 passing (8m)
  35 pending
  1 failing

  1) Slack API
       "before all" hook:
     NotFoundError: Integration not found.
    at new NotFoundError (node_modules/ghost-ignition/lib/errors/index.js:106:23)
    at Child.<anonymous> (core/server/adapters/scheduling/post-scheduling/index.js:20:23)
    at Child.tryCatcher (node_modules/bookshelf/node_modules/bluebird/js/release/util.js:16:23)
    at Promise._settlePromiseFromHandler (node_modules/bookshelf/node_modules/bluebird/js/release/promise.js:547:31)
    at Promise._settlePromise (node_modules/bookshelf/node_modules/bluebird/js/release/promise.js:604:18)
    at Promise._settlePromise0 (node_modules/bookshelf/node_modules/bluebird/js/release/promise.js:649:10)
    at Promise._settlePromises (node_modules/bookshelf/node_modules/bluebird/js/release/promise.js:729:18)
    at _drainQueueStep (node_modules/bookshelf/node_modules/bluebird/js/release/async.js:93:12)
    at _drainQueue (node_modules/bookshelf/node_modules/bluebird/js/release/async.js:86:9)
    at Async._drainQueues (node_modules/bookshelf/node_modules/bluebird/js/release/async.js:102:5)
    at Immediate.Async.drainQueues [as _onImmediate] (node_modules/bookshelf/node_modules/bluebird/js/release/async.js:15:14)
    at processImmediate (internal/timers.js:439:21)
    at process.topLevelDomainCallback (domain.js:130:23)
  



Warning:  Use --force to continue.

Aborted due to warnings.
error Command failed with exit code 3.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
travis_time:end:003b23c8:start=1580331030895015617,finish=1580331511101083772,duration=480206068155,event=script
[0K[31;1mThe command "if [[ "$TRAVIS_PULL_REQUEST_BRANCH" =~ ^renovate || "$TRAVIS_EVENT_TYPE" == "cron" ]]; then
  yarn ci:regression
else
  yarn ci
fi
" exited with 3.[0m
travis_fold:start:cache.2
[0Kstore build cache
travis_time:start:09a0817a
[0Ktravis_time:end:09a0817a:start=1580331511108208752,finish=1580331511110790466,duration=2581714,event=cache
[0Ktravis_time:start:08d006a2
[0K[32;1mnothing changed[0m
travis_time:end:08d006a2:start=1580331511114267513,finish=1580331516162674731,duration=5048407218,event=cache
[0Ktravis_fold:end:cache.2
[0K

Done. Your build exited with 1.