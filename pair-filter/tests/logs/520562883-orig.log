travis_fold:start:worker_info[0K[33;1mWorker information[0m
hostname: 2d0f43f8-52de-47fa-b662-08e4558c8b32@1.production-2-worker-org-gce-2zlz
version: v6.2.0 https://github.com/travis-ci/worker/tree/5e5476e01646095f48eec13196fdb3faf8f5cbf7
instance: travis-job-52def953-e48a-401c-ac26-3cfde38a8d94 travis-ci-sardonyx-xenial-1553530528-f909ac5 (via amqp)
startup: 6.579865744s
travis_fold:end:worker_info[0Ktravis_fold:start:system_info[0K[33;1mBuild system information[0m
Build language: node_js
Build group: stable
Build dist: xenial
Build id: 520562882
Job id: 520562883
Runtime kernel version: 4.15.0-1028-gcp
travis-build version: 9b2b201a2
[34m[1mBuild image provisioning date and time[0m
Mon Mar 25 16:43:24 UTC 2019
[34m[1mOperating System Details[0m
Distributor ID:	Ubuntu
Description:	Ubuntu 16.04.6 LTS
Release:	16.04
Codename:	xenial
[34m[1mSystemd Version[0m
systemd 229
[34m[1mCookbooks Version[0m
42e42e4 https://github.com/travis-ci/travis-cookbooks/tree/42e42e4
[34m[1mgit version[0m
git version 2.21.0
[34m[1mbash version[0m
GNU bash, version 4.3.48(1)-release (x86_64-pc-linux-gnu)
[34m[1mgcc version[0m
gcc (Ubuntu 5.4.0-6ubuntu1~16.04.11) 5.4.0 20160609
[34m[1mdocker version[0m
Client:
 Version:           18.06.0-ce
 API version:       1.38
 Go version:        go1.10.3
 Git commit:        0ffa825
 Built:             Wed Jul 18 19:11:02 2018
 OS/Arch:           linux/amd64
 Experimental:      false

Server:
 Engine:
  Version:          18.06.0-ce
  API version:      1.38 (minimum version 1.12)
  Go version:       go1.10.3
  Git commit:       0ffa825
  Built:            Wed Jul 18 19:09:05 2018
  OS/Arch:          linux/amd64
  Experimental:     false
[34m[1mclang version[0m
clang version 7.0.0 (tags/RELEASE_700/final)
[34m[1mjq version[0m
jq-1.5
[34m[1mbats version[0m
Bats 0.4.0
[34m[1mshellcheck version[0m
0.6.0
[34m[1mshfmt version[0m
v2.6.3
[34m[1mccache version[0m
3.2.4
[34m[1mcmake version[0m
cmake version 3.12.4
[34m[1mheroku version[0m
heroku/7.22.7 linux-x64 node-v11.10.1
[34m[1mimagemagick version[0m
Version: ImageMagick 6.8.9-9 Q16 x86_64 2018-09-28 http://www.imagemagick.org
[34m[1mmd5deep version[0m
4.4
[34m[1mmercurial version[0m
version 4.8
[34m[1mmysql version[0m
mysql  Ver 14.14 Distrib 5.7.25, for Linux (x86_64) using  EditLine wrapper
[34m[1mopenssl version[0m
OpenSSL 1.0.2g  1 Mar 2016
[34m[1mpacker version[0m
1.3.3
[34m[1mpostgresql client version[0m
psql (PostgreSQL) 10.7 (Ubuntu 10.7-1.pgdg16.04+1)
[34m[1mragel version[0m
Ragel State Machine Compiler version 6.8 Feb 2013
[34m[1msudo version[0m
1.8.16
[34m[1mgzip version[0m
gzip 1.6
[34m[1mzip version[0m
Zip 3.0
[34m[1mvim version[0m
VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Nov 24 2016 16:44:48)
[34m[1miptables version[0m
iptables v1.6.0
[34m[1mcurl version[0m
curl 7.47.0 (x86_64-pc-linux-gnu) libcurl/7.47.0 GnuTLS/3.4.10 zlib/1.2.8 libidn/1.32 librtmp/2.3
[34m[1mwget version[0m
GNU Wget 1.17.1 built on linux-gnu.
[34m[1mrsync version[0m
rsync  version 3.1.1  protocol version 31
[34m[1mgimme version[0m
v1.5.3
[34m[1mnvm version[0m
0.34.0
[34m[1mperlbrew version[0m
/home/travis/perl5/perlbrew/bin/perlbrew  - App::perlbrew/0.86
[34m[1mphpenv version[0m
rbenv 1.1.2
[34m[1mrvm version[0m
rvm 1.29.7 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io]
[34m[1mdefault ruby version[0m
ruby 2.5.3p105 (2018-10-18 revision 65156) [x86_64-linux]
[34m[1mCouchDB version[0m
couchdb 1.6.1
[34m[1mElasticSearch version[0m
5.5.0
[34m[1mInstalled Firefox version[0m
firefox 63.0.1
[34m[1mMongoDB version[0m
MongoDB 4.0.7
[34m[1mPhantomJS version[0m
2.1.1
[34m[1mPre-installed PostgreSQL versions[0m
9.4.21
9.5.16
9.6.12
[34m[1mRedis version[0m
redis-server 5.0.4
[34m[1mPre-installed Go versions[0m
1.11.1
[34m[1mmvn version[0m
Apache Maven 3.6.0 (97c98ec64a1fdfee7767ce5ffb20918da4f719f3; 2018-10-24T18:41:47Z)
[34m[1mgradle version[0m
Gradle 4.10.2!
[34m[1mlein version[0m
Leiningen 2.9.1 on Java 11.0.2 OpenJDK 64-Bit Server VM
[34m[1mPre-installed Node.js versions[0m
v10.15.3
v11.0.0
v4.9.1
v6.17.0
v8.12.0
v8.15.1
v8.9
[34m[1mphpenv versions[0m
  system
  5.6
  5.6.40
  7.1
  7.1.27
  7.2
* 7.2.15 (set by /home/travis/.phpenv/version)
  hhvm
  hhvm-stable
[34m[1mcomposer --version[0m
Composer version 1.8.4 2019-02-11 10:52:10
[34m[1mPre-installed Ruby versions[0m
ruby-2.3.8
ruby-2.4.5
ruby-2.5.3
travis_fold:end:system_info[0K
travis_fold:start:services[0Ktravis_time:start:1cf8a758[0K$ sudo systemctl start mysql
travis_time:end:1cf8a758:start=1555381835971493122,finish=1555381837054540928,duration=1083047806[0Ktravis_fold:end:services[0K
travis_fold:start:git.checkout[0Ktravis_time:start:1bd98e72[0K$ git clone --depth=50 --branch=master https://github.com/TryGhost/Ghost.git TryGhost/Ghost
Cloning into 'TryGhost/Ghost'...
travis_time:end:1bd98e72:start=1555381840101096033,finish=1555381841820299627,duration=1719203594[0K$ cd TryGhost/Ghost
$ git checkout -qf 62f5bdac4cd9bca12150ec75b897990d7b6072be
travis_fold:end:git.checkout[0K
travis_fold:start:git.submodule[0Ktravis_time:start:04aa066c[0K$ git submodule update --init --recursive
Submodule 'content/themes/casper' (https://github.com/TryGhost/Casper.git) registered for path 'content/themes/casper'
Submodule 'core/client' (https://github.com/TryGhost/Ghost-Admin.git) registered for path 'core/client'
Cloning into '/home/travis/build/TryGhost/Ghost/content/themes/casper'...
Cloning into '/home/travis/build/TryGhost/Ghost/core/client'...
Submodule path 'content/themes/casper': checked out 'fef2307d6df1d1b13bbb3dd9514dea13d69617c7'
Submodule path 'core/client': checked out '7429fe5c3ac0ebd2411b89b50c3a0ffaaff59d02'
travis_time:end:04aa066c:start=1555381841965279757,finish=1555381846863732027,duration=4898452270[0Ktravis_fold:end:git.submodule[0K
[33;1mSetting environment variables from repository settings[0m
$ export PUSH_TOKEN=[secure]
$ export SLACK_URL=[secure]

[33;1mSetting environment variables from .travis.yml[0m
$ export DB=sqlite3
$ export NODE_ENV=testing

travis_fold:start:nvm.install[0Ktravis_time:start:04eb77ea[0K$ nvm install 10
Downloading and installing node v10.15.3...
Downloading https://nodejs.org/dist/v10.15.3/node-v10.15.3-linux-x64.tar.xz...
Computing checksum with sha256sum
Checksums matched!
Now using node v10.15.3 (npm v6.4.1)
travis_time:end:04eb77ea:start=1555381848110884485,finish=1555381851850002704,duration=3739118219[0Ktravis_fold:end:nvm.install[0K
travis_fold:start:cache.1[0KSetting up build cache
$ export CASHER_DIR=${TRAVIS_HOME}/.casher
travis_time:start:03e7d8f0[0K$ Installing caching utilities
travis_time:end:03e7d8f0:start=1555381853491639891,finish=1555381853803916545,duration=312276654[0Ktravis_time:start:0ff7caa6[0Ktravis_time:end:0ff7caa6:start=1555381853812004736,finish=1555381853816286027,duration=4281291[0Ktravis_time:start:00209a14[0K[32;1mattempting to download cache archive[0m
[32;1mfetching master/cache-linux-xenial-5a3c100ba51fc69c8c697d48d568d5385090fa49b62c5f41af6060673e12489d--node-10.tgz[0m
[32;1mfound cache[0m
travis_time:end:00209a14:start=1555381853823549106,finish=1555381856255312872,duration=2431763766[0Ktravis_fold:end:cache.1[0K
travis_fold:start:cache.yarn[0K
travis_time:start:06f7a5ca[0Ktravis_time:end:06f7a5ca:start=1555381856264370656,finish=1555381856269379653,duration=5008997[0Ktravis_time:start:0974fe88[0K[32;1madding /home/travis/.cache/yarn to cache[0m
travis_time:end:0974fe88:start=1555381856277292826,finish=1555381862513661208,duration=6236368382[0Ktravis_fold:end:cache.yarn[0K$ node --version
v10.15.3
$ npm --version
6.4.1
$ nvm --version
0.34.0
$ yarn --version
1.15.2

travis_fold:start:install[0Ktravis_time:start:04e7880c[0K$ yarn
yarn install v1.15.2
[1/5] Validating package.json...
warning ghost@2.19.4: The engine "cli" appears to be invalid.
[2/5] Resolving packages...
[3/5] Fetching packages...
[4/5] Linking dependencies...
[5/5] Building fresh packages...
Done in 32.48s.
travis_time:end:04e7880c:start=1555381863700041555,finish=1555381896432358240,duration=32732316685[0Ktravis_fold:end:install[0Ktravis_fold:start:before_script.1[0Ktravis_time:start:00126464[0K$ if [ $DB == "mysql" ]; then mysql -e 'create database ghost_testing'; fi
travis_time:end:00126464:start=1555381896440627716,finish=1555381896446424026,duration=5796310[0Ktravis_fold:end:before_script.1[0Ktravis_fold:start:before_script.2[0Ktravis_time:start:147a9e2a[0K$ if [ "$DB" == "sqlite3" ]; then yarn add --force sqlite3; fi
yarn add v1.15.2
[1/5] Validating package.json...
warning ghost@2.19.4: The engine "cli" appears to be invalid.
[2/5] Resolving packages...
[3/5] Fetching packages...
[4/5] Linking dependencies...
[5/5] Rebuilding all packages...
success Saved lockfile.
warning "sqlite3" is already in "optionalDependencies". Please remove existing entry first before adding it to "dependencies".
success Saved 1 new dependency.
info Direct dependencies
â””â”€ sqlite3@4.0.6
info All dependencies
â””â”€ sqlite3@4.0.6
Done in 24.09s.
travis_time:end:147a9e2a:start=1555381896454741236,finish=1555381920795310476,duration=24340569240[0Ktravis_fold:end:before_script.2[0Ktravis_time:start:032e1f9d[0K$ if [ "$TEST_SUITE" == "lint" ]; then
  yarn lint
elif [[ "$TRAVIS_PULL_REQUEST_BRANCH" =~ ^renovate || "$TRAVIS_EVENT_TYPE" == "cron" ]]; then
  yarn ci:regression
else
  yarn ci
fi

yarn run v1.15.2
$ grunt validate --verbose
Initializing
Command-line options: --verbose, --gruntfile=/home/travis/build/TryGhost/Ghost/Gruntfile.js

Reading "Gruntfile.js" Gruntfile...OK

Registering Gruntfile tasks.

Registering "grunt-bg-shell" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-bg-shell/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-bg-shell/package.json...OK
Loading "bg-shell.coffee" tasks...OK
+ bgShell
Loading "child-process.coffee" tasks...OK
>> No tasks were registered or unregistered.

Registering "grunt-contrib-clean" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-clean/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-clean/package.json...OK
Loading "clean.js" tasks...OK
+ clean

Registering "grunt-contrib-compress" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-compress/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-compress/package.json...OK
Loading "compress.js" tasks...OK
+ compress

Registering "grunt-contrib-copy" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-copy/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-copy/package.json...OK
Loading "copy.js" tasks...OK
+ copy

Registering "grunt-contrib-symlink" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-symlink/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-symlink/package.json...OK
Loading "symlink.js" tasks...OK
+ symlink

Registering "grunt-contrib-uglify" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-uglify/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-uglify/package.json...OK
Loading "uglify.js" tasks...OK
+ uglify

Registering "grunt-contrib-watch" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-watch/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-contrib-watch/package.json...OK
Loading "watch.js" tasks...OK
+ watch

Registering "grunt-cssnano" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-cssnano/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-cssnano/package.json...OK
Loading "cssnano.js" tasks...OK
+ cssnano

Registering "grunt-express-server" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-express-server/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-express-server/package.json...OK
Loading "express.js" tasks...OK
+ express

Registering "grunt-mocha-cli" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/package.json...OK
Loading "mochacli.js" tasks...OK
+ mochacli

Registering "grunt-shell" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-shell/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-shell/package.json...OK
Loading "shell.js" tasks...OK
+ shell

Registering "grunt-subgrunt" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-subgrunt/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-subgrunt/package.json...OK
Loading "subgrunt.js" tasks...OK
+ subgrunt

Registering "grunt-update-submodules" local Npm module tasks.
Reading /home/travis/build/TryGhost/Ghost/node_modules/grunt-update-submodules/package.json...OK
Parsing /home/travis/build/TryGhost/Ghost/node_modules/grunt-update-submodules/package.json...OK
Loading "update-submodules.js" tasks...OK
+ update_submodules
Reading package.json...OK
Parsing package.json...OK
Initializing config...OK
Loading "Gruntfile.js" tasks...OK
+ build, default, dev, docs, help, init, knex-migrator, lint, master, master-warn, prod, release, setTestEnv, stubClientFiles, test, test-acceptance, test-all, test-regression, test-setup, test-unit, validate, watch-docs

Running tasks: validate

Running "validate" task

Running "test-acceptance" task

Running "test-setup" task

Running "knex-migrator" task

Running "clean:test" (clean) task
Verifying property clean.test exists in config...OK
Files: [no src]
Options: force=false, no-write=false
>> 0 paths cleaned.

Running "setTestEnv" task

Running "stubClientFiles" task

Running "mochacli:acceptance" (mochacli) task
Verifying property mochacli.acceptance exists in config...OK
Files: core/test/acceptance/old/admin/actions_spec.js, core/test/acceptance/old/admin/config_spec.js, core/test/acceptance/old/admin/db_spec.js, core/test/acceptance/old/admin/images_spec.js, core/test/acceptance/old/admin/integrations_spec.js, core/test/acceptance/old/admin/invites_spec.js, core/test/acceptance/old/admin/key_authentication_spec.js, core/test/acceptance/old/admin/mail_spec.js, core/test/acceptance/old/admin/notifications_spec.js, core/test/acceptance/old/admin/oembed_spec.js, core/test/acceptance/old/admin/pages_spec.js, core/test/acceptance/old/admin/posts_spec.js, core/test/acceptance/old/admin/roles_spec.js, core/test/acceptance/old/admin/settings_spec.js, core/test/acceptance/old/admin/slugs_spec.js, core/test/acceptance/old/admin/tags_spec.js, core/test/acceptance/old/admin/themes_spec.js, core/test/acceptance/old/admin/users_spec.js, core/test/acceptance/old/admin/webhooks_spec.js, core/test/acceptance/old/content/authors_spec.js, core/test/acceptance/old/content/key_authentication_spec.js, core/test/acceptance/old/content/pages_spec.js, core/test/acceptance/old/content/posts_spec.js, core/test/acceptance/old/content/settings_spec.js, core/test/acceptance/old/content/tags_spec.js
Options: ui="bdd", reporter="spec", timeout="30000", save=undefined, require=["core/server/overrides"], exit


  Actions API
    âœ“ Can request actions for resource (2467ms)

  Config API
    âœ“ can retrieve config and all expected properties

  DB API
    âœ“ Can export a JSON database (50ms)
(node:6606) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 committed listeners added. Use emitter.setMaxListeners() to increase limit
    âœ“ Can import a JSON database (575ms)
(node:6606) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 committed listeners added. Use emitter.setMaxListeners() to increase limit
    âœ“ Can delete all content (148ms)

  Images API
    âœ“ Can upload a png (80ms)
    âœ“ Can upload a jpg
    âœ“ Can upload a gif
    âœ“ Can upload a square profile image

  Integrations API
    âœ“ Can successfully create a single integration with auto generated content and admin api key (41ms)
    âœ“ Can successfully create a single integration with a webhook (51ms)
    âœ“ Can successfully get a created integration (61ms)
    âœ“ Can successfully get *all* created integrations with api_keys (101ms)
    âœ“ Can successfully edit a created integration (76ms)
    âœ“ Can successfully add and delete a created integrations webhooks (145ms)
    âœ“ Can succesfully delete a created integration (112ms)

  Invites API
    âœ“ Can fetch all invites
    âœ“ Can read an invitation by id
    âœ“ Can add a new invite (114ms)
    âœ“ Can destroy an existing invite

  Admin API key authentication
    âœ“ Can not access endpoint without a token header
    âœ“ Can not access endpoint with a wrong endpoint token
    âœ“ Can access browse endpoint with correct token (46ms)
    âœ“ Can create post (61ms)
    âœ“ Can read users

  Mail API
    âœ“ Can send mail

  Notifications API
    âœ“ Can add notification
    âœ“ Can delete notification (52ms)

  Oembed API
    âœ“ can fetch an embed (59ms)

  Pages API
    âœ“ Can retrieve all pages
    âœ“ Can add a page (98ms)
    âœ“ Can update a page (112ms)
    âœ“ Cannot get page via posts endpoint
    âœ“ Cannot update page via posts endpoint (41ms)
    âœ“ Can delete a page (43ms)

  Posts API
    âœ“ Can retrieve all posts (60ms)
    âœ“ Can retrieve multiple post formats
    âœ“ Can includes single relation
    âœ“ Can filter posts
    âœ“ Cannot receive pages
    âœ“ Can paginate posts
    âœ“ Can request a post by id
    âœ“ Can retrieve a post by slug
    âœ“ Can include relations for a single post
    âœ“ Can add a post (69ms)
    âœ“ Can update draft (92ms)
    âœ“ Can unpublish a post (97ms)
    âœ“ Can destroy a post (63ms)
    âœ“ Cannot get post via pages endpoint
    âœ“ Cannot update post via pages endpoint (50ms)

  Roles API
    âœ“ Can request all roles
    âœ“ Can request roles which i am able to assign to other users (43ms)

  Settings API
    âœ“ Can request all settings
    âœ“ Can read a setting
    âœ“ Can edit a setting (46ms)
    âœ“ Can download routes.yaml
    âœ“ Can upload routes.yaml (1020ms)

  Slug API
    âœ“ Can generate a slug 

  Tag API
    âœ“ Can request all tags
    âœ“ Can paginate tags
    âœ“ Can read a tag
    âœ“ Can add a tag (51ms)
    âœ“ Can add an internal tag (55ms)
    âœ“ Can edit a tag (52ms)
    âœ“ Can destroy a tag (64ms)

  Themes API
    âœ“ Can request all available themes
    âœ“ Can download a theme (253ms)
    âœ“ Can upload a valid theme (606ms)
    âœ“ Can delete a theme
    âœ“ Can upload a theme, which has warnings (232ms)
    âœ“ Can activate a theme (74ms)

  User API
    âœ“ Can request all users ordered by id
    âœ“ Can include user roles
    âœ“ Can paginate users
    âœ“ Can retrieve a user by id
    âœ“ Can retrieve a user by slug
    âœ“ Can retrieve a user by email
    âœ“ can edit a user (179ms)
(node:6606) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 committed listeners added. Use emitter.setMaxListeners() to increase limit
    âœ“ Can destroy an active user (333ms)
    âœ“ Can transfer ownership to admin user (54ms)
    âœ“ Can change password (247ms)

  Webhooks API
    âœ“ Can creates a webhook
    âœ“ Can edit a webhook (79ms)
    âœ“ Can delete a webhook

  Authors Content API
    âœ“ Can request authors
    âœ“ Can request authors including post count
    âœ“ Can request single author
    âœ“ Can request author by id including post count

  Content API key authentication
    âœ“ Can not access without key
    âœ“ Can access with with valid key

  Pages Content API
    âœ“ Can request pages
    âœ“ Can request page

  Posts Content API
    âœ“ Can request posts
    âœ“ Can filter posts by tag (38ms)
    âœ“ Can filter posts by authors (42ms)
    âœ“ Can request fields of posts
    âœ“ Can include relations (59ms)
    âœ“ Can request posts from different origin
    âœ“ Can filter by published date
    âœ“ Can request a single post

  Settings Content API
    âœ“ Can request settings

  Tags Content API
    âœ“ Can request tags
    âœ“ Can request tags with limit=all
    âœ“ Can limit tags to receive
    âœ“ Can include post count


  105 passing (1m)


Running "test-unit" task

Running "test-setup" task

Running "knex-migrator" task

Running "clean:test" (clean) task
Verifying property clean.test exists in config...OK
Files: content/data/ghost-test.db
Options: force=false, no-write=false
Cleaning content/data/ghost-test.db...
>> 1 path cleaned.

Running "setTestEnv" task

Running "stubClientFiles" task

Running "mochacli:unit" (mochacli) task
Verifying property mochacli.unit exists in config...OK
Files: core/test/unit/adapters/scheduling/index_spec.js, core/test/unit/adapters/scheduling/post-scheduling/index_spec.js, core/test/unit/adapters/scheduling/SchedulingDefault_spec.js, core/test/unit/adapters/scheduling/utils_spec.js, core/test/unit/adapters/storage/index_spec.js, core/test/unit/adapters/storage/LocalFileStorage_spec.js, core/test/unit/adapters/storage/utils_spec.js, core/test/unit/api/shared/frame_spec.js, core/test/unit/api/shared/headers_spec.js, core/test/unit/api/shared/http_spec.js, core/test/unit/api/shared/pipeline_spec.js, core/test/unit/api/shared/serializers/handle_spec.js, core/test/unit/api/shared/serializers/input/all_spec.js, core/test/unit/api/shared/util/options_spec.js, core/test/unit/api/shared/validators/handle_spec.js, core/test/unit/api/shared/validators/input/all_spec.js, core/test/unit/api/v0.1/decorators/urls_spec.js, core/test/unit/api/v0.1/index_spec.js, core/test/unit/api/v0.1/oembed_spec.js, core/test/unit/api/v0.1/utils_spec.js, core/test/unit/api/v2/session_spec.js, core/test/unit/api/v2/utils/index_spec.js, core/test/unit/api/v2/utils/serializers/input/pages_spec.js, core/test/unit/api/v2/utils/serializers/input/posts_spec.js, core/test/unit/api/v2/utils/serializers/output/all_spec.js, core/test/unit/api/v2/utils/serializers/output/pages_spec.js, core/test/unit/api/v2/utils/serializers/output/posts_spec.js, core/test/unit/api/v2/utils/serializers/output/tags_spec.js, core/test/unit/api/v2/utils/serializers/output/utils/date_spec.js, core/test/unit/api/v2/utils/serializers/output/utils/extra-attrs_spec.js, core/test/unit/api/v2/utils/serializers/output/utils/mapper_spec.js, core/test/unit/api/v2/utils/serializers/output/utils/url_spec.js, core/test/unit/api/v2/utils/validators/input/pages_spec.js, core/test/unit/api/v2/utils/validators/input/posts_spec.js, core/test/unit/api/v2/utils/validators/input/tags_spec.js, core/test/unit/apps/amp/amp_components_spec.js, core/test/unit/apps/amp/amp_content_spec.js, core/test/unit/apps/amp/router_spec.js, core/test/unit/apps/private-blogging/controller_spec.js, core/test/unit/apps/private-blogging/input_password_spec.js, core/test/unit/apps/private-blogging/middleware_spec.js, core/test/unit/apps/subscribers/input_email_spec.js, core/test/unit/apps/subscribers/subscribe_form_spec.js, core/test/unit/config/index_spec.js, core/test/unit/config/utils_spec.js, core/test/unit/data/db/backup_spec.js, core/test/unit/data/exporter/index_spec.js, core/test/unit/data/importer/index_spec.js, core/test/unit/data/meta/amp_url_spec.js, core/test/unit/data/meta/asset_url_spec.js, core/test/unit/data/meta/author_fb_url_spec.js, core/test/unit/data/meta/author_image_spec.js, core/test/unit/data/meta/author_url_spec.js, core/test/unit/data/meta/blog_logo_spec.js, core/test/unit/data/meta/canonical_url_spec.js, core/test/unit/data/meta/context_object_spec.js, core/test/unit/data/meta/cover_image_spec.js, core/test/unit/data/meta/creator_url_spec.js, core/test/unit/data/meta/description_spec.js, core/test/unit/data/meta/excerpt_spec.js, core/test/unit/data/meta/image-dimensions_spec.js, core/test/unit/data/meta/keywords_spec.js, core/test/unit/data/meta/modified_date_spec.js, core/test/unit/data/meta/og_image_spec.js, core/test/unit/data/meta/og_type_spec.js, core/test/unit/data/meta/paginated_url_spec.js, core/test/unit/data/meta/published_date_spec.js, core/test/unit/data/meta/rss_url_spec.js, core/test/unit/data/meta/schema_spec.js, core/test/unit/data/meta/structured_data_spec.js, core/test/unit/data/meta/title_spec.js, core/test/unit/data/meta/twitter_image_spec.js, core/test/unit/data/meta/url_spec.js, core/test/unit/data/schema/fixtures/utils_spec.js, core/test/unit/data/schema/integrity_spec.js, core/test/unit/data/validation/index_spec.js, core/test/unit/data/xml/sitemap/generator_spec.js, core/test/unit/data/xml/sitemap/manager_spec.js, core/test/unit/filters_spec.js, core/test/unit/helpers/asset_spec.js, core/test/unit/helpers/author_spec.js, core/test/unit/helpers/authors_spec.js, core/test/unit/helpers/body_class_spec.js, core/test/unit/helpers/content_spec.js, core/test/unit/helpers/date_spec.js, core/test/unit/helpers/encode_spec.js, core/test/unit/helpers/excerpt_spec.js, core/test/unit/helpers/facebook_url_spec.js, core/test/unit/helpers/foreach_spec.js, core/test/unit/helpers/get_spec.js, core/test/unit/helpers/ghost_foot_spec.js, core/test/unit/helpers/ghost_head_spec.js, core/test/unit/helpers/has_spec.js, core/test/unit/helpers/img_url_spec.js, core/test/unit/helpers/index_spec.js, core/test/unit/helpers/is_spec.js, core/test/unit/helpers/lang_spec.js, core/test/unit/helpers/meta_description_spec.js, core/test/unit/helpers/meta_title_spec.js, core/test/unit/helpers/navigation_spec.js, core/test/unit/helpers/next_post_spec.js, core/test/unit/helpers/page_url_spec.js, core/test/unit/helpers/pagination_spec.js, core/test/unit/helpers/plural_spec.js, core/test/unit/helpers/post_class_spec.js, core/test/unit/helpers/prev_post_spec.js, core/test/unit/helpers/reading_time_spec.js, core/test/unit/helpers/t_spec.js, core/test/unit/helpers/tags_spec.js, core/test/unit/helpers/template_spec.js, core/test/unit/helpers/title_spec.js, core/test/unit/helpers/twitter_url_spec.js, core/test/unit/helpers/url_spec.js, core/test/unit/helpers/utils_spec.js, core/test/unit/lib/common/errors_spec.js, core/test/unit/lib/fs/package-json/filter_spec.js, core/test/unit/lib/fs/package-json/parse_spec.js, core/test/unit/lib/fs/package-json/read_spec.js, core/test/unit/lib/fs/read-csv_spec.js, core/test/unit/lib/fs/zip-folder_spec.js, core/test/unit/lib/ghost-version_spec.js, core/test/unit/lib/image/blog-icon_spec.js, core/test/unit/lib/image/cached-image-size-from-url_spec.js, core/test/unit/lib/image/gravatar_spec.js, core/test/unit/lib/image/image-size_spec.js, core/test/unit/lib/image/manipulator_spec.js, core/test/unit/lib/mobiledoc/atoms/soft-return_spec.js, core/test/unit/lib/mobiledoc/cards/code_spec.js, core/test/unit/lib/mobiledoc/cards/embed_spec.js, core/test/unit/lib/mobiledoc/cards/gallery_spec.js, core/test/unit/lib/mobiledoc/cards/hr_spec.js, core/test/unit/lib/mobiledoc/cards/html_spec.js, core/test/unit/lib/mobiledoc/cards/image_spec.js, core/test/unit/lib/mobiledoc/cards/markdown_spec.js, core/test/unit/lib/mobiledoc/converters/converters_spec.js, core/test/unit/lib/mobiledoc/converters/mobiledoc-converter_spec.js, core/test/unit/lib/promise/pipeline_spec.js, core/test/unit/lib/promise/sequence_spec.js, core/test/unit/lib/request_spec.js, core/test/unit/lib/security/password_spec.js, core/test/unit/lib/security/string_spec.js, core/test/unit/lib/security/tokens_spec.js, core/test/unit/lib/social/urls_spec.js, core/test/unit/models/api-key_spec.js, core/test/unit/models/base/index_spec.js, core/test/unit/models/base/listeners_spec.js, core/test/unit/models/invite_spec.js, core/test/unit/models/permission_spec.js, core/test/unit/models/plugins/pagination_spec.js, core/test/unit/models/post_spec.js, core/test/unit/models/session_spec.js, core/test/unit/models/settings_spec.js, core/test/unit/models/tag_spec.js, core/test/unit/models/user_spec.js, core/test/unit/public/ghost_sdk_spec.js, core/test/unit/services/apps/dependencies_spec.js, core/test/unit/services/apps/lifecycle_spec.js, core/test/unit/services/apps/permissions_spec.js, core/test/unit/services/apps/proxy_spec.js, core/test/unit/services/apps/sandbox_spec.js, core/test/unit/services/auth/api-key/admin_spec.js, core/test/unit/services/auth/api-key/content_spec.js, core/test/unit/services/auth/auth-strategies_spec.js, core/test/unit/services/auth/authenticate_spec.js, core/test/unit/services/auth/members/index_spec.js, core/test/unit/services/auth/oauth_spec.js, core/test/unit/services/auth/passport_spec.js, core/test/unit/services/auth/session/middleware_spec.js, core/test/unit/services/auth/session/store_spec.js, core/test/unit/services/mail/GhostMailer_spec.js, core/test/unit/services/mail/utils_spec.js, core/test/unit/services/permissions/can-this_spec.js, core/test/unit/services/permissions/index_spec.js, core/test/unit/services/permissions/parse-context_spec.js, core/test/unit/services/permissions/providers_spec.js, core/test/unit/services/permissions/public_spec.js, core/test/unit/services/routing/CollectionRouter_spec.js, core/test/unit/services/routing/controllers/channel_spec.js, core/test/unit/services/routing/controllers/collection_spec.js, core/test/unit/services/routing/controllers/entry_spec.js, core/test/unit/services/routing/controllers/preview_spec.js, core/test/unit/services/routing/controllers/rss_spec.js, core/test/unit/services/routing/controllers/static_spec.js, core/test/unit/services/routing/helpers/context_spec.js, core/test/unit/services/routing/helpers/entry-lookup_spec.js, core/test/unit/services/routing/helpers/error_spec.js, core/test/unit/services/routing/helpers/fetch-data_spec.js, core/test/unit/services/routing/helpers/format-response_spec.js, core/test/unit/services/routing/helpers/templates_spec.js, core/test/unit/services/routing/middlewares/page-param_spec.js, core/test/unit/services/routing/ParentRouter_spec.js, core/test/unit/services/routing/registry_spec.js, core/test/unit/services/routing/RSSRouter_spec.js, core/test/unit/services/routing/StaticRoutesRouter_spec.js, core/test/unit/services/routing/TaxonomyRouter_spec.js, core/test/unit/services/rss/cache_spec.js, core/test/unit/services/rss/generate-feed_spec.js, core/test/unit/services/rss/renderer_spec.js, core/test/unit/services/settings/cache_spec.js, core/test/unit/services/settings/ensure-settings_spec.js, core/test/unit/services/settings/loader_spec.js, core/test/unit/services/settings/settings_spec.js, core/test/unit/services/settings/validate_spec.js, core/test/unit/services/settings/yaml-parser_spec.js, core/test/unit/services/slack_spec.js, core/test/unit/services/themes/active_spec.js, core/test/unit/services/themes/config_spec.js, core/test/unit/services/themes/engines/create_spec.js, core/test/unit/services/themes/list_spec.js, core/test/unit/services/themes/loader_spec.js, core/test/unit/services/themes/middleware_spec.js, core/test/unit/services/themes/validate_spec.js, core/test/unit/services/url/Queue_spec.js, core/test/unit/services/url/UrlGenerator_spec.js, core/test/unit/services/url/Urls_spec.js, core/test/unit/services/url/UrlService_spec.js, core/test/unit/services/url/utils_spec.js, core/test/unit/services/xmlrpc_spec.js, core/test/unit/web/admin/middleware_spec.js, core/test/unit/web/api/v2/content/middleware_spec.js, core/test/unit/web/middleware/api/cors_spec.js, core/test/unit/web/middleware/api/version-match_spec.js, core/test/unit/web/middleware/cache-control_spec.js, core/test/unit/web/middleware/ghost-locals_spec.js, core/test/unit/web/middleware/image/handle-image-sizes_spec.js, core/test/unit/web/middleware/image/normalize_spec.js, core/test/unit/web/middleware/serve-favicon_spec.js, core/test/unit/web/middleware/serve-public-file_spec.js, core/test/unit/web/middleware/static-theme_spec.js, core/test/unit/web/middleware/theme-handler_spec.js, core/test/unit/web/middleware/uncapitalise_spec.js, core/test/unit/web/middleware/update-user-last-seen_spec.js, core/test/unit/web/middleware/url-redirects_spec.js, core/test/unit/web/parent-app_spec.js, core/test/unit/web/shared/middleware/api/spam-prevention_spec.js, core/test/unit/web/shared/middleware/brute_spec.js, core/test/unit/web/utils_spec.js
Options: ui="bdd", reporter="spec", timeout="30000", save=undefined, require=["core/server/overrides"], exit
`sandbox.create()` is deprecated. Use default sandbox at `sinon.sandbox` or create new sandboxes with `sinon.createSandbox()`


  Scheduling
    success
      âœ“ ensure post scheduling init is called

  Scheduling: Post Scheduling
    fn:init
      success
        âœ“ will be scheduled
        âœ“ will load scheduled posts from database
      error
        âœ“ no url passed

  Scheduling Default Adapter
    success
      âœ“ addJob (schedule)
      âœ“ run (125ms)
      âœ“ ensure recursive run works
      âœ“ execute (107ms)
      âœ“ delete job (unschedule) (52ms)
      âœ“ delete job (unschedule): time is null
      âœ“ pingUrl (PUT) (107ms)
      âœ“ pingUrl (GET)
      âœ“ pingUrl (PUT, and detect publish in the past)
      âœ“ pingUrl (GET, and detect publish in the past)
      âœ“ pingUrl, but blog returns 503 (102ms)

  Scheduling: utils
    success
      âœ“ create good adapter
      âœ“ create good adapter
    error
      âœ“ create without adapter path
      âœ“ create with unknown adapter
      âœ“ create with adapter, but missing fn's

  storage: index_spec
    âœ“ default image storage is local file storage
    âœ“ custom adapter
    âœ“ create bad adapter: exists fn is missing

  Local File System Storage
    âœ“ should send correct path to image when date is in Sep 2013
    âœ“ should send correct path to image when original file has spaces
    âœ“ should allow "@" symbol to image for Apple hi-res (retina) modifier
    âœ“ should send correct path to image when date is in Jan 2014
    âœ“ should create month and year directory
    âœ“ should copy temp file to new location
    âœ“ can upload two different images with the same name without overwriting the first
    âœ“ can upload five different images with the same name without overwriting the first
    read image
      âœ“ success
      âœ“ success
      âœ“ image does not exist
    validate extentions
      âœ“ name contains a .d as extension
      âœ“ name contains a .zip as extension
      âœ“ name contains a .jpeg as extension
    when a custom content path is used
      âœ“ should send the correct path to image
    on Windows
      âœ“ should return url in proper format for windows

  storage utils
    fn: getLocalFileStoragePath
      âœ“ should return local file storage path for absolute URL
      - should return local file storage path for https request, when blog setup as http
      âœ“ should return local file storage path for absolute URL with subdirectory
      âœ“ should return local file storage path for relative URL
      âœ“ should return local file storage path for relative URL with subdirectory
      âœ“ should not sanitize URL if not local file storage
    fn: isLocalImage
      âœ“ should return true when absolute URL and local file
      - should return local file storage path for https request, when blog setup as http
      âœ“ should return true when absolute URL with subdirectory and local file
      âœ“ should return true when relative URL and local file
      âœ“ should return true when relative URL and local file
      âœ“ should return false when no local file

  Unit: api/shared/frame
    âœ“ constructor
    fn: configure
      âœ“ no transform
      âœ“ transform
      âœ“ transform
      âœ“ transform

  Unit: api/shared/headers
    âœ“ empty headers config
    config.disposition
      âœ“ json
      âœ“ csv
      âœ“ yaml
    config.cacheInvalidate
      âœ“ default
      âœ“ custom value

  Unit: api/shared/http
    âœ“ check options
    âœ“ api response is fn
    âœ“ api response is fn

  Unit: api/shared/pipeline
    stages
      validation
        input
          âœ“ do it yourself
          âœ“ default
      permissions
        âœ“ key is missing
        âœ“ do it yourself
        âœ“ skip stage
        âœ“ default
        âœ“ with permission config
    pipeline
      âœ“ ensure we receive a callable api controller fn
      âœ“ call api controller fn
      âœ“ api controller is fn, not config

  Unit: api/shared/serializers/handle
    input
      âœ“ no api config passed
      âœ“ no api serializers passed
      âœ“ ensure serializers are called with apiConfig and frame
    output
      âœ“ no models passed
      âœ“ no api config passed
      âœ“ no api serializers passed
      âœ“ ensure serializers are called

  Unit: v2/utils/serializers/input/all
    all
      âœ“ transforms into model readable format
      extra allowed internal options
        âœ“ internal access
        âœ“ no internal access

  Unit: api/shared/util/options
    âœ“ returns an array with empty string when no parameters are passed
    âœ“ returns single item array
    âœ“ returns multiple items in array
    âœ“ lowercases and trims items in the string
    âœ“ accepts parameters in form of an array

  Unit: api/shared/validators/handle
    input
      âœ“ no api config passed
      âœ“ no api validators passed
      âœ“ ensure validators are called

  Unit: api/shared/validators/input/all
    all
      âœ“ default
      âœ“ should run global validations on an type that has validation defined
      âœ“ allows empty values
      âœ“ supports include being an array
      âœ“ default include array notation
      âœ“ does not fail
      âœ“ does not fail include array notation
      âœ“ fails
      âœ“ invalid fields
    browse
      âœ“ default
      âœ“ fails
    read
      âœ“ default
    add
      âœ“ fails
      âœ“ fails
      âœ“ fails
      âœ“ fails
      âœ“ success
    edit
      âœ“ id mismatch

  Unit: api:v0.1:decorators:urls
    urlsForPost
      âœ“ does not add any extra keys to an object
      âœ“ adds url property
      âœ“ converts relative feature_image url to absolute
      âœ“ converts relative twitter_image url to absolute
      âœ“ converts relative og_image url to absolute when absolute_urls flag passed
      âœ“ converts relative content urls to absolute when absolute_urls flag passed
    urlsForUser
      âœ“ adds url property
      âœ“ converts relative profile_image url to absolute
      âœ“ converts relative cover_image url to absolute
    urlsForTag
      âœ“ adds url property
      âœ“ converts relative feature_image url to absolute

  API: index
    fn: cacheInvalidationHeader
      âœ“ /schedules/posts should invalidate cache
      âœ“ /schedules/something should NOT invalidate cache

  API: oembed
    fn: read
      âœ“ finds match for unlisted http scheme (40ms)
      âœ“ finds match for schema-less urls
      âœ“ follows redirects to get base url (43ms)
      âœ“ returns error for missing url
      âœ“ returns error for unsupported provider
      âœ“ returns match for unsupported provider but with oembed link tag
      âœ“ returns error for fetch failure

  API Utils
    âœ“ exports
    Default Options
      âœ“ should provide a set of default options
    validate
      âœ“ should create options when passed no args
      âœ“ should pick data attrs when passed them
      âœ“ should pick data attrs & leave options if passed
      âœ“ should check data if an object is passed
      âœ“ should handle options being undefined
      âœ“ should handle options being undefined when provided with object
      âœ“ should remove unknown options
      âœ“ should always allow context & include options
      âœ“ should allow page & limit options when browseDefaultOptions passed
      âœ“ should allow idDefaultOptions when passed
      âœ“ should reject if limit is invalid
      âœ“ should reject if from is invalid
    validateOptions
      âœ“ can validate `id`
      âœ“ can validate `uuid`
      âœ“ can validate `page`
      âœ“ can validate `limit`
      âœ“ can validate `slug` or `status` or `author` etc as a-z, 0-9, - and _
      âœ“ gives no errors for `context`, `include` and `data`
    prepareInclude
      âœ“ should handle empty items
      âœ“ should be empty if there are no allowed includes
      âœ“ should return correct includes
    convertOptions
      âœ“ should not call prepareInclude if there is no include option
      âœ“ should pass options.include to prepareInclude if provided
    checkObject
      âœ“ throws an error if the object is empty
      âœ“ throws an error if the object key is empty
      âœ“ throws an error if the object key is array with empty object
      âœ“ passed through a simple, correct object
      âœ“ passed through a simple, correct object
      âœ“ [DEPRECATED] should do author_id to author conversion for posts
      âœ“ [DEPRECATED] should not do author_id to author conversion for posts if not needed
      âœ“ should throw error if invalid editId if provided
      âœ“ should ignore undefined editId
      âœ“ should ignore editId if object has no id
      âœ“ will delete null values from object
      âœ“ will not break if the expected object is a string
      post.tags structure
        âœ“ post.tags is empty
        âœ“ post.tags contains `parent`
        âœ“ post.tags contains `parent_id`
        âœ“ post.tags contains no parent
      post.authors structure
        âœ“ post.authors is not present
        âœ“ post.authors is no array
        âœ“ post.authors is empty
        âœ“ post.authors contains id property
        âœ“ post.authors does not contain id property
        âœ“ post.authors contains nested relations
    isPublicContext
      âœ“ should call out to permissions
    applyPublicPermissions
      âœ“ should call out to permissions
    handlePublicPermissions
      âœ“ should return empty options if passed empty options
      âœ“ should treat no context as public
      âœ“ should treat user context as NOT public
      âœ“ should throw a permissions error if permission is not granted
    handlePermissions
      âœ“ should require a docName
      âœ“ should return a function
      âœ“ should handle an unknown rejection
      âœ“ should handle a NoPermissions rejection
      âœ“ should handle success
      âœ“ should ignore unsafe attrs if none are provided
      âœ“ should ignore unsafe attrs if they are provided but not present
      âœ“ should pass through unsafe attrs if they DO exist
      âœ“ should strip excludedAttrs from data if permissions function returns them

  Session controller
    âœ“ exports an add method
    âœ“ exports an delete method
    #add
      âœ“ throws an UnauthorizedError if the object is missing a username and password
      âœ“ it checks the username and password and throws UnauthorizedError if it fails
      âœ“ it returns a function that calls req.brute.reset, sets req.user and calls createSession if the check works
      âœ“ it returns a function that calls req.brute.reset and calls next if reset errors
    #delete
      âœ“ returns a function that calls destroySession
    #get
      âœ“ returns the result of User.findOne

  Unit: v2/utils/index
    isContentAPI
      âœ“ is true when apiType is "content"
      âœ“ is false when apiType is admin

  Unit: v2/utils/serializers/input/pages
    browse
      âœ“ default
      âœ“ combine filters
      âœ“ combine filters
      âœ“ combine filters
      âœ“ remove mobiledoc option from formats
    read
      âœ“ content api default
      âœ“ content api default
      âœ“ admin api default
      âœ“ custom page filter
      âœ“ custom status filter
      âœ“ remove mobiledoc option from formats
    Ensure relations format
      âœ“ relations is array of objects
      âœ“ authors is array of strings

  Unit: v2/utils/serializers/input/posts
    browse
      âœ“ default
      âœ“ should not work for non public context
      âœ“ combine filters
      âœ“ combine filters
      âœ“ combine filters
      âœ“ combine filters
      âœ“ remove mobiledoc option from formats
    read
      âœ“ with apiType of "content" it forces page filter
      âœ“ with apiType of "content" it forces page false filter
      âœ“ with apiType of "admin" it forces page & status false filter
      âœ“ with apiType of "admin" it forces page filter & respects custom status filter
      âœ“ remove mobiledoc option from formats
    edit
      Ensure relative urls are returned for standard image urls
        âœ“ when mobiledoc contains an absolute URL to image
        âœ“ when mobiledoc contains multiple absolute URLs to images with different protocols
        âœ“ when blog url is without subdir
        âœ“ when blog url is with subdir
      Ensure html to mobiledoc conversion
        âœ“ no transformation when no html source option provided
        âœ“ no transformation when html data is empty
        âœ“ transforms html when html is present in data and source options (608ms)
      Ensure relations format
        âœ“ relations is array of objects
        âœ“ authors is array of strings

  Unit: v2/utils/serializers/output/all
    after
      âœ“ x_by

  Unit: v2/utils/serializers/output/pages
    âœ“ calls the mapper

  Unit: v2/utils/serializers/output/posts
    âœ“ calls the mapper

  Unit: v2/utils/serializers/output/tags
    âœ“ calls the mapper when single tag present
    âœ“ calls the mapper with multiple tags

  Unit: v2/utils/serializers/output/utils/date
    âœ“ creates date strings in ISO 8601 format with UTC offset

  Unit: v2/utils/serializers/output/utils/extra-attrs
    for post
      âœ“ respects custom excerpt
      âœ“ no custom excerpt
      âœ“ has excerpt when plaintext is null

  Unit: v2/utils/serializers/output/utils/mapper
    mapPost
      âœ“ calls mapper on relations
    mapUser
      âœ“ calls utils
    mapTag
      âœ“ calls utils
    mapIntegration
      âœ“ formats admin keys

  Unit: v2/utils/serializers/output/utils/url
    Ensure calls url service
      âœ“ meta & models & relations

  Unit: v2/utils/validators/input/pages
    add
      required fields
        âœ“ should fail with no data (71ms)
        âœ“ should fail with no pages
        âœ“ should fail with no pages in array
        âœ“ should fail with more than page
        âœ“ should fail without required fields
        âœ“ should pass with required fields
        âœ“ should remove `strip`able fields and leave regular fields
      field formats
        âœ“ should fail for bad title (62ms)
        âœ“ should fail for bad slug (51ms)
        âœ“ should fail for bad mobiledoc
        âœ“ should fail for bad feature_image
        âœ“ should fail for bad featured
        âœ“ should fail for bad status (48ms)
        âœ“ should fail for bad locale
        âœ“ should fail for bad visibility
        âœ“ should fail for bad meta_title (50ms)
        âœ“ should fail for bad meta_description
      authors structure
        âœ“ should require properties
        âœ“ should require id
        âœ“ should pass
    edit
      required fields
        âœ“ should fail with no data
        âœ“ should fail with no pages
        âœ“ should fail with more than page
        âœ“ should pass with some fields
      authors structure
        âœ“ should require properties
        âœ“ should require id
        âœ“ should pass with valid authors
        âœ“ should pass without authors
        âœ“ should pass with authors as array with strings
        âœ“ should pass with authors as array with strings & objects

  Unit: v2/utils/validators/input/posts
    add
      required fields
        âœ“ should fail with no data
        âœ“ should fail with no posts
        âœ“ should fail with no posts in array
        âœ“ should fail with more than post
        âœ“ should fail without required fields
        âœ“ should pass with required fields
        âœ“ should remove `strip`able fields and leave regular fields
      field formats
        âœ“ should fail for bad title (49ms)
        âœ“ should fail for bad slug
        âœ“ should fail for bad mobiledoc
        âœ“ should fail for bad feature_image
        âœ“ should fail for bad featured
        âœ“ should fail for bad status
        âœ“ should fail for bad locale
        âœ“ should fail for bad visibility
        âœ“ should fail for bad meta_title
        âœ“ should fail for bad meta_description
      authors structure
        âœ“ should require properties
        âœ“ should require id
        âœ“ should pass
    edit
      required fields
        âœ“ should fail with no data
        âœ“ should fail with no posts
        âœ“ should fail with more than post
        âœ“ should pass with some fields
      authors structure
        âœ“ should require properties
        âœ“ should require id
        âœ“ should pass with valid authors
        âœ“ should pass without authors
        âœ“ should pass with authors as array with strings
        âœ“ should pass with authors as array with strings & objects

  Unit: v2/utils/validators/input/tags
    add
      required fields
        âœ“ should fail with no data
        âœ“ should fail with no tags
        âœ“ should fail with no tags in array
        âœ“ should fail with more than tags
        âœ“ should fail without required fields
        âœ“ should pass with required fields
        âœ“ should remove `strip`able fields and leave regular fields
      field formats
        âœ“ should fail for bad name (50ms)
        âœ“ should fail for bad slug
        âœ“ should fail for bad description
        âœ“ should fail for bad feature_image
        âœ“ should fail for bad visibility
        âœ“ should fail for bad meta_title
        âœ“ should fail for bad meta_description
    edit
      required fields
        âœ“ should fail with no data
        âœ“ should fail with no tags
        âœ“ should fail with more than tags
        âœ“ should pass with some fields

  {{amp_components}} helper
    âœ“ adds script tag for a gif
    âœ“ adds script tag for an iframe tag
    âœ“ adds script tag for an audio tag
    âœ“ returns if no html is provided

  {{amp_content}} helper
    âœ“ can render content (72ms)
    âœ“ returns if no html is provided
    Cache
      âœ“ can render content from cache
      âœ“ fetches new AMP HTML if post was changed
    Transforms and sanitizes HTML
      âœ“ can transform img tags to amp-img (135ms)
      âœ“ can transform audio tags to amp-audio
      âœ“ removes video tags including source children
      âœ“ removes inline style
      âœ“ removes prohibited iframe attributes
      âœ“ can handle incomplete HTML tags by returning not Amperized HTML
      âœ“ can handle not existing img src by returning not Amperized HTML (449ms)
      âœ“ does not convert internal anchor links starting with "#"
      âœ“ sanitizes remaining and not valid tags

  Unit - apps/amp/lib/router
    fn: renderer
      âœ“ should render default amp page when theme has no amp template
      âœ“ throws 404 when req.body has no post
      âœ“ throws 404 when req.body.post is a page
    fn: getPostData
      âœ“ should successfully get the post data from slug
      âœ“ subdirectory: should successfully get the post data from slug
      âœ“ should return error if entrylookup returns NotFoundError

  Private Controller
    âœ“ Should render default password page when theme has no password template
    âœ“ Should render theme password page when it exists
    âœ“ Should render with error when error is passed in

  {{input_password}} helper
    âœ“ has input_password helper
    âœ“ returns the correct input when no custom options are specified
    âœ“ returns the correct input when a custom class is specified
    âœ“ returns the correct input when a custom placeholder is specified

  Private Blogging
    passProtect
      âœ“ checkIsPrivate should call next if not private
      âœ“ checkIsPrivate should load session if private
      not private
        âœ“ filterPrivateRoutes should call next if not private
        âœ“ isPrivateSessionAuth should redirect if blog is not private
      private
        âœ“ filterPrivateRoutes should call next if is the "private" route
        âœ“ filterPrivateRoutes: sitemap redirects to /private
        âœ“ filterPrivateRoutes: sitemap with params redirects to /private
        âœ“ filterPrivateRoutes: rss redirects to /private
        âœ“ filterPrivateRoutes: author rss redirects to /private
        âœ“ filterPrivateRoutes: tag rss redirects to /private
        âœ“ filterPrivateRoutes: rss plus something redirects to /private
        âœ“ filterPrivateRoutes should render custom robots.txt
        âœ“ authenticateProtection should call next if error
        with hash verification
          âœ“ authenticatePrivateSession should return next if hash is verified
          âœ“ authenticatePrivateSession should redirect if hash is not verified
          âœ“ isPrivateSessionAuth should redirect if hash is verified
          âœ“ isPrivateSessionAuth should return next if hash is not verified
          âœ“ authenticateProtection should return next if password is incorrect
          âœ“ authenticateProtection should redirect if password is correct
          âœ“ authenticateProtection should redirect to "/" if r param is a full url
          âœ“ filterPrivateRoutes should 404 for /rss/ requests
          âœ“ filterPrivateRoutes should 404 for /rss requests
          âœ“ filterPrivateRoutes should 404 for rss with pagination requests
          âœ“ filterPrivateRoutes should 404 for tag rss requests
          âœ“ filterPrivateRoutes should 404 for tag rss with pagination requests
          âœ“ filterPrivateRoutes should return next if tag contains rss
          âœ“ filterPrivateRoutes should not 404 for very short post url
          âœ“ filterPrivateRoutes: allow private /rss/ feed
          âœ“ filterPrivateRoutes: allow private /rss feed
          âœ“ filterPrivateRoutes: allow private rss feed e.g. tags
          âœ“ [failure] filterPrivateRoutes: allow private rss feed e.g. tags

  {{input_email}} helper
    âœ“ has input_email helper
    âœ“ returns the correct input when no custom options are specified
    âœ“ returns the correct input when a custom class is specified
    âœ“ returns the correct input when an autofocus is specified
    âœ“ returns the correct input when a placeholder is specified
    âœ“ returns the correct input when a value is specified
    âœ“ returns the correct input when an id is specified

  {{subscribe_form}} helper
    âœ“ returns a form with basic expected structure
    âœ“ returns adds classes when passed as parameters
    âœ“ returns adds classes when passed as parameters

  Config
    hierarchy of config channels
      âœ“ env parameter is stronger than file
      âœ“ argv is stronger than env parameter
      âœ“ argv or env is NOT stronger than overrides
      âœ“ overrides is stronger than every other config file
    Index
      âœ“ should have exactly the right keys
      âœ“ should have the correct values for each key
      âœ“ should allow specific properties to be user defined
    Storage
      âœ“ should default to local-file-store
      âœ“ no effect: setting a custom active storage as string
      âœ“ able to set storage for themes (but not officially supported!)
      âœ“ should allow setting a custom active storage as object

  UNIT: Config utils
    makePathsAbsolute
      âœ“ ensure we change paths only
      âœ“ ensure it skips non strings
      âœ“ ensure we don't change absolute paths
      âœ“ match paths on windows

  Backup
    âœ“ should create a backup JSON file

  Exporter
    doExport
      âœ“ should try to export all the correct tables (without excluded)
      âœ“ should try to export all the correct tables with extra tables
      âœ“ should catch and log any errors
    exportFileName
      âœ“ should return a correctly structured filename
      âœ“ should return a correctly structured filename if settings is empty
      âœ“ should return a correctly structured filename if settings errors

  Importer
    ImportManager
      âœ“ has the correct interface
      âœ“ gets the correct extensions
      âœ“ gets the correct types
      âœ“ gets the correct directories
      âœ“ globs extensions correctly
      loadFile
        âœ“ knows when to process a file
        âœ“ knows when to process a zip
        âœ“ has same result for zips and files
        Validate Zip
          âœ“ accepts a zip with a base directory
          âœ“ accepts a zip without a base directory
          âœ“ accepts a zip with an image directory
          âœ“ fails a zip with two base directories
          âœ“ fails a zip with no content
          âœ“ shows a special error for old Roon exports
        Get Base Dir
          âœ“ returns string for base directory
          âœ“ returns empty for no base directory
      preProcess
        âœ“ calls the DataImporter preProcess method
      doImport
        âœ“ calls the DataImporter doImport method with the data object
      generateReport
        âœ“ is currently a noop
      importFromFile
        âœ“ does the import steps in order
    JSONHandler
      âœ“ has the correct interface
      âœ“ correctly handles a valid db api wrapper
      âœ“ correctly errors when given a bad db api wrapper
    ImageHandler
      âœ“ has the correct interface
      âœ“ can load a single file
      âœ“ can load a single file, maintaining structure
      âœ“ can load a single file, removing ghost dirs
      âœ“ can load a file (subdirectory)
      âœ“ can load multiple files
    MarkdownHandler
      âœ“ has the correct interface
      âœ“ does convert a markdown file into a post object
      âœ“ can parse a title from a markdown file
      âœ“ can parse a featured image from a markdown file if there is a title
      âœ“ can import a published post
      âœ“ does not import deleted posts
      âœ“ can import multiple files
    DataImporter
      âœ“ has the correct interface
      âœ“ does preprocess posts, users and tags correctly
    ImageImporter
      âœ“ has the correct interface
      âœ“ does preprocess posts, users and tags correctly
      âœ“ does import the images correctly

  getAmpUrl
    âœ“ should return amp url for post
    âœ“ should not return amp url for tag
    âœ“ should not return amp url for author
    âœ“ should not return amp url for amp post

  getAssetUrl
    âœ“ should return asset url with just context
    âœ“ should return asset url with just context even with leading /
    âœ“ should not add asset to url if ghost.css for default templates
    âœ“ should not add asset to url has public in it
    favicon
      âœ“ should not add asset to url if favicon.ico
      âœ“ should not add asset to url if favicon.png
      âœ“ should correct favicon path for custom png
    minify
      âœ“ should return asset minified url when hasMinFile & useMinFiles are both set to true
      âœ“ should NOT return asset minified url when hasMinFile true but useMinFiles is false
      âœ“ should NOT return asset minified url when hasMinFile false but useMinFiles is true
      âœ“ should not add min to anything besides the last .
    with /blog subdirectory
      âœ“ should return asset url with just context
      âœ“ should return asset url with just context even with leading /
      âœ“ should not add asset to url if ghost.css for default templates
      âœ“ should not add asset to url has public in it
      favicon
        âœ“ should not add asset to url if favicon.ico
        âœ“ should not add asset to url if favicon.png
        âœ“ should return correct favicon path for custom png
      minify
        âœ“ should return asset minified url when hasMinFile & useMinFiles are both set to true
        âœ“ should NOT return asset minified url when hasMinFile true but useMinFiles is false
        âœ“ should NOT return asset minified url when hasMinFile false but useMinFiles is true
        âœ“ should not add min to anything besides the last .

  getAuthorFacebookUrl
    âœ“ should return author facebook url if post and has url
    âœ“ should return author facebook url if AMP post and has url
    âœ“ should return null if context does not contain author facebook url and is a post
    âœ“ should return null if context does not contain author and is a post
    âœ“ should return author facebook url if author and has url
    âœ“ should return null if context does not contain author facebook url and is a author
    âœ“ should return null if context is not a post

  getAuthorImage
    âœ“ should return author image url if post and has url
    âœ“ should return absolute author image url if post and has url
    âœ“ should return author image url if AMP post and has url
    âœ“ should return absolute author image url if AMP post and has url
    âœ“ should return null if context does not contain author image url and is a post
    âœ“ should return null if context does not contain author and is a post
    âœ“ should return null if context is not a post

  getAuthorUrl
    âœ“ should return author url if context contains primary author
    âœ“ should return absolute author url if context contains primary author
    âœ“ should return author url for AMP if context contains primary author
    âœ“ should return author url if data contains author
    âœ“ should return null if no author on data or context

  getBlogLogo
    âœ“ should return logo if uploaded
    âœ“ should return custom uploaded png icon if no logo given

  getCanonicalUrl
    ï¿½ï¿½ï¿½ should return default canonical url
    âœ“ should return canonical url field if present
    âœ“ should return canonical url for amp post without /amp/ in url
    âœ“ should return home if empty secure data

  getContextObject
    âœ“ should be a function
    âœ“ should return post context object for a post
    âœ“ should return post context object for a static page
    âœ“ should return post context object for an AMP post
    âœ“ should return post context object for a static page with amp context
    âœ“ should return page
    override blog
      âœ“ should return blog context object for unknown context

  getCoverImage
    âœ“ should return absolute cover image url for home
    âœ“ should return absolute cover image url for author
    âœ“ should return absolute image url for post
    âœ“ should return absolute image url for AMP post
    âœ“ should return null if missing image
    âœ“ should return null if author missing cover
    âœ“ should return null if home missing cover

  getCreatorTwitterUrl
    âœ“ should return author twitter url if post and has url
    âœ“ should return null if context does not contain author twitter url and is a post
    âœ“ should return null if context does not contain author and is a post
    âœ“ should return author twitter url if AMP post and has url
    âœ“ should return null if context does not contain author twitter url and is an AMP post
    âœ“ should return null if context does not contain author and is an AMP post
    âœ“ should return author twitter url if author and has url
    âœ“ should return null if context does not contain author twitter url and is a author
    âœ“ should return null if context is not a post

  getMetaDescription
    âœ“ should return meta_description if on data root
    âœ“ should return empty string if on root context contains paged
    âœ“ should not return meta description for author if on root context contains author and no meta description provided
    âœ“ should return meta description for author if on root context contains author and meta description provided
    âœ“ should return data tag meta description if on root context contains tag
    âœ“ should not return data tag description if no meta description for tag
    âœ“ should return data post meta description if on root context contains post
    âœ“ should return OG data post meta description if on root context contains post
    âœ“ should not return data post meta description if on root context contains post and called with OG property
    âœ“ should return Twitter data post meta description if on root context contains post
    âœ“ should return data post meta description if on root context contains post for an AMP post
    âœ“ v0.1: should return data post meta description if on root context contains page
    âœ“ v2: should return data page meta description if on root context contains page

  getExcerpt
    âœ“ should return html excerpt with no html
    âœ“ should return html excerpt strips multiple inline footnotes
    âœ“ should return html excerpt striping inline and bottom footnotes
    âœ“ should return html excerpt truncated by word
    âœ“ should return html excerpt truncated by words with non-ascii characters
    âœ“ should return html excerpt truncated by character
    âœ“ should fall back to 50 words if not specified
    âœ“ should truncate plain text for custom excerpts

  getImageDimensions
    âœ“ should return dimension for images
    âœ“ should return metaData if url is undefined or null
    âœ“ should fake image dimension for publisher.logo if file is too big and square
    âœ“ should not fake dimension for publisher.logo if a logo is too big but not square

  getKeywords
    âœ“ should return tags as keywords if post has tags
    âœ“ should only return visible tags
    âœ“ should return null if post has tags is empty array
    âœ“ should return null if post has no tags
    âœ“ should return null if not a post

  getModifiedDate
    âœ“ should return updated at date as ISO 8601 from context if exists
    âœ“ should return updated at date for an AMP post
    âœ“ should return null if no update_at date on context
    âœ“ should return null if context and property do not match in name

  getOgImage
    âœ“ [home] should return null if not post context [home]
    âœ“ should return null if not post context [author]
    âœ“ should return null if not post context [tag]
    âœ“ should return absolute url for OG image in post context
    âœ“ should return absolute url for feature image in post context
    âœ“ should return absolute url for OG image in AMP context
    âœ“ should return absolute url for feature image in AMP context
    âœ“ should return null if missing image

  getOgType
    âœ“ should return og type profile if context is type author
    âœ“ should return og type article if context is type post
    âœ“ should return og type article if context is type amp
    âœ“ should return og type website if context is not author or post

  getPaginatedUrl
    âœ“ should be a function
    index
      âœ“ should calculate correct urls for the first page of an index collection
      âœ“ should calculate correct urls for the second page of an index collection
      âœ“ should calculate correct urls for the last page of an index collection
    other
      âœ“ should calculate correct urls for the first page of another collection
      âœ“ should calculate correct urls for the second page of another collection
      âœ“ should calculate correct urls for the last page of another collection
    with /blog subdirectory
      âœ“ should calculate correct urls for index
      âœ“ should calculate correct urls for another collection

  getPublishedDate
    âœ“ should return published at date as ISO 8601 from context if exists
    âœ“ should return published at over created at date as ISO 8601 if has both
    âœ“ should return published at date for an amp context
    âœ“ should return null if no update_at date on context
    âœ“ should return null if context and property do not match in name

  getRssUrl
    âœ“ should return rss url
    âœ“ forwards absolute/secure flags

  getSchema
    âœ“ should return post schema if context starts with post
    âœ“ should return post schema if context starts with amp
    âœ“ should return post schema removing null or undefined values
    âœ“ should return image url instead of ImageObjects if no dimensions supplied
    âœ“ should return home schema if context starts with home
    âœ“ should return tag schema if context starts with tag
    âœ“ should return author schema if context starts with author
    âœ“ should return null if not a supported type

  getStructuredData
    âœ“ should return structured data from metadata per post
    âœ“ should return structured data from metadata with provided og and twitter images per post
    âœ“ should return structured data from metadata with no nulls

  getTitle
    âœ“ should return meta_title if on data root
    âœ“ should return blog title if on home
    âœ“ should return author name - blog title if on data author page
    âœ“ should return author page title if on data author page with more then one page
    âœ“ should return tag name - blog title if on data tag page no meta_title
    âœ“ should return tag name - blog title if on data tag page no meta_title (Page #)
    âœ“ should return translated pagination-string if passed in options object
    âœ“ should return tag meta_title if in tag data
    âœ“ should return post title if in post context
    âœ“ should return OG post title if in post context
    âœ“ should return twitter post title if in post context
    âœ“ should not return default post title if in amp context and called with twitter property
    âœ“ should return post title if in amp context
    âœ“ v0.1: should return post title if in page context
    âœ“ v2: should return page title if in page context
    âœ“ should return post title if in amp and page context
    âœ“ should return post meta_title if in post data
    âœ“ should return post meta_title if amp context in post data
    âœ“ should return blog title with page if unknown type

  getTwitterImage
    âœ“ [home] should return null if not post context [home]
    âœ“ should return null if not post context [author]
    âœ“ should return null if not post context [tag]
    âœ“ should return absolute url for Twitter image in post context
    âœ“ should return absolute url for Twitter image in post context
    âœ“ should return absolute url for feature image in post context
    âœ“ should return absolute url for Twitter image in AMP context
    âœ“ should return absolute url for feature image in AMP context
    âœ“ should return null if missing image

  getUrl
    âœ“ should return url for a post
    âœ“ should return absolute url for a post
    âœ“ should return absolute url for a post and remove /amp/ in url
    âœ“ should return url for a tag
    âœ“ should return secure url for a tag
    âœ“ should return url for a author
    âœ“ should return secure absolute url for a author
    âœ“ should return url for a nav
    âœ“ should return absolute url for a nav
    âœ“ should return `relativeUrl` and remove /amp/ in url
    preview url: drafts/scheduled posts
      âœ“ not absolute, not secure
      âœ“ absolute, not secure
      âœ“ absolute, secure

  Migration Fixture Utils
    Match Func
      âœ“ should match undefined with no args
      âœ“ should match key with match string
      âœ“ should match value when key is 0
      âœ“ should match key & value when match is array
      âœ“ should match key only when match is array, but value is all
      âœ“ should match key & value when match and value are arrays
    Add Fixtures For Model
      âœ“ should call add for main post fixture
      âœ“ should not call add for main post fixture if it is already found
    Add Fixtures For Relation
      âœ“ should call attach for permissions-roles (38ms)
      âœ“ should call attach for posts-tags
      âœ“ will not call attach for posts-tags if already present
    findModelFixtureEntry
      âœ“ should fetch a single fixture entry
    findModelFixtures
      âœ“ should fetch a fixture with multiple entries
    findPermissionRelationsForObject
      âœ“ should fetch a fixture with multiple entries

  DB version integrity
    âœ“ should not change without fixing this test

  Validation
    âœ“ should export our required functions
    Validate Schema
      models.add
        âœ“ blank model
        âœ“ blank id
        âœ“ should pass
        âœ“ transforms 0 and 1
        âœ“ keeps true or false
      webhooks.add
        âœ“ event name is not lowercase
      models.edit
        âœ“ uuid is invalid
        âœ“ date is null
    Assert the Validator dependency
      âœ“ isEmptyOrUrl filters javascript urls

  Generators
    IndexGenerator
      fn: getXml
        âœ“ default
    PostGenerator
      fn: createNodeFromDatum
        âœ“ adds an image:image element if post has a cover image
      fn: getXml
        âœ“ get cached xml
        âœ“ compare content output
      fn: removeUrl
        âœ“ remove none existend url
        âœ“ remove existing url
    PageGenerator
      fn: getXml
        âœ“ add
    UserGenerator
      fn: validateImageUrl
        âœ“ image url is localhost
        âœ“ image url is https
        âœ“ image url is external
        âœ“ no host

  Unit: sitemap/manager
    SiteMapManager
      âœ“ create SiteMapManager with defaults
      âœ“ can create a SiteMapManager instance
      âœ“ fn: getSiteMapXml
      âœ“ fn: getIndexXml
      trigger url events
        âœ“ url.added
        âœ“ url.removed

  Filters
    âœ“ can register filters with specific priority
    âœ“ can register filters with default priority
    âœ“ can register filters with priority null with default priority
    âœ“ executes filters in priority order
    âœ“ executes filters that return a promise
    âœ“ executes filters with a context

  {{asset}} helper
    no subdirectory
      âœ“ handles favicon correctly
      âœ“ handles ghost.css for default templates correctly
      âœ“ handles custom favicon correctly
      âœ“ handles public assets correctly
      âœ“ handles theme assets correctly
      âœ“ handles hasMinFile assets correctly
    with /blog subdirectory
      âœ“ handles favicon correctly
      âœ“ handles ghost.css for default templates correctly
      âœ“ handles custom favicon correctly
      âœ“ handles public assets correctly
      âœ“ handles theme assets correctly
      âœ“ handles hasMinFile assets correctly

  {{author}} helper
    âœ“ Returns the link to the author from the context
    âœ“ Returns the full name of the author from the context if no autolink
    âœ“ Returns a blank string where author data is missing
    âœ“ Functions as block helper if called with #

  {{authors}} helper
    âœ“ can return string with authors
    âœ“ can use a different separator
    âœ“ can add a single prefix to multiple authors
    âœ“ can add a single suffix to multiple authors
    âœ“ can add a prefix and suffix to multiple authors
    âœ“ can add a prefix and suffix with HTML
    âœ“ does not add prefix or suffix if no authors exist
    âœ“ can autolink authors to author pages
    âœ“ can limit no. authors output to 1
    âœ“ can list authors from a specified no.
    âœ“ can list authors to a specified no.
    âœ“ can list authors in a range
    âœ“ can limit no. authors and output from 2
    âœ“ can list authors in a range (ignore limit)

  {{body_class}} helper
    âœ“ can render class string
    can render class string for context
      âœ“ Standard home page
      âœ“ a post
      âœ“ paginated index
      âœ“ tag page
      âœ“ paginated tag page
      âœ“ author page
      âœ“ paginated author page
      âœ“ private route for password protection
      âœ“ post with tags
      âœ“ v0.1: a static page
      âœ“ v2: a static page
      âœ“ a static page with custom template (is now the same as one without)

  {{content}} helper
    âœ“ renders empty string when null
    âœ“ can render content
    âœ“ can truncate html by word
    âœ“ can truncate html to 0 words
    âœ“ can truncate html by character

  {{date}} helper
    âœ“ creates properly formatted date strings
    âœ“ creates properly formatted time ago date strings

  {{encode}} helper
    âœ“ can escape URI

  {{excerpt}} Helper
    âœ“ renders empty string when html and excerpt are null
    âœ“ can render excerpt
    âœ“ does not output HTML
    âœ“ strips multiple inline footnotes
    âœ“ strips inline and bottom footnotes
    âœ“ can truncate html by word
    âœ“ can truncate html with non-ascii characters by word
    âœ“ can truncate html by character
    âœ“ uses custom excerpt if provided instead of truncating html
    âœ“ does not truncate custom excerpt if characters options is provided
    âœ“ does not truncate custom excerpt if words options is provided

  {{facebook_url}} helper
    ï¿½ï¿½ï¿½ should output the facebook url for @blog, if no other facebook username is provided
    âœ“ should output the facebook url for the local object, if it has one
    âœ“ should output the facebook url for the provided username when it is explicitly passed in
    âœ“ should return null if there are no facebook usernames

  {{#foreach}} helper
    (function call)
      âœ“ should not populate data if no private data is supplied (array)
      âœ“ should not populate data if no private data is supplied (object)
      âœ“ should populate data when private data is supplied (array)
      âœ“ should populate data when private data is supplied (object)
      âœ“ should handle rowStart and rowEnd for multiple columns (array)
      âœ“ should handle rowStart and rowEnd for multiple columns (array)
      âœ“ should return the correct inverse result if no context is provided
    (compile)
      âœ“ object and @key
      âœ“ @index
      âœ“ @number
      âœ“ nested @index
      âœ“ array block params
      âœ“ object block params
      âœ“ @first
      âœ“ nested @first
      âœ“ @last
      âœ“ nested @last
      âœ“ @last in foreach with limit
      âœ“ foreach with limit 1
      âœ“ foreach with limit 3
      âœ“ foreach with from 2
      âœ“ foreach with to 4
      âœ“ foreach with from 2 and to 3
      âœ“ foreach with from 3 and limit 2
      âœ“ foreach with from 2, to 5 and limit 3
      âœ“ @first in foreach with from 2 and to 4
      âœ“ @last in foreach with from 2 and to 4
      âœ“ @last in foreach with from 4
      âœ“ @first in foreach with from 4
      âœ“ @last in foreach with to 4
      âœ“ @first in foreach with to 4
      âœ“ @last in foreach with from 4 and limit 3
      âœ“ @first in foreach with from 4 and limit 3
      âœ“ @last in foreach with to 4 and limit 3
      âœ“ @first in foreach with to 4 and limit 3
      Internal Tags
        âœ“ will not output internal tags
        âœ“ should still correctly apply from & limit tags
        âœ“ should output all tags with visibility="all"
        âœ“ should output all tags with visibility property set with visibility="public,internal"
        âœ“ should output all tags with visibility="internal"
        âœ“ should output nothing if all tags are internal

  {{#get}} helper
    âœ“ errors correctly if labs flag not set
    posts v0.1
      âœ“ should handle default browse posts call
      âœ“ should return pagination and meta pagination with default browse posts call
      âœ“ should not return pagination if meta pagination does not exist
      âœ“ should handle browse posts call with limit 3
      âœ“ should handle browse posts call with limit 1
      âœ“ should handle browse posts call with limit 1
      âœ“ should handle browse post call with explicit tag
      âœ“ should handle browse post call with explicit author
      âœ“ should handle browse post call with featured:true
      âœ“ should handle read post by id call
      âœ“ should handle empty result set
    users v0.1
      âœ“ browse users v0.1
    authors v0.1
      âœ“ browse users v0.1
    users v2
      âœ“ browse users
    authors v2
      âœ“ browse users
    general error handling
      âœ“ should return an error for an unknown resource
      âœ“ should handle error from the API
      âœ“ should show warning for call without any options
    path resolution
      âœ“ should resolve post.tags alias
      âœ“ should resolve post.author alias
      âœ“ should resolve basic path
      âœ“ should handle arrays the same as handlebars
      âœ“ should handle dates
      âœ“ should output nothing if path does not resolve
      âœ“ should resolve global props

  {{ghost_foot}} helper
    âœ“ outputs global injected code
    âœ“ outputs post injected code
    âœ“ handles post injected code being null
    âœ“ handles post injected code being empty
    âœ“ handles global empty code injection
    âœ“ handles global undefined code injection

  {{ghost_head}} helper
    without Code Injection
      âœ“ returns meta tag string on paginated index page without structured data and schema
      âœ“ returns structured data on first index page
      âœ“ returns structured data on static page
      âœ“ returns structured data on static page with custom post structured data
      âœ“ returns structured data on post page with author image and post cover image
      âœ“ returns structured data on post page with custom excerpt for description and meta description
      âœ“ returns structured data on post page with fall back excerpt if no meta description provided
      âœ“ returns structured data on AMP post page with author image and post cover image
      âœ“ returns structured data if metaTitle and metaDescription have double quotes
      âœ“ returns structured data without tags if there are no tags
      âœ“ returns structured data on post page with null author image and post cover image
      âœ“ returns twitter and facebook descriptions even if no meta description available
      âœ“ returns canonical URL
      âœ“ returns next & prev URL correctly for middle page
      âœ“ returns next & prev URL correctly for second page
      âœ“ returns structured data and schema first tag page with meta description and meta title
      âœ“ tag first page without meta data if no meta title and meta description, but model description provided
      âœ“ tag first page without meta and model description returns no description fields
      âœ“ does not return structured data on paginated tag pages
      âœ“ returns structured data and schema on first author page with cover image
      âœ“ does not return structured data on paginated author pages
      âœ“ returns meta tag string even if safeVersion is invalid
      âœ“ disallows indexing for preview pages
      âœ“ implicit indexing settings for non-preview pages
      âœ“ outputs structured data but not schema for custom collection
      with /blog subdirectory
        âœ“ returns correct rss url with subdirectory
    with changed origin in config file
      âœ“ contains the changed origin
    with useStructuredData is set to false in config file
      âœ“ does not return structured data
    with Code Injection
      âœ“ returns meta tag plus injected code
      âœ“ outputs post codeinjection as well
      âœ“ handles post codeinjection being empty
      âœ“ handles post codeinjection being null
      âœ“ returns meta tag without injected code for amp context
    with Ajax Helper
      âœ“ renders script tag with src
      âœ“ renders script tag with init correctly
      âœ“ does not render script tag with for amp context
    amp is disabled
      âœ“ does not contain amphtml link

  {{#has}} helper
    tag match
      âœ“ should handle tag list that validates true
      âœ“ should handle tags with case-insensitivity
      âœ“ should match exact tags, not superstrings
      âœ“ should match exact tags, not substrings
      âœ“ should handle tag list that validates false
      âœ“ should not do anything if there are no attributes
      âœ“ should not do anything when an invalid attribute is given
      âœ“ count:0
      âœ“ count:3
      âœ“ count:11
      âœ“ count:>3
      âœ“ count:>2
      âœ“ count:<1
      âœ“ count:<3
    author match
      âœ“ should handle author list that evaluates to true
      âœ“ should handle author list that evaluates to false
      âœ“ should handle authors with case-insensitivity
      âœ“ should handle tags and authors like an OR query (pass)
      âœ“ should handle tags and authors like an OR query (pass)
      âœ“ should handle tags and authors like an OR query (fail)
      âœ“ count:0
      âœ“ count:1
      âœ“ count:>1
      âœ“ count:>1
      âœ“ count:>2
      âœ“ count:<1
      âœ“ count:<3
    number match (1-based index)
      âœ“ will match on an exact number (pass)
      âœ“ will match on an exact number (fail)
      âœ“ will match on an exact number (loop)
      âœ“ will match on a number list (pass)
      âœ“ will match on a number list (fail)
      âœ“ will match on a number list (loop)
      âœ“ will match on a nth pattern (pass)
      âœ“ will match on a nth pattern (fail)
      âœ“ will match on a nth pattern (loop)
      âœ“ fails gracefully if there is no number property
      âœ“ fails gracefully if there is no data property
    index match (0-based index)
      âœ“ will match on an exact index (pass)
      âœ“ will match on an exact index (fail)
      âœ“ will match on an exact index (loop)
      âœ“ will match on an index list (pass)
      âœ“ will match on an index list (fail)
      âœ“ will match on an index list (loop)
      âœ“ will match on a nth pattern (pass)
      âœ“ will match on a nth pattern (fail)
      âœ“ will match on a nth pattern (loop)
      âœ“ fails gracefully if there is no index property
    slug match
      âœ“ matches on an exact slug (pass)
      âœ“ matches on an exact slug (fail)
      âœ“ fails gracefully if there is no slug (fail)
    id match
      âœ“ matches on an exact id (pass)
      âœ“ matches on an exact id (fail)
      âœ“ fails gracefully if there is no id (fail)
    any match
      âœ“ matches on a single property (pass)
      âœ“ matches on a single property (fail)
      âœ“ matches on multiple properties (pass)
      âœ“ matches on multiple properties (fail)
      âœ“ matches on global properties (pass)
      âœ“ matches on global properties (fail)
      âœ“ matches on path expressions (pass)
      âœ“ matches on path expressions (fail)
    all match
      âœ“ matches on a single property (pass)
      âœ“ matches on a single property (fail)
      âœ“ matches on multiple properties (pass)
      âœ“ matches on multiple properties (fail)
      âœ“ matches on global properties (pass)
      âœ“ matches on global properties (fail)
      âœ“ matches on path expressions (pass)
      âœ“ matches on path expressions (fail)

  {{image}} helper
    âœ“ should output relative url of image
    âœ“ should output relative url of image if the input is absolute
    âœ“ should output absolute url of image if the option is present 
    âœ“ should NOT output absolute url of image if the option is "false" 
    âœ“ should output author url
    âœ“ should have no output if the image attributeis not provided (with warning)
    âœ“ should have no output if the image attribute evaluates to undefined (with warning)
    âœ“ should have no output if the image attribute evaluates to null (no waring)
    with sub-directory
      âœ“ should output relative url of image
      âœ“ should output absolute url of image if the option is present 
      âœ“ should not change output for an external url
    image_sizes
      âœ“ should output correct url for absolute paths which are internal
      âœ“ should output the correct url for protocol relative urls
      âœ“ should output the correct url for relative paths

  Helpers
    Load Core Helpers
      âœ“ should have exactly the right helpers

  {{#is}} helper
    âœ“ should match single context "index"
    âœ“ should match OR context "index, paged"
    âœ“ should not match "paged"
    âœ“ should log warning with no args

  {{lang}} helper
    âœ“ returns correct language tag

  {{meta_description}} helper
    âœ“ returns correct blog description
    âœ“ returns empty description on paginated page
    âœ“ returns empty description for a tag page
    âœ“ returns empty description for a paginated tag page
    âœ“ returns tag meta_description if present for a tag page
    âœ“ returns empty description on paginated tag page that has meta data
    âœ“ returns empty description for an author page
    âœ“ returns empty description for a paginated author page
    âœ“ returns empty description when meta_description is not set
    âœ“ returns meta_description on post with meta_description set
    âœ“ returns meta_description on post when used within {{#foreach posts}}

  {{meta_title}} helper
    âœ“ returns correct title for homepage
    âœ“ returns correct title for paginated page
    âœ“ returns correct title for a post
    âœ“ returns correct title for a post with meta_title set
    âœ“ returns correct title for a page with meta_title set
    âœ“ returns correct title for a tag page
    âœ“ returns correct title for a paginated tag page
    âœ“ uses tag meta_title to override default response on tag page
    âœ“ uses tag meta_title to override default response on paginated tag page
    âœ“ returns correct title for an author page
    âœ“ returns correct title for a paginated author page
    âœ“ returns correctly escaped title of a post
    âœ“ returns meta_title on post when used within {{#foreach posts}}

  {{navigation}} helper
    âœ“ should throw errors on invalid data
    âœ“ can render empty nav
    âœ“ can handle relativeUrl not being set (e.g. for images/assets)
    âœ“ can render one item
    âœ“ can render multiple items
    âœ“ can annotate the current url
    âœ“ can annotate current url with trailing slash
    âœ“ doesn't html-escape URLs
    âœ“ encodes URLs
    âœ“ doesn't double-encode URLs

  {{navigation}} helper with custom template
    âœ“ can render one item and @blog title
    âœ“ can pass attributes through

  {{next_post}} helper
    with valid post data - 
      âœ“ shows 'if' template with next post data
    for valid post with no next post
      âœ“ shows 'else' template
    for invalid post data
      âœ“ shows 'else' template
    for page
      âœ“ shows 'else' template
    for unpublished post
      âœ“ shows 'else' template
    with "in" option
      âœ“ shows 'if' template with prev post data with primary_tag set
      âœ“ shows 'if' template with prev post data with primary_author set
      âœ“ shows 'if' template with prev post data with author set
      âœ“ shows 'if' template with prev post data & ignores in author if author isnt present
      âœ“ shows 'if' template with prev post data & ignores unknown in value
    general error handling
      âœ“ should handle error from the API
      âœ“ should show warning for call without any options

  {{page_url}} helper
    âœ“ can return a valid url when the relative URL is /
    âœ“ can return a valid url when the relative url has a path
    âœ“ should assume 1 if page is undefined

  {{pagination}} helper
    âœ“ should throw if pagination data is incorrect
    âœ“ can render single page with no pagination necessary
    âœ“ can render first page of many with older posts link
    âœ“ can render middle pages of many with older and newer posts link
    âœ“ can render last page of many with newer posts link
    âœ“ validates values

  {{pagination}} helper with custom template
    âœ“ can render single page with @blog.title
    âœ“ can pass attributes through

  {{plural}} helper
    âœ“ will show no-value string
    âœ“ will show no-value string with placement
    âœ“ will show singular string
    âœ“ will show plural string

  {{post_class}} helper
    âœ“ can render class string
    âœ“ can render featured class
    âœ“ can render page class

  {{prev_post}} helper
    with valid post data - 
      âœ“ shows 'if' template with previous post data
    for valid post with no previous post
      âœ“ shows 'else' template
    for invalid post data
      âœ“ shows 'else' template
    for page
      âœ“ shows 'else' template
    for unpublished post
      âœ“ shows 'else' template
    with "in" option
      âœ“ shows 'if' template with prev post data with primary_tag set
      âœ“ shows 'if' template with prev post data with primary_author set
      âœ“ shows 'if' template with prev post data with author set
      âœ“ shows 'if' template with prev post data & ignores in author if author isnt present
      âœ“ shows 'if' template with prev post data & ignores unknown in value
    general error handling
      âœ“ should handle error from the API
      âœ“ should show warning for call without any options

  {{reading_time}} helper
    âœ“ [success] renders reading time for less than one minute text as one minute
    âœ“ [success] renders reading time for one minute text as one minute
    âœ“ [success] renders reading time for just under 1.5 minutes text as one minute
    âœ“ [success] adds time for feature image
    âœ“ [success] adds time for inline images
    âœ“ [failure] does not render reading time when not post

  {{t}} helper
    âœ“ theme translation is DE
    âœ“ theme translation is EN
    âœ“ [fallback] no theme translation file found for FR
    âœ“ [fallback] no theme files at all, use key as translation

  {{tags}} helper
    âœ“ can return string with tags
    âœ“ can use a different separator
    âœ“ can add a single prefix to multiple tags
    âœ“ can add a single suffix to multiple tags
    âœ“ can add a prefix and suffix to multiple tags
    âœ“ can add a prefix and suffix with HTML
    âœ“ does not add prefix or suffix if no tags exist
    âœ“ can autolink tags to tag pages
    âœ“ can limit no. tags output to 1
    âœ“ can list tags from a specified no.
    âœ“ can list tags to a specified no.
    âœ“ can list tags in a range
    âœ“ can limit no. tags and output from 2
    âœ“ can list tags in a range (ignore limit)
    Internal tags
      âœ“ will not output internal tags by default
      âœ“ should still correctly apply from & limit tags
      âœ“ should output all tags with visibility="all"
      âœ“ should output all tags with visibility property set with visibility="public,internal"
      âœ“ Should output only internal tags with visibility="internal"
      âœ“ should output nothing if all tags are internal

  Helpers Template
    âœ“ can execute a template

  {{title}} Helper
    âœ“ can render title
    âœ“ escapes correctly
    âœ“ returns a blank string where title is missing
    âœ“ returns a blank string where data missing

  {{twitter_url}} helper
    âœ“ should output the twitter url for @blog, if no other twitter username is provided
    âœ“ should output the twitter url for the local object, if it has one
    âœ“ should output the twitter url for the provided username when it is explicitly passed in
    âœ“ should return null if there are no twitter usernames

  {{url}} helper
    âœ“ should return the slug with a prefix slash if the context is a post
    âœ“ should output an absolute URL if the option is present
    âœ“ should output an absolute URL with https if the option is present and secure
    âœ“ should return the slug with a prefixed /tag/ if the context is a tag
    âœ“ should return the slug with a prefixed /author/ if the context is author
    âœ“ should return / if not a post or tag
    âœ“ should return a relative url if passed through a nav context
    âœ“ should return an absolute url if passed through a nav context
    âœ“ should return an absolute url with https if context is secure
    âœ“ external urls should be retained in a nav context
    âœ“ should handle hosted urls in a nav context
    âœ“ should handle hosted urls in a nav context with secure
    âœ“ should handle hosted https urls in a nav context with secure
    âœ“ should handle hosted urls with the wrong protocol in a nav context
    âœ“ should pass through protocol-less URLs regardless of absolute setting
    âœ“ should pass through URLs with alternative schemes regardless of absolute setting
    âœ“ should pass through anchor-only URLs  regardless of absolute setting
    âœ“ should not HTML-escape URLs
    âœ“ should encode URLs
    âœ“ should not double-encode URLs
    with subdir
      âœ“ external urls should be retained in a nav context with subdir
      âœ“ should handle subdir being set in nav context

  Helpers Utils
    Word Count
      âœ“ [success] can count words
      âœ“ [success] sanitized HTML tags
      âœ“ [success] sanitized non alpha-numeric characters
      âœ“ [success] counted Chinese characters
      âœ“ [success] sanitized white space correctly
    Image Count
      âœ“ [success] can count images

  Errors
    âœ“ Ensure we inherit from Error
    Inherite from other error
      âœ“ default
      âœ“ has nested object
      âœ“ with custom attribute
      âœ“ with custom attribute
      âœ“ error is string

  lib/fs/package-json
    âœ“ should filter packages correctly
    âœ“ should filter packages and handle a single active package string
    âœ“ should filter packages and handle an array of active packages
    âœ“ handles packages with no package.json even though this makes us sad
    âœ“ filters out things which are not packages

  lib/fs/package-json: parse
    âœ“ should parse valid package.json
    âœ“ should fail when name is missing
    âœ“ should fail when version is missing
    âœ“ should fail when JSON is invalid
    âœ“ should fail when file is missing

  lib/fs/package-json: read
    all
      âœ“ should read directory and ignore unneeded items
      âœ“ should read directory and parse package.json files
      âœ“ should read directory and ignore invalid package.json files
    one
      âœ“ should read directory and ignore unneeded items
      âœ“ should read directory and parse package.json files
      âœ“ should read directory and ignore invalid package.json files
      âœ“ should read directory and include only single requested package
      âœ“ should return an error if package cannot be found
      âœ“ should return empty object if package is not a directory

  lib/fs: read csv
    âœ“ read csv: one column
    âœ“ read csv: two columns, 1 filter
    âœ“ read csv: two columns, 2 filters

  lib/fs: read csv
    âœ“ ensure symlinks work (270ms)

  Utils: Ghost Version
    âœ“ default
    âœ“ pre-release
    âœ“ pre-release .1
    âœ“ build
    âœ“ mixed
    âœ“ mixed 1

  lib/image: blog icon
    getIconUrl
      âœ“ custom uploaded ico blog icon
      âœ“ custom uploaded png blog icon
      âœ“ default ico blog icon
      absolute URL
        âœ“ custom uploaded ico blog icon
        âœ“ custom uploaded png blog icon
        âœ“ default ico blog icon
      with subdirectory
        âœ“ custom uploaded ico blog icon
        âœ“ custom uploaded png blog icon
        âœ“ default ico blog icon
    getIconPath
      âœ“ custom uploaded ico blog icon
      âœ“ custom uploaded png blog icon
      âœ“ default ico blog icon
      with subdirectory
        âœ“ custom uploaded ico blog icon
        âœ“ custom uploaded png blog icon
        âœ“ default ico blog icon
    isIcoImageType
      âœ“ returns true, if icon is .ico filetype
      âœ“ returns false, if icon is not .ico filetype
    getIconType
      âœ“ returns x-icon for ico icons
      âœ“ returns png for png icon
    getIconDimensions
      âœ“ [success] returns .ico dimensions
      âœ“ [success] returns .png dimensions
      âœ“ [success] returns .ico dimensions for icon with multiple sizes
      âœ“ [failure] return error message

  lib/image: image size cache
    âœ“ should read from cache, if dimensions for image are fetched already
    âœ“ can handle image-size errors
    âœ“ should return null if url is undefined

  lib/image: gravatar
    âœ“ can successfully lookup a gravatar url
    âœ“ can handle a non existant gravatar
    âœ“ will timeout

  lib/image: image size
    âœ“ [success] should have an image size function
    getImageSizeFromUrl
      âœ“ [success] should return image dimensions with http request
      âœ“ [success] should return image dimensions with https request
      âœ“ [success] should return image dimensions when no image extension given
      âœ“ [success] should returns largest image value for .ico files
      âœ“ [success] should return image dimensions asset path images
      âœ“ [success] should return image dimensions for gravatar images request
      âœ“ [success] can handle redirect
      âœ“ [success] should switch to local file storage if available
      âœ“ [failure] can handle an error with statuscode not 200
      âœ“ [failure] handles invalid URL
      âœ“ [failure] will timeout
      âœ“ [failure] returns error if `image-size` module throws error
      âœ“ [failure] returns error if request errors
    getImageSizeFromStoragePath
      âœ“ [success] should return image dimensions for locally stored images
      âœ“ [success] should return image dimensions for locally stored images with subdirectory
      âœ“ [success] should return largest image dimensions for locally stored .ico image
      âœ“ [failure] returns error if storage adapter errors
      âœ“ [failure] returns error if `image-size` module throws error

  lib/image: manipulator
    canTransformFileExtension
      âœ“ returns false for ".gif"
      âœ“ returns false for ".svg"
      âœ“ returns false for ".svgz"
      âœ“ returns false for ".ico"
    cases
      âœ“ resize image
      âœ“ skip resizing if image is too small
      âœ“ uses original image as an output when the size (bytes) is bigger after manipulation
      âœ“ sharp throws error during processing
    installation
      âœ“ sharp was not installed

  Soft return atom
    âœ“ generates a `br` tag

  Code card
    âœ“ Renders and escapes
    âœ“ Renders language class if provided
    âœ“ Renders nothing when payload is undefined

  Embed card
    âœ“ Embed Card renders
    âœ“ Plain content renders
    âœ“ Invalid HTML returns
    âœ“ Renders nothing when payload is undefined
    âœ“ Renders caption when provided

  Gallery card
    âœ“ renders a gallery
    âœ“ renders nothing with no images
    âœ“ renders nothing with no valid images
    âœ“ skips invalid images

  HR card
    âœ“ generates a horizontal rule

  HTML card
    ï¿½ï¿½ï¿½ HTML Card renders
    âœ“ Plain content renders
    âœ“ Invalid HTML returns
    âœ“ Renders nothing when payload is undefined

  Image card
    âœ“ renders an image
    âœ“ renders an image with caption
    âœ“ renders an image with alt text
    âœ“ renders an image with title attribute
    âœ“ renders nothing with no src
    sizes
      âœ“ standard
      âœ“ wide
      âœ“ full

  Markdown card
    default
      âœ“ Markdown Card renders
      âœ“ Accepts invalid HTML in markdown
      âœ“ Renders nothing when payload is undefined
      âœ“ [deprecated] version 1

  Unit: lib/mobiledoc/converters
    htmlToMobiledocConverter should be unsupported in node v6
      - should throw when running on node v6

  Mobiledoc converter
    default
      âœ“ renders all default cards and atoms
      âœ“ removes final blank paragraph
      âœ“ removes single blank paragraph
      âœ“ removes single blank paragraph with empty content
      âœ“ doesn't remove last paragraph if it has markups
      âœ“ adds id attributes to headings

  Pipeline
    âœ“ should execute tasks in order
    âœ“ should resolve to initial args when no tasks supplied
    âœ“ should resolve to empty array when no tasks and no args supplied
    âœ“ should pass args to initial task
    âœ“ should allow initial args to be promises
    âœ“ should allow tasks to be promises
    âœ“ should allow tasks and args to be promises

  Unit: lib/promise/sequence
    âœ“ mixed tasks: promise and none promise

  Request
    âœ“ [success] should return response for http request
    âœ“ [success] can handle redirect
    âœ“ [failure] can handle invalid url
    âœ“ [failure] can handle empty url
    âœ“ [failure] can handle an error with statuscode not 200
    âœ“ [failure] returns error if request errors

  Lib: Security - Password
    âœ“ hash plain password (135ms)
    âœ“ compare password (100ms)

  Lib: Security - String
    Safe String
      âœ“ should remove beginning and ending whitespace
      âœ“ can handle null strings
      âœ“ should remove non ascii characters
      âœ“ should replace spaces with dashes
      âœ“ should replace most special characters with dashes
      âœ“ should replace all of the html4 compat symbols in ascii except hyphen and underscore
      âœ“ should replace all of the foreign chars in ascii
      âœ“ should remove special characters at the beginning of a string
      âœ“ should remove apostrophes 
      âœ“ should convert to lowercase
      âœ“ should convert multiple dashes into a single dash
      âœ“ should remove trailing dashes from the result
      âœ“ should handle pound signs
      âœ“ should properly handle unicode punctuation conversion
      âœ“ should not lose or convert dashes if options are passed with truthy importing flag
      âœ“ should still remove/convert invalid characters when passed options with truthy importing flag

  Utils: tokens
    âœ“ generate
    âœ“ compare: success
    âœ“ compare: error
    âœ“ extract
    âœ“ extract
    âœ“ can validate an URI encoded reset token

  lib/social: urls
    âœ“ should have a twitter url function
    âœ“ should have a facebook url function
    twitter
      âœ“ should return a correct concatenated URL
      âœ“ should return a url without an @ sign if one is provided
    facebook
      âœ“ should return a correct concatenated URL
      âœ“ should return a correct concatenated URL for usernames with slashes
      âœ“ should return a correct concatenated URL for usernames which start with a slash

  Unit: models/api_key
    fn: refreshSecret
      âœ“ returns a call to edit passing a new admin secret
      âœ“ returns a call to edit passing a new content secret

  Models: base
    generateSlug
      âœ“ default
      âœ“ slug exists
      âœ“ too long
      âœ“ protected slug
      âœ“ internal tag
      âœ“ contains invisible unicode
    sanitizeData
      âœ“ date is invalid
      âœ“ expect date transformation
      âœ“ date is JS date, ignore
      âœ“ expect date transformation for nested relations
    setEmptyValuesToNull
      âœ“ resets given empty value to null
    destroy
      âœ“ forges model using destroyBy, fetches it, and calls destroy, passing filtered options
      âœ“ uses options.id to forge model, if no destroyBy is provided
    findOne
      âœ“ forges model using filtered data, fetches it passing filtered options and resolves with the fetched model
    edit
      âœ“ resolves with the savedModel after forges model w/ id, fetches w/ filtered options, saves w/ filtered data and options and method=update
      âœ“ sets model.hasTimestamps to false if options.importing is truthy
      âœ“ throws an error if model cannot be found on edit
    add
      âœ“ forges model w/ filtered data,  saves w/ null and options and method=insert
      âœ“ sets model.hasTimestamps to false if options.importing is truthy

  Models: listeners
    on token added
      âœ“ calls updateLastSeen on the user when the token.added event is emited

  Unit: models/invite
    permissible
      action: add
        âœ“ role does not exist
        âœ“ invite owner
        as owner
          âœ“ invite administrator
          âœ“ invite editor
          âœ“ invite author
          âœ“ invite contributor
        as administrator
          âœ“ invite administrator
          âœ“ invite editor
          âœ“ invite author
          âœ“ invite contributor
        as editor
          âœ“ invite administrator
          âœ“ invite editor
          âœ“ invite author
          âœ“ invite contributor
        as author
          âœ“ invite administrator
          âœ“ invite editor
          âœ“ invite author
          âœ“ invite contributor
        as contributor
          âœ“ invite administrator
          âœ“ invite editor
          âœ“ invite author
          âœ“ invite contributor

  Unit: models/permission
    add
      âœ“ [error] validation

  pagination
    paginationUtils
      formatResponse
        âœ“ returns correct pagination object for single page
        âœ“ returns correct pagination object for first page of many
        âœ“ returns correct pagination object for middle page of many
        âœ“ returns correct pagination object for last page of many
        âœ“ returns correct pagination object when page not set
        âœ“ returns correct pagination object for limit all
      parseOptions
        âœ“ should use defaults if no options are passed
        âœ“ should accept numbers for limit and page
        âœ“ should use defaults if bad options are passed
        âœ“ should permit all for limit
      addLimitAndOffset
        âœ“ should add query options if limit is set
        âœ“ should not add query options if limit is not set
    fetchPage
      âœ“ extends Model with fetchPage
      âœ“ calls all paginationUtils and methods
      âœ“ calls all paginationUtils and methods when order set
      âœ“ calls all paginationUtils and methods when group by set
      âœ“ returns expected response
      âœ“ returns expected response even when aggregate is empty

  Unit: models/post
    filter
      âœ“ generates correct query for - filter: tags: [photo, video] + id: -{id},limit of: 3, with related: tags
      âœ“ generates correct query for - filter: authors:[leslie,pat]+(tag:hash-audio,feature_image:-null), with related: authors,tags
      âœ“ generates correct query for - filter: published_at:>'2015-07-20', limit of: 5, with related: tags
      primary_tag/primary_author
        âœ“ generates correct query for - filter: primary_tag:photo, with related: tags
        âœ“ generates correct query for - filter: primary_author:leslie, with related: authors
      bad behavior
        âœ“ generates correct query for - filter: status:[published,draft], limit of: all
    toJSON
      âœ“ ensure mobiledoc revisions are never exposed
    extraFilters
      âœ“ generates correct where statement when filter contains unpermitted values
    enforcedFilters
      âœ“ returns published status filter for public context
      âœ“ returns no status filter for non public context
    defaultFilters
      âœ“ returns no default filter for internal context
      âœ“ returns page:false filter for public context
      âœ“ returns page:false+status:published filter for non public context

  Unit: models/post: uses database (@TODO: fix me)
    Permissible
      As Contributor
        Editing
          âœ“ rejects if changing status
          âœ“ rejects if changing author id
          âœ“ rejects if changing authors.0
          âœ“ ignores if changes authors.1
          âœ“ rejects if post is not draft
          âœ“ rejects if contributor is not author of post
          âœ“ resolves if none of the above cases are true
        Adding
          âœ“ rejects if "published" status
          âœ“ rejects if different author id
          âœ“ rejects if different logged in user and `authors.0`
          âœ“ rejects if same logged in user and `authors.0`, but different author_id
          âœ“ rejects if different logged in user and `authors.0`, but correct author_id
          âœ“ resolves if same logged in user and `authors.0`
          âœ“ resolves if none of the above cases are true
        Destroying
          âœ“ rejects if destroying another author's post
          âœ“ rejects if destroying a published post
          âœ“ resolves if none of the above cases are true
      As Author
        Editing
          âœ“ rejects if editing another's post
          âœ“ rejects if editing another's post (using `authors`)
          âœ“ rejects if changing author
          âœ“ rejects if changing authors
          âœ“ rejects if changing authors and author_id
          âœ“ rejects if changing authors and author_id
          âœ“ resolves if none of the above cases are true
        Adding
          âœ“ rejects if different author id
          âœ“ rejects if different authors
          âœ“ resolves if none of the above cases are true
      Everyone Else
        âœ“ rejects if hasUserPermissions is false and not current owner
        âœ“ resolves if hasUserPermission is true

  Unit: models/session
    parse
      âœ“ converts session_data to an object
    format
      âœ“ converts session_data to a string
      âœ“ does not add session_data key if missing
    user
      âœ“ sets up the relation to the "User" model
    permittedOptions
      âœ“ passes the methodName and the context to the base permittedOptions method
      âœ“ returns the base permittedOptions result
      âœ“ returns the base permittedOptions result plus "session_id" when methodName is upsert
      âœ“ returns the base permittedOptions result plus "session_id" when methodName is destroy
    destroy
      âœ“ calls and returns the Base Model destroy if an id is passed
      âœ“ calls forge with the session_id, fetchs with the filtered options and then destroys with the options
    upsert
      âœ“ calls findOne and then add if findOne results in nothing
      âœ“ calls findOne and then edit if findOne results in nothing

  Unit: models/settings
    events
      âœ“ emits add events (245ms)
      âœ“ emits edit events
    defaults
      âœ“ populates unset defaults (69ms)
      âœ“ doesn't overwrite any existing settings
    parse
      âœ“ ensure correct parsing when fetching from db

  Unit: models/tag
    SQL
      âœ“ generates correct query for - filter: count.posts:>=1, order: count.posts DESC, limit of: all, withRelated: count.posts

  Unit: models/user
    updateLastSeen method
      âœ“ exists
      âœ“ sets the last_seen property to new Date and returns a call to save
    validation
      blank
        âœ“ name cannot be blank
        âœ“ email cannot be blank
    fn: check
      âœ“ user status is warn
      âœ“ user status is active
      âœ“ password is incorrect
    permissible
      âœ“ cannot delete owner
      âœ“ can always edit self
      âœ“ cannot edit my status to inactive
      âœ“ without related roles
      change role
        âœ“ cannot change own role
        âœ“ is owner and does not change the role
        âœ“ cannot change owner's role
        âœ“ admin can change author role
        âœ“ author can't change admin role
      as editor
        âœ“ can't edit another editor
        âœ“ can't edit owner
        âœ“ can't edit an admin
        âœ“ can edit author
        âœ“ can edit contributor
        âœ“ can destroy self
        âœ“ can't destroy another editor
        âœ“ can't destroy an admin
        âœ“ can destroy an author
        âœ“ can destroy a contributor
    transferOwnership
      âœ“ Cannot transfer ownership if not owner
      âœ“ Owner tries to transfer ownership to author
    isSetup
      âœ“ active
      âœ“ inactive

  Ghost SDK Helper
    âœ“ sets url empty if it is not set on init
    âœ“ renders basic url correctly when no arguments are presented
    âœ“ strips arguments of forward and trailing slashes correctly
    âœ“ appends client_id & client_secret to query string automatically
    âœ“ generates query parameters correctly
    âœ“ generates complex query correctly
    âœ“ handles null/undefined queryOptions correctly
    âœ“ should be idempotent

  Apps
    Dependencies
      âœ“ can install by package.json
      âœ“ does not install when no package.json

  Apps
    âœ“ will activate, but not install, internal apps
    âœ“ will activate & install custom apps as needed

  Apps
    Permissions
      âœ“ has default permissions to read and browse posts
      âœ“ uses default permissions if no package.json
      âœ“ uses default permissions if no ghost object in package.json
Unhandled rejection Error: package.json file is malformed
  at Context.<anonymous> (/home/travis/build/TryGhost/Ghost/core/test/unit/services/apps/permissions_spec.js:99:76)
  at callFnAsync (/home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runnable.js:377:21)
  at Test.Runnable.run (/home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runnable.js:324:7)
  at Runner.runTest (/home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runner.js:442:10)
  at /home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runner.js:560:12
  at next (/home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runner.js:356:14)
  at /home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runner.js:366:7
  at next (/home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runner.js:290:14)
  at Immediate._onImmediate (/home/travis/build/TryGhost/Ghost/node_modules/grunt-mocha-cli/node_modules/mocha/lib/runner.js:334:5)
  at runCallback (timers.js:705:18)
  at tryOnImmediate (timers.js:676:5)
  at processImmediate (timers.js:658:5)

      âœ“ rejects when reading malformed package.json
      âœ“ reads from package.json in root of app directory

  Apps
    Proxy
      âœ“ requires a name to be passed
      âœ“ requires permissions to be passed
      âœ“ creates a ghost proxy
      âœ“ allows filter registration with permission
      âœ“ does not allow filter registration without permission
      âœ“ allows filter deregistration with permission
      âœ“ does not allow filter deregistration without permission
      âœ“ allows helper registration with permission
      âœ“ does not allow helper registration without permission
      âœ“ does allow INTERNAL app to register helper without permission

  Apps
    sinon
      âœ“ loads apps in a sinon
      âœ“ does not allow apps to require blacklisted modules at top level
      âœ“ does not allow apps to require blacklisted modules at install
      âœ“ does not allow apps to require blacklisted modules from other requires
      âœ“ does not allow apps to require modules relatively outside their directory
      âœ“ does allow INTERNAL apps to require modules relatively outside their directory

  Admin API Key Auth
    âœ“ should authenticate known+valid API key
    âœ“ shouldn't authenticate with missing Ghost token
    âœ“ shouldn't authenticate with broken Ghost token
    âœ“ shouldn't authenticate with invalid/unknown key
    âœ“ shouldn't authenticate with JWT signed > 5min ago
    âœ“ shouldn't authenticate with JWT with maxAge > 5min
    âœ“ shouldn't authenticate with a Content API Key

  Content API Key Auth
    âœ“ should authenticate with known+valid key
    âœ“ shouldn't authenticate with invalid/unknown key
    âœ“ shouldn't authenticate with a non-content-api key

  Auth Strategies
    Client Password Strategy
      âœ“ should find client
      âœ“ shouldn't find client with invalid id
      âœ“ shouldn't find client with invalid secret
      âœ“ shouldn't auth client that is disabled
    Bearer Strategy
      âœ“ should find user with valid token
      âœ“ should find user with valid token, but user is suspended
      âœ“ shouldn't find user with invalid token
      âœ“ should find user that doesn't exist
      âœ“ should find user with expired token
    Ghost Strategy
      âœ“ with invite, but with wrong invite token
      âœ“ with correct invite token, but expired
      âœ“ with correct invite token
      âœ“ setup
      âœ“ sign in
      âœ“ sign in, but user is suspended

  Auth
    âœ“ should require authorized user (user exists)
    âœ“ should require authorized user (user is missing)
    User Authentication
      âœ“ should authenticate user
      âœ“ shouldn't pass with client, no bearer token
      âœ“ shouldn't authenticate user
      âœ“ shouldn't authenticate without bearer token
      âœ“ shouldn't authenticate with bearer token and client
      âœ“ shouldn't authenticate when error
    Client Authentication
      âœ“ shouldn't require authorized client with bearer token
      âœ“ shouldn't authenticate client with broken bearer token
      âœ“ shouldn't authenticate client without client_id/client_secret
      âœ“ shouldn't authenticate client without client_id
      âœ“ shouldn't authenticate client without client_secret
      âœ“ shouldn't authenticate without full client credentials
      âœ“ shouldn't authenticate invalid/unknown client
      âœ“ should authenticate valid/known client
      âœ“ should authenticate client with id in query
      âœ“ should authenticate client with id + secret in query
      âœ“ shouldn't authenticate when error

  Auth Service - Members
    - exports an authenticateMembersToken method
    authenticateMembersToken
      - calls next without an error if there is no authorization header
      - calls next without an error if the authorization header does not match the GhostMembers scheme
      attempts to verify the credentials as a JWT, allowing the "NONE" algorithm
        - calls next with an UnauthorizedError if the verification fails
        - calls next without an error after attaching the JWT claims to req.member if the verification suceeds

  OAuth
    Generate Token from Password
      âœ“ Successfully generate access token.
      âœ“ Can't generate access token without client.
      âœ“ Can't generate access token without username.
      âœ“ Can't generate access token without password.
      âœ“ Handles database error.
    Generate Token from Refreshtoken
      âœ“ Successfully generate access token.
      âœ“ Can't generate access token without valid refresh token.
      âœ“ Can't generate access token with expired refresh token.
      âœ“ Handles database error.
    Generate Token from Authorization Code
      âœ“ Successfully generate access token.
      âœ“ Error: ghost.org
      âœ“ Error: no authorization_code provided

  Ghost Passport
    [default] local auth
      âœ“ initialise passport with passport auth type

  Session Service
    createSession
Tue, 16 Apr 2019 02:33:42 GMT express-session deprecated req.secret; provide secret option at core/server/services/auth/session/middleware.js:33:27
      âœ“ calls next with a BadRequestError if there is no Origin or Refferer
      âœ“ sets req.session.origin from the Referer header
      âœ“ sets req.session.user_id,origin,user_agent,ip and calls sendStatus with 201 if the check succeeds
    destroySession
      âœ“ calls req.session.destroy
      âœ“ calls next with InternalServerError if destroy errors
      âœ“ calls sendStatus with 204 if destroy does not error
    CSRF protection
      âœ“ calls next if the session is uninitialized
      âœ“ calls next if req origin matches the session origin
      âœ“ calls next with BadRequestError if the origin of req does not match the session

  Auth Service SessionStore
    inheritance
      âœ“ Is an instance of EventEmitter
      âœ“ Is an instance of Store
    SessionStore#destroy
      âœ“ calls destroy on the model with the session_id `sid`
      âœ“ calls back with null if destroy resolve
      âœ“ calls back with the error if destroy errors
    SessionStore#get
      âœ“ calls findOne on the model with the session_id `sid`
      âœ“ callsback with null, null if findOne does not return a model
      âœ“ callsback with null, model.session_data if findOne does return a model
      âœ“ callsback with an error if the findOne does error
    SessionStore#set
      âœ“ calls back with an error if there is no user_id on the session_data
      âœ“ calls upsert on the model with the session_id and the session_data
      âœ“ calls back with an error if upsert errors
      âœ“ calls back with null, null if upsert succeed

  Mail: Ghostmailer
    âœ“ should attach mail provider to ghost instance (106ms)
    âœ“ should setup SMTP transport on initialization
    âœ“ should fallback to direct if config is empty
    âœ“ sends valid message successfully 
    âœ“ handles failure
    âœ“ should fail to send messages when given insufficient data
    Direct
      âœ“ return correct failure message for domain doesn't exist
      âœ“ return correct failure message for no mail server at this address (55ms)
      âœ“ return correct failure message for incomplete data
    From address
      âœ“ should use the config
      âœ“ should fall back to [blog.title] <ghost@[blog.url]>
      âœ“ should use mail.from
      âœ“ should attach blog title
      âœ“ should ignore theme title if from address is Title <email@address.com> format
      âœ“ should use default title if not theme title is provided

  Mail: Utils
    âœ“ generate welcome
    âœ“ generates newsletter template (41ms)

  Permissions
    CanThis
      âœ“ canThisResult gets build properly
      Non user/app permissions
        with permissible calls (post model)
          âœ“ No context: does not allow edit post (no model)
          âœ“ No context: does not allow edit post (model syntax)
          âœ“ No context: does not allow edit post (model ID syntax)
          âœ“ Internal context: instantly grants permissions
          âœ“ External context: does not grant permissions
        without permissible (tag model)
          âœ“ No context: does not allow edit tag (model syntax)
          âœ“ Internal context: instantly grants permissions
          âœ“ External context: does not grant permissions
      User-based permissions
        âœ“ No permissions: cannot edit tag (no permissible function on model)
        âœ“ With permissions: can edit specific tag (no permissible function on model)
        âœ“ With permissions: can edit non-specific tag (no permissible function on model)
        âœ“ Specific permissions: can edit correct specific tag (no permissible function on model)
        âœ“ Specific permissions: cannot edit incorrect specific tag (no permissible function on model)
        âœ“ Specific permissions: CAN edit non-specific tag (no permissible function on model) @TODO fix this
        âœ“ With owner role: can edit tag (no permissible function on model)
      API Key-based permissions
        âœ“ With permissions: can edit non-specific tag (no permissible function on model)
      App-based permissions (requires user as well)
        âœ“ No permissions: cannot edit tag with app only (no permissible function on model)
        âœ“ No permissions: cannot edit tag (no permissible function on model)
        âœ“ With permissions: can edit specific tag (no permissible function on model)
        âœ“ With permissions: can edit non-specific tag (no permissible function on model)
    permissible (overridden)
      âœ“ can use permissible function on model to forbid something (post model)
      âœ“ can use permissible function on model to allow something (post model)

  Permissions
    No init (no action map)
      âœ“ throws an error without actionMap
    Init (build actions map)
      âœ“ can load an actions map from existing permissions
      âœ“ can load an actions map from existing permissions, and deduplicate

  Permissions
    parseContext
      âœ“ should return public for no context
      âœ“ should return public for random context
      âœ“ should return user if user populated
      âœ“ should return api_key and public context if content api_key provided
      âœ“ should return api_key and non public context if admin api_key provided
      âœ“ should return app if app populated
      âœ“ should return internal if internal provided
      âœ“ should return external if external provided

  Permission Providers
    User
      âœ“ errors if user cannot be found
      âœ“ can load user with role, and permissions
      âœ“ can load user with role, and role.permissions
      âœ“ can load user with role, permissions and role.permissions and deduplicate them
    API Key
      âœ“ errors if api_key cannot be found
      âœ“ can load api_key with role, and role.permissions
    App
      âœ“ returns empty array if app cannot be found!
      âœ“ can load user with role, and permissions

  Permissions
    applyPublicRules
      âœ“ should return empty object for docName with no rules
      âœ“ should return unchanged object for non-public context
      âœ“ should return unchanged object for post with public context
      âœ“ should throw an error for draft post without uuid (read)
      âœ“ should throw an error for draft post (browse)
      âœ“ should permit post draft status with uuid (read)
      âœ“ should permit post all status with uuid (read)
      âœ“ should NOT permit post draft status with uuid (browse)
      âœ“ should NOT permit post all status with uuid (browse)
      âœ“ should throw an error for draft post with uuid and id or slug (read)
      âœ“ should return unchanged object for user with public context

  UNIT - services/routing/CollectionRouter
    instantiate
      âœ“ default
      âœ“ router name
      âœ“ collection lives under /blog/
      âœ“ with custom filter
      âœ“ with templates
    fn: _prepareEntriesContext
      âœ“ index collection
      âœ“ with templates, with order + limit, no index collection
    timezone changes
      no dated permalink
        âœ“ default
        âœ“ tz has not changed
      with dated permalink
        âœ“ default
        âœ“ tz has not changed

  Unit - services/routing/controllers/channel
    âœ“ no params
    âœ“ pass page param
    âœ“ update hbs engine: router defines limit
    âœ“ page param too big
    âœ“ slug param
    âœ“ invalid posts per page
    âœ“ ensure secure helper get's called for data object

  Unit - services/routing/controllers/collection
    âœ“ no params
    âœ“ pass page param
    âœ“ update hbs engine: router defines limit
    âœ“ page param too big
    âœ“ slug param
    âœ“ invalid posts per page
    âœ“ ensure secure helper get's called for data object
    âœ“ should verify if post belongs to collection

  Unit - services/routing/controllers/entry
    âœ“ resource not found
    âœ“ resource found
    [edge cases] resource found
      âœ“ isUnknownOption: true
      âœ“ isEditURL: true
      âœ“ type of router !== type of resource
      âœ“ requested url !== resource url
      âœ“ requested url !== resource url: with query params

  Unit - services/routing/controllers/preview
    v0.1
      âœ“ should render post
      âœ“ should call next if post is not found
      âœ“ should call redirect if post is published
      âœ“ should call redirect if /edit/ (options param) is detected
      âœ“ should call next for unknown options param detected
    v2
      âœ“ should render post

  Unit - services/routing/controllers/rss
    âœ“ should fetch data and attempt to send XML
    âœ“ can handle paginated urls
    âœ“ can handle paginated urls with subdirectories
    âœ“ can handle paginated urls for taxonomies
    âœ“ should call next with 404 if page number too big

  Unit - services/routing/controllers/static
    âœ“ no extra data to fetch
    âœ“ extra data to fetch

  Contexts
    Unknown
      âœ“ should return empty array with no error if all parameters are empty
      âœ“ should return empty array with no error with basic parameters
    index context
      âœ“ should correctly identify index channel
      âœ“ should correctly identify / as home
      âœ“ will not identify / as index without config
      âœ“ will not identify /page/2/ as index & paged without page param
      âœ“ should identify /page/2/ as index & paged with page param
    Tag
      âœ“ should correctly identify tag channel
      âœ“ will not identify tag channel url without config
      âœ“ will not identify /page/2/ as paged without page param
      âœ“ should correctly identify /page/2/ as paged with page param
    Author
      âœ“ should correctly identify author channel
      âœ“ will not identify author channel url without config
      âœ“ will not identify /page/2/ as paged without page param
      âœ“ should correctly identify /page/2/ as paged with page param
    Custom
      âœ“ will use a custom context
    Posts & Pages
      âœ“ ensure correct context
    Private
      âœ“ should correctly identify /private/ as the private route
    Subscribe
      âœ“ should identify /subscribe/ as the subscribe route if labs flag set
      âœ“ should not identify /subscribe/ as subscribe route if labs flag NOT set
    AMP
      âœ“ should correctly identify AMP post
      âœ“ should correctly identify AMP page

  Unit - services/routing/helpers/entry-lookup
    v0.1
      static pages
        âœ“ ensure posts controller is triggered
      Permalinks: /:slug/
        âœ“ can lookup absolute url: /:slug/
        âœ“ can lookup relative url: /:slug/
        âœ“ cannot lookup absolute url: /:year/:month/:day/:slug/
        âœ“ cannot lookup relative url: /:year/:month/:day/:slug/
      Permalinks: /:year/:month/:day/:slug/
        âœ“ cannot lookup absolute url: /:slug/
        âœ“ cannot lookup relative url using :slug
        âœ“ can lookup absolute url: /:year/:month/:day/:slug/
        âœ“ can lookup relative url: /:year/:month/:day/:slug/
      with url options
        âœ“ can lookup absolute url: /:slug/edit/
        âœ“ can lookup relative url: /:slug/edit/
        âœ“ cannot lookup absolute url: /:year/:month/:day/:slug/edit/
        âœ“ cannot lookup relative url: /:year/:month/:day/:slug/edit/
        âœ“ unknown url option
    v2
      static pages
        âœ“ ensure pages controller is triggered
      posts
        âœ“ ensure posts controller is triggered

  handleError
    âœ“ should call next with no args for 404 errors
    âœ“ should call next with error for other errors

  Unit - services/routing/helpers/fetch-data
    âœ“ should handle no options
    âœ“ should handle path options with page/limit
    âœ“ should handle multiple queries
    âœ“ should handle multiple queries with page param
    âœ“ should handle queries with slug replacements

  Unit - services/routing/helpers/format-response
    entry
      âœ“ should return the post object wrapped in a post key
    entries
      âœ“ should return posts and posts pagination as top level keys
      âœ“ should flatten api read responses which have no pagination data
      âœ“ should remove the meta key from api browse responses

  templates
    [private fn] getEntriesTemplateHierarchy
      âœ“ should return just index for empty options
      âœ“ should return just index if collection name is index
      âœ“ should return custom templates even if the collection is index
      âœ“ should return collection name
      âœ“ should return custom templates
      âœ“ should return just index if collection name is index even if slug is set
      âœ“ should return collection, index if collection has name
      âœ“ should return collection-slug, collection, index if collection has name & slug + slugTemplate set
      âœ“ should return front, collection-slug, collection, index if name, slugParam+slugTemplate & frontPageTemplate+pageParam=1 is set
      âœ“ should return home, index for index collection if front is set and pageParam = 1
      âœ“ should not use frontPageTemplate if not / collection
    [private fn] pickTemplate
      âœ“ returns fallback if there is no active_theme
      âœ“ returns fallback if active_theme has no templates
      with many templates
        âœ“ returns first matching template
        âœ“ returns correctly if template list is a string
    [private fn] getTemplateForEntry
      âœ“ will fall back to post even if no index.hbs
      with many templates
        âœ“ post without custom slug template
        âœ“ post with custom slug template
        âœ“ page without custom slug template
        âœ“ page with custom slug template
        âœ“ post with custom template
        âœ“ page with custom template
        âœ“ post with custom template configured, but the template is missing
        âœ“ page with custom template configured, but the template is missing
        âœ“ post with custom template configured, but slug template exists
        âœ“ post with custom template configured, but slug template exists, but can't be found
    [private fn] getTemplateForEntries
      âœ“ will fall back to index even if no index.hbs
      without tag templates
        âœ“ will return correct view for a tag
      with tag templates
        âœ“ will return correct view for a tag
        âœ“ will return correct view for a tag
    [private fn] getTemplateForError
      âœ“ will fall back to default if there is no active_theme
      âœ“ will fall back to default for all statusCodes with no custom error templates
      âœ“ will use custom error.hbs for all statusCodes if there are no other templates
      âœ“ will use more specific error-4xx.hbs for all 4xx statusCodes if available
      âœ“ will use explicit error-404.hbs for 404 statusCode if available
      âœ“ cascade works the same for 500 errors
      âœ“ cascade works with many specific templates
    fn: setTemplate
      âœ“ does nothing if template is already set
      âœ“ defaults to index
      âœ“ calls pickTemplate for custom routes
      âœ“ calls pickTemplate for custom routes
      âœ“ calls getTemplateForEntry for entry routes
      âœ“ calls getTemplateForEntries for type collection
      âœ“ calls getTemplateForEntries for type channel
      âœ“ calls getTemplateForError if there is an error

  UNIT: services/routing/middlewares/page-param
    âœ“ success
    âœ“ redirect for /page/1/
    âœ“ 404 for /page/0/
    âœ“ 404 for /page/something/
    âœ“ redirect for /rss/page/1/

  UNIT - services/routing/ParentRouter
    fn: _getSiteRouter
      âœ“ find site router
    fn: _respectDominantRouter
      âœ“ redirect
      âœ“ redirect with query params
      âœ“ redirect rss
      âœ“ redirect pagination
      âœ“ redirect correctly with subdirectory
      âœ“ no redirect: different data key
      âœ“ no redirect: no channel defined
      âœ“ redirect primary tag permalink
    fn: isRedirectEnabled
      âœ“ no data key defined
      âœ“ no data key defined
      âœ“ no redirect
      âœ“ no redirect
      âœ“ no redirect
      âœ“ redirect
      âœ“ redirect

  UNIT: services/routing/registry
    fn: getRssUrl
      âœ“ no url available
      âœ“ single collection, no index collection
      âœ“ single collection, no index collection, rss disabled
      âœ“ index collection

  UNIT - services/routing/RSSRouter
    instantiate
      âœ“ default
      âœ“ subdirectory is enabled

  UNIT - services/routing/StaticRoutesRouter
    static routes
      âœ“ instantiate: default
      âœ“ initialise with data+filter
      âœ“ fn: _prepareStaticRouteContext
      âœ“ fn: _prepareStaticRouteContext
    channels
      initialise
        âœ“ initialise with controller+data+filter
        âœ“ initialise with controller+filter
        âœ“ initialise with controller+data
        âœ“ initialise on subdirectory with controller+data+filter
      fn: _prepareChannelContext
        âœ“ with data+filter
        âœ“ with data
        âœ“ with filter
        âœ“ with order+limit

  UNIT - services/routing/TaxonomyRouter
    âœ“ instantiate
    âœ“ fn: _prepareContext

  RSS: Cache
    âœ“ should not rebuild xml for same data and url

  RSS: Generate Feed
    âœ“ should get the RSS tags correct
    âœ“ should get the item tags correct
    âœ“ should only return visible tags
    âœ“ should no error if author is somehow not present
    âœ“ should use meta_description and image where available
    âœ“ should use excerpt when no meta_description is set
    âœ“ should process urls correctly
    âœ“ should process urls correctly with subdirectory

  RSS: Renderer
    âœ“ calls the cache and attempts to render, even without data
    âœ“ correctly merges locals into empty data before rendering
    âœ“ correctly merges locals into non-empty data before rendering
    âœ“ does nothing if it gets an error

  UNIT: settings cache
    âœ“ does not auto convert string into number
    âœ“ does not auto convert string into number: float
    âœ“ stringified JSON get's parsed
    âœ“ can get all values
    âœ“ correctly filters and formats public values

  UNIT > Settings Service:
    Ensure settings files
      âœ“ returns yaml file from settings folder if it exists
      âœ“ copies default settings file if not found but does not overwrite existing files
      âœ“ copies default settings file if no file found
      âœ“ rejects, if error is not a not found error

  UNIT > Settings Service:
    Settings Loader
      âœ“ can find yaml settings file and returns a settings object
      âœ“ can handle errors from YAML parser
      âœ“ throws error if file can't be accessed

  UNIT > Settings Service:
    knownSettings
      âœ“ returns supported settings files
    get
      âœ“ returns settings object for `routes`
      âœ“ rejects when requested settings type is not supported
      âœ“ passes SettingsLoader error through
    getAll
      âœ“ returns settings object for all known settings
      âœ“ passes SettinsLoader error through

  UNIT: services/settings/validate
    v0.1
      âœ“ no type definitions / empty yaml file
      âœ“ throws error when using :w+ notiation in collection
      âœ“ throws error when using :w+ notiation in taxonomies
      âœ“ throws error when using an undefined taxonomy
      âœ“ throws error when permalink is missing (collection)
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ no validation error for routes
      âœ“ no validation error for / collection
      âœ“ transforms {.*} notation into :w+
      template definitions
        âœ“ single value
        âœ“ array
      data definitions
        âœ“ shortform
        âœ“ longform
        âœ“ errors: data shortform incorrect
        âœ“ errors: data longform resource is missing
        âœ“ errors: data longform type is missing
        âœ“ errors: data longform name is author
        âœ“ errors: data longform does not use a custom name at all
    v2
      âœ“ no type definitions / empty yaml file
      âœ“ throws error when using :w+ notiation in collection
      âœ“ throws error when using :w+ notiation in taxonomies
      âœ“ throws error when using an undefined taxonomy
      âœ“ throws error when permalink is missing (collection)
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ throws error without leading or trailing slashes
      âœ“ no validation error for routes
      âœ“ no validation error for / collection
      âœ“ transforms {.*} notation into :w+
      template definitions
        âœ“ single value
        âœ“ array
      data definitions
        âœ“ shortform
        âœ“ longform
        âœ“ errors: data shortform incorrect
        âœ“ errors: data longform resource is missing
        âœ“ errors: data longform type is missing
        âœ“ errors: data longform name is author
        âœ“ errors: data longform does not use a custom name at all

  UNIT > Settings Service:
    Yaml Parser
      âœ“ parses correct yaml file
      âœ“ rejects with clear error when parsing fails

  Slack
    âœ“ listen() should initialise event correctly
    âœ“ listener() calls ping() with toJSONified model
    âœ“ listener() does not call ping() when importing
    âœ“ testPing() calls ping() with default message
    ping()
      âœ“ makes a request for a post if url is provided
      âœ“ makes a request for a message if url is provided
      âœ“ makes a request and errors (53ms)
      âœ“ does not make a request if post is a page
      âœ“ does not send webhook for 'welcome' post
      âœ“ handles broken slack settings

  Themes
    Active
      Mount
        âœ“ should mount active theme with partials
        âœ“ should mount active theme without partials

  Themes
    Config
      âœ“ handles no package.json
      âœ“ handles package.json without config
      âœ“ handles allows package.json to overrideg default
      âœ“ handles ignores non-allowed config

  Themes: engines
    âœ“ no engines
    ghost-api
      âœ“ v2
      âœ“ v10
      âœ“ ^0.1
      âœ“ ^2
      âœ“ 2.0.0
      âœ“ 2.17.0
      âœ“ 3

  Themes
    List
      âœ“ get() allows getting a single theme
      âœ“ get() with no args should do nothing
      âœ“ getAll() returns all themes
      âœ“ set() updates an existing theme
      âœ“ set() can add a new theme
      âœ“ del() removes a key from the list
      âœ“ del() with no argument does nothing
      âœ“ init() calls set for each theme
      âœ“ init() with empty object resets the list

  Themes
    Loader
      Load All
        âœ“ should load directory and include only folders
        âœ“ should read directory and read package.json if present
      Load One
        âœ“ should read directory and include only single requested theme
        âœ“ should throw an error if theme cannot be found

  Themes middleware
    âœ“ mounts active theme if not yet mounted
    âœ“ does not mounts the active theme if it is already mounted
    âœ“ throws error if theme is missing
    âœ“ calls updateTemplateOptions with correct data
    âœ“ Sets res.locals.secure to the value of req.secure

  Themes
    Validate
      âœ“ [success] validates a valid zipped theme
      âœ“ [success] validates a valid unzipped theme
      âœ“ [failure] validates an invalid zipped theme
      âœ“ [failure] validates an invalid unzipped theme
      âœ“ [failure] can handle a corrupt zip file

  Unit: services/url/Queue
    âœ“ fn: register
    fn: start (no tolerance)
      âœ“ no subscribers
      âœ“ 1 subscriber
      âœ“ x subscriber
      âœ“ late subscriber
      âœ“ subscriber throws error
    fn: start (with tolerance)
      âœ“ late subscriber
      âœ“ start twice
      âœ“ start twice
      âœ“ late subscribers (553ms)

  Unit: services/url/UrlGenerator
    âœ“ ensure listeners
    âœ“ routing type has filter
    âœ“ routing type has changed
    fn: _onInit
      âœ“ 1 resource
      âœ“ no resource
    fn: _onAdded
      âœ“ type is equal
      âœ“ type is not equal
    fn: _try
      no filter
        âœ“ resource is not taken
        âœ“ resource is taken
      custom filter
        âœ“ matches
        âœ“ no match
        âœ“ resource is taken
    fn: _generateUrl
      âœ“ returns url
    fn: _resourceListeners
      âœ“ ensure events
      âœ“ resource was updated
      âœ“ resource got removed

  Unit: services/url/Urls
    âœ“ fn: add
    âœ“ fn: getByResourceId
    âœ“ fn: getByGeneratorId
    âœ“ fn: getByUrl
    âœ“ fn: removeResourceId

  Unit: services/url/UrlService
    âœ“ instantiate
    âœ“ fn: _onQueueStarted
    âœ“ fn: _onQueueEnded
    âœ“ fn: _onRouterAddedType
    âœ“ fn: getResourceById
    fn: getResource
      âœ“ no resource for url found
      âœ“ no resource for url found
      âœ“ one resource for url found
      âœ“ two resources for url found
      âœ“ two resources for url found
    fn: getPermalinkByUrl
      âœ“ found
      âœ“ found
    fn: getUrlByResourceId
      âœ“ not found
      âœ“ not found: absolute
      âœ“ found
      âœ“ found: absolute
      âœ“ found: absolute + secure
      âœ“ not found: withSubdirectory
      âœ“ not found: withSubdirectory + secure
      âœ“ not found: withSubdirectory + secure + absolute
      âœ“ found: withSubdirectory
      âœ“ found: withSubdirectory + secure
      âœ“ found: withSubdirectory + secure + absolute

  Url
    absoluteToRelative
      âœ“ default
      âœ“ with subdir
      âœ“ with subdir, but request without
      âœ“ with subdir, but request without
    relativeToAbsolute
      âœ“ default
      âœ“ with subdir
      âœ“ should not convert absolute url
      âœ“ should not convert absolute url
      âœ“ should not convert schemeless url
    getProtectedSlugs
      âœ“ defaults
      âœ“ url has subdir
    getSubdir
      âœ“ url has no subdir
      âœ“ url has subdir
      âœ“ should not return a slash for subdir
    urlJoin
      âœ“ should deduplicate slashes
      âœ“ should not deduplicate slashes in protocol
      âœ“ should permit schemeless protocol
      âœ“ should deduplicate subdir
      âœ“ should handle subdir matching tld
    urlFor
      âœ“ should return the home url with no options
      âœ“ should return home url when asked for
      âœ“ should handle weird cases by always returning /
      âœ“ should return url for a random path when asked for
      âœ“ should deduplicate subdirectories in paths
      âœ“ should return url for an image when asked for
      âœ“ should return a url for a nav item when asked for it
      âœ“ sitemap: should return other known paths when requested
      âœ“ admin: relative
      âœ“ admin: url is http
      âœ“ admin: custom admin url is set
      âœ“ admin: blog is on subdir
      âœ“ admin: blog is on subdir
      âœ“ admin: blog is on subdir
      âœ“ admin: blog is on subdir
      âœ“ admin: blog is on subdir
      âœ“ admin: blog is on subdir
      âœ“ admin: blog is on subdir
      âœ“ api: with active version, blog url is https: should return active content api path
      âœ“ api: with active version and admin true, blog url is https: should return active admin api path
      for api version: v0.1
        âœ“ api: should return admin url is set
        âœ“ api: url has subdir
        âœ“ api: relative path is correct
        âœ“ api: relative path with subdir is correct
        âœ“ api: should return http if config.url is http
        âœ“ api: should return https if config.url is https
        âœ“ api: with cors, blog url is http: should return no protocol
        âœ“ api: with cors, admin url is http: cors should return no protocol
        âœ“ api: with cors, admin url is https: should return with protocol
        âœ“ api: with cors, blog url is https: should return with protocol
        âœ“ api: with stable version, blog url is https: should return stable content api path
        âœ“ api: with stable version and admin true, blog url is https: should return stable admin api path
        âœ“ api: with just version and no version type returns correct api path
      for api version: v2
        âœ“ api: should return admin url is set
        âœ“ api: url has subdir
        âœ“ api: relative path is correct
        âœ“ api: relative path with subdir is correct
        âœ“ api: should return http if config.url is http
        âœ“ api: should return https if config.url is https
        âœ“ api: with cors, blog url is http: should return no protocol
        âœ“ api: with cors, admin url is http: cors should return no protocol
        âœ“ api: with cors, admin url is https: should return with protocol
        âœ“ api: with cors, blog url is https: should return with protocol
        âœ“ api: with stable version, blog url is https: should return stable content api path
        âœ“ api: with stable version and admin true, blog url is https: should return stable admin api path
        âœ“ api: with just version and no version type returns correct api path
    replacePermalink
      âœ“ permalink is /:slug/, timezone is default
      âœ“ permalink is /:year/:month/:day/:slug/, blog timezone is Los Angeles
      âœ“ permalink is /:year/:month/:day/:slug/, blog timezone is Asia Tokyo
      âœ“ permalink is /:year/:id/:author/, TZ is LA
      âœ“ permalink is /:year/:id:/:author/, TZ is Berlin
      âœ“ permalink is /:primary_tag/:slug/ and there is a primary_tag
      âœ“ permalink is /:primary_tag/:slug/ and there is NO primary_tag
      âœ“ shows "undefined" for unknown route segments
      âœ“ post is not published yet
    isSSL
      âœ“ detects https protocol correctly
    redirects
      âœ“ performs 301 redirect correctly
      âœ“ performs an admin 301 redirect correctly
      âœ“ performs an admin 302 redirect correctly
    make absolute urls 
      âœ“ [success] does not convert absolute URLs
      âœ“ [failure] does not convert protocol relative `//` URLs
      âœ“ [failure] does not convert internal links starting with "#"
      âœ“ [success] converts a relative URL
      âœ“ [success] converts a relative URL including subdirectories
      âœ“ asset urls only

  XMLRPC
    âœ“ listen() should initialise event correctly
    âœ“ listener() calls ping() with toJSONified model
    âœ“ listener() does not call ping() when importing
    ping()
      âœ“ with a post should execute two pings (101ms)
      âœ“ with default post should not execute pings
      âœ“ with a page should not execute pings
      âœ“ when privacy.useRpcPing is false should not execute pings
      âœ“ captures && logs errors from requests (101ms)
      âœ“ captures && logs XML errors from requests with newlines between tags (102ms)
      âœ“ captures && logs XML errors from requests without newlines between tags (101ms)
      âœ“ does not error with responses that have 0 as flerror value (101ms)

  Admin App
    middleware
      redirectAdminUrls
        âœ“ should redirect a url which starts with ghost
        âœ“ should not redirect /ghost/ on its owh
        âœ“ should not redirect url that has no slash
        âœ“ should not redirect url that starts with something other than /ghost/

  Content Api v2 middleware
    âœ“ exports an authenticatePublic middleware
    authenticatePublic
      âœ“ uses brute content api middleware as the first middleware in the chain

  cors
    âœ“ should not be enabled without a request origin header
    âœ“ should be enabled when origin is 127.0.0.1
    âœ“ should be enabled when origin is localhost
    âœ“ should be enabled when origin is a client_trusted_domain
    âœ“ should be enabled when there are multiple trusted domains
    âœ“ should not be enabled the origin is not trusted or whitelisted
    âœ“ should not be enabled the origin client_trusted_domains is empty
    âœ“ should be enabled if the origin matches config.url
    âœ“ should be enabled if the origin matches config.url

  Version Mismatch
    âœ“ should call next if request does not include a version
    âœ“ should call next if versions are an exact match
    âœ“ should call next if client version is earlier than server
    âœ“ should throw VersionMismatchError if client version is earlier by a major version
    âœ“ should throw VersionMismatchError if client version is later than server
    âœ“ should throw VersionMismatchError if client version is later by a major version
    âœ“ should call next if pre-release is allowed
    âœ“ throws error if server is a pre-release, but later by major version

  Middleware: cacheControl
    âœ“ correctly sets the public profile headers
    âœ“ correctly sets the private profile headers
    âœ“ will not set headers without a profile
    âœ“ will not get confused between serving public and private
    âœ“ will override public with private for private blogs

  Theme Handler
    ghostLocals
      âœ“ sets all locals

  handleImageSizes middleware
    âœ“ calls next immediately if the url does not match /size/something/
    âœ“ calls next immediately if the url does not match /size/something/
    âœ“ calls next immediately if the url does not match /size/something/

  normalize
    âœ“ should do manipulation by default
    âœ“ should add files array to request object with original and processed files
    âœ“ should not do manipulation without resize flag set
    âœ“ should not create files array when processing fails
    âœ“ should skip processing when file extension is .gif
    âœ“ should skip processing when file extension is .svg
    âœ“ should skip processing when file extension is .svgz

  Serve Favicon
    serveFavicon
      âœ“ should return a middleware
      âœ“ should skip if the request does NOT match the file
      serves
        âœ“ custom uploaded favicon.png
        âœ“ custom uploaded favicon.ico
        âœ“ custom uploaded myicon.ico
        âœ“ default favicon.ico
      redirects
        âœ“ to custom favicon.ico when favicon.png is requested
        âœ“ to custom favicon.png when favicon.ico is requested
        âœ“ to favicon.ico when favicon.png is requested

  servePublicFile
    âœ“ should return a middleware
    âœ“ should skip if the request does NOT match the file
    âœ“ should load the file and send it
    âœ“ should send the correct headers
    âœ“ should replace {{blog-url}} in text/plain

  staticTheme
    âœ“ should skip for .hbs file
    âœ“ should skip for .md file
    âœ“ should skip for .json file
    âœ“ should call express.static for .css file
    âœ“ should call express.static for .js file
    âœ“ should not error if active theme is missing
    âœ“ should NOT skip if file is on whitelist

  Middleware: uncapitalise
    Signup or reset request
      âœ“ [signup] does nothing if there are no capitals in req.path
      âœ“ [signup] does nothing if there are no capitals in the baseUrl
      âœ“ [signup] does nothing if there are no capitals except in a token
      âœ“ [reset] does nothing if there are no capitals except in a token
      âœ“ [signup] redirects if there are capitals in req.path
      âœ“ [signup] redirects if there are capitals in req.baseUrl
      âœ“ [signup] redirects correctly if there are capitals in req.path and req.baseUrl
      âœ“ [signup] redirects correctly with capitals in req.path if there is a token
      âœ“ [reset] redirects correctly with capitals in req.path & req.baseUrl if there is a token
    An API request
      for v0.1
        âœ“ does nothing if there are no capitals
        âœ“ version identifier is uppercase
        âœ“ redirects to the lower case slug if there are capitals
        âœ“ redirects to the lower case slug if there are capitals in req.baseUrl
        âœ“ does not convert any capitals after the endpoint
        âœ“ does not convert any capitals after the endpoint with baseUrl
      for v2
        âœ“ does nothing if there are no capitals
        âœ“ version identifier is uppercase
        âœ“ redirects to the lower case slug if there are capitals
        âœ“ redirects to the lower case slug if there are capitals in req.baseUrl
        âœ“ does not convert any capitals after the endpoint
        âœ“ does not convert any capitals after the endpoint with baseUrl
      for v10
        âœ“ does nothing if there are no capitals
        âœ“ version identifier is uppercase
        âœ“ redirects to the lower case slug if there are capitals
        âœ“ redirects to the lower case slug if there are capitals in req.baseUrl
        âœ“ does not convert any capitals after the endpoint
        âœ“ does not convert any capitals after the endpoint with baseUrl
    Any other request
      âœ“ does nothing if there are no capitals
      âœ“ redirects to the lower case slug if there are capitals

  updateUserLastSeenMiddleware
    âœ“ calls next with no error if there is no user on the request
    âœ“ calls next with no error if the current last_seen is less than an hour before now
    when the last_seen is longer than an hour ago
      âœ“ calls updateLastSeen on the req.user, calling next with nothing if success
      âœ“ calls updateLastSeen on the req.user, calling next with err if error

  UNIT: url redirects
    calls to _private.redirect()
      âœ“ urlRedirects passes getAdminRedirectUrl method when iAdmin flag is not set
      âœ“ urlRedirects passes getAdminRedirectUrl method when iAdmin flag present
      âœ“ adminRedirect passes getAdminRedirectUrl
    expect redirect
      âœ“ blog is https, request is http
      âœ“ blog host is !== request host
      admin redirects
        âœ“ url and admin url are equal, but protocol is different, request is http
        âœ“ url and admin url are different, request is http
        âœ“ subdirectory
        âœ“ keeps query
        âœ“ original url has search params
        âœ“ ensure redirect loop won't happen
    expect no redirect
      âœ“ blog is http, request is http
      âœ“ blog is http, request is https
      âœ“ blog is http, request is https (trailing slash is missing)
      âœ“ blog is https, request is https
      âœ“ blog host is !== request host
      admin redirects
        âœ“ admin is blog url and http, requester is http
        âœ“ admin request, no custom admin.url configured
        âœ“ url and admin url are different, protocol is different, request is not secure
        âœ“ url and admin url are different, protocol is different, request is secure

  parent app
    âœ“ should mount 3 apps and assign correct routes to them

  Spam Prevention
    âœ“ exports a contentApiKey method
    contentApiKey method
      âœ“ returns an instance of express-brute

  brute middleware
    âœ“ exports a contentApiKey method
    contentApiKey
      âœ“ calls the contentApiKey method of spam prevention

  web utils
    checkFileExists
      âœ“ should return true if file exists in input
      âœ“ should return false if file does not exist in input
      âœ“ should return false if file is incorrectly structured
    checkFileIsValid
      âœ“ returns true if file has valid extension and type
      âœ“ returns false if file has invalid extension
      âœ“ returns false if file has invalid type


  2200 passing (12s)
  8 pending


Done.
Done in 104.90s.
travis_time:end:032e1f9d:start=1555381920802690572,finish=1555382025923533427,duration=105120842855[0K[32;1mThe command "if [ "$TEST_SUITE" == "lint" ]; then
  yarn lint
elif [[ "$TRAVIS_PULL_REQUEST_BRANCH" =~ ^renovate || "$TRAVIS_EVENT_TYPE" == "cron" ]]; then
  yarn ci:regression
else
  yarn ci
fi
" exited with 0.[0m

travis_fold:start:cache.2[0Kstore build cache
travis_time:start:1d4573ac[0Ktravis_time:end:1d4573ac:start=1555382025932788946,finish=1555382025936528802,duration=3739856[0Ktravis_time:start:0a56000e[0K[32;1mchange detected (content changed, file is created, or file is deleted):
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/add.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/_addMapEntry.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/_addSetEntry.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/after.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/_apply.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/_arrayAggregator.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/lodash-es/array.default.js
/home/travis/.cache/yarn/v4/npm-lodash-es-4.17.11-145ab4a7ac5c5e52a3531fb4f310255a152b4be0/node_modules/loda
[0m
[32;1m...
[0m
[32;1mchanges detected, packing new archive[0m
.
[32;1muploading master/cache-linux-xenial-5a3c100ba51fc69c8c697d48d568d5385090fa49b62c5f41af6060673e12489d--node-10.tgz[0m
[32;1mcache uploaded[0m
travis_time:end:0a56000e:start=1555382025942562153,finish=1555382039603280157,duration=13660718004[0Ktravis_fold:end:cache.2[0K

Done. Your build exited with 0.
